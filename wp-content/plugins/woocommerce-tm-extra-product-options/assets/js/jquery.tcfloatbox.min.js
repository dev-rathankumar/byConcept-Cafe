!function(t){"use strict";var e=function(e,i){return this.element=t(e),this.settings=t.extend({},t.fn.tcFloatBox.defaults,i),this.settings.type="<"+this.settings.type+">",this.top=0,this.left=0,this.ticking=!1,1===this.element.length&&(this.init(),this)};e.prototype={constructor:e,destroy:function(){var e=this.settings;return void 0!==this.instance&&(t.fn.tcFloatBox.instances.splice(this.instance,1),delete this.instance,e.hideelements&&t("embed, object, select").css({visibility:"visible"}),e._ovl&&(e._ovl.unbind(),e._ovl.remove(),delete e._ovl),t(e.floatboxID).remove(),this.element.removeData("tcfloatbox"),t(window).off("scroll.tcfloatbox"+this.instance),t(window).off("resize.tcfloatbox"+this.instance)),this},hide:function(){var e=this.settings;e.hideelements&&t("embed, object, select").css({visibility:"visible"}),!0===e.showoverlay&&e._ovl&&e._ovl.hide(),t(e.floatboxID).addClass("tc-closing").removeClass(e.animateIn).addClass(e.animateOut),t(e.floatboxID).animate({opacity:0},e.closefadeouttime,function(){t(e.floatboxID).hide(),t(e.floatboxID).removeClass("tc-closing").addClass("tc-closed")}),t(window).off("scroll.tcfloatbox"+this.instance),t(window).off("resize.tcfloatbox"+this.instance)},requestTick:function(){var t=this.settings;this.ticking||(t.refresh?setTimeout(this.requestAnimationFrame.bind(this),t.refresh):requestAnimationFrame(this.update),this.ticking=!0)},requestAnimationFrame:function(){requestAnimationFrame(this.update.bind(this))},update:function(){this.render(),this.ticking=!1},doit:function(){this.requestTick()},render:function(){var e,i,n,s=this.settings,o=t.epoAPI.dom.size();e="fixed"===s.refresh?{top:0,left:0}:t.epoAPI.dom.scroll(),i=parseInt(e.top+(o.visibleHeight-t(s.floatboxID).height())/2,10),n=parseInt(e.left+(o.visibleWidth-t(s.floatboxID).width())/2,10),i=parseInt((i-this.top)/s.fps,10),n=parseInt((n-this.left)/s.fps,10),this.top+=i,this.left+=n,t(s.floatboxID).css({top:this.top+"px",left:this.left+"px",opacity:1})},show:function(){var e,i,n=this.settings;1===this.element.length&&(void 0===this.instance&&this.init(),n.hideelements&&t("embed, object, select").css({visibility:"hidden"}),i=t.epoAPI.dom.size(),!0===n.showoverlay&&(n._ovl?n._ovl.show():(n._ovl=t('<div class="fl-overlay"></div>').css({zIndex:parseInt(n.zIndex,10)-1,opacity:n.overlayopacity}),n._ovl.appendTo("body"),n.ismodal||(n.cancelEvent||n.unique?n._ovl.on("click",this.applyCancelEvent.bind(this)):n._ovl.on("click",n.cancelfunc.bind(this))))),n.showfunc&&n.showfunc.call(),t(n.floatboxID).removeClass("tc-closing").addClass(n.animationBaseClass+" "+n.animateIn),"fixed"===n.refresh?(!1!==n.top?e=n.top:(e=parseInt((i.visibleHeight-t(n.floatboxID).height())/2,10),e+="px"),t(n.floatboxID).css({position:"fixed",top:e}),!1!==n.left&&t(n.floatboxID).css({left:n.left})):this.render())},applyCancelEvent:function(){var t=this.settings;!0===t.cancelEvent?this.destroy():"function"==typeof t.cancelEvent&&t.cancelEvent.call(this,this)},applyCancelEventFromKey:function(t){27===t.which&&this.applyCancelEvent()},applyUpdateEvent:function(){var t=this.settings;"function"==typeof t.updateEvent&&t.updateEvent.call(this,this)},applyUpdateEventFromKey:function(t){13===t.which&&this.applyUpdateEvent()},init:function(){var e,i,n,s=this.settings;1===this.element.length&&(t.fn.tcFloatBox.instances.length>0&&(s.zIndex=parseInt(t.fn.tcFloatBox.instances[t.fn.tcFloatBox.instances.length-1].zIndex,10)+100),this.instance=t.fn.tcFloatBox.instances.length,t.fn.tcFloatBox.instances.push(s),s.id=s.id+this.instance,s.floatboxID="#"+t.epoAPI.dom.id(s.id),this.hide(),e=t.epoAPI.dom.size(),i=t.epoAPI.dom.scroll(),t(s.type).attr("id",s.id).addClass(s.classname).html(s.data).appendTo(this.element),t(s.floatboxID).css({width:s.width,height:s.height}),n=parseInt(i.left+(e.visibleWidth-t(s.floatboxID).width())/2,10),t(s.floatboxID).css({top:"0px",left:n+"px","z-index":s.zIndex}),this.top=0,this.left=n,this.cancelfunc=s.cancelfunc,s.cancelEvent&&s.cancelClass&&(t(s.floatboxID).find(s.cancelClass).on("click",this.applyCancelEvent.bind(this)),s.isconfirm&&t(document).off("keyup.escape-"+s.floatboxID).on("keyup.escape-"+s.floatboxID,this.applyCancelEventFromKey.bind(this))),s.updateEvent&&s.updateClass&&(t(s.floatboxID).find(s.updateClass).on("click",this.applyUpdateEvent.bind(this)),s.isconfirm&&t(document).off("keyup.enter-"+s.floatboxID).on("keyup.enter-"+s.floatboxID,this.applyUpdateEventFromKey.bind(this))),this.show(),"fixed"!==s.refresh&&t(window).on("scroll.tcfloatbox"+this.instance,this.doit.bind(this)),t(window).on("resize.tcfloatbox"+this.instance,this.doit.bind(this)))}},t.fn.tcFloatBox=function(i){var n,s,o=t(this),a=o.data("tcfloatbox");return s="object"==typeof i?i:{},a||(a=new e(this,s),o.data("tcfloatbox",a)),"string"==typeof i&&(n=a[i].apply(a,[])),void 0===n?o:n},t.fn.tcFloatBox.defaults={id:"flasho",classname:"flasho",type:"div",data:"",width:"500px",height:"auto",closefadeouttime:1e3,animationBaseClass:"tm-animated",animateIn:"fadeIn",animateOut:"fadeOut",top:!1,left:!1,refresh:!1,fps:4,hideelements:!1,showoverlay:!0,zIndex:100100,ismodal:!1,cancelfunc:e.prototype.hide,showfunc:null,cancelEvent:!0,cancelClass:".floatbox-cancel",updateEvent:!1,updateClass:!1,unique:!0,overlayopacity:.5,isconfirm:!1},t.fn.tcFloatBox.instances=[],t.fn.tcFloatBox.Constructor=e,t.tcFloatBox=function(i){var n=t("body"),s=!1;return n.map(function(){return t(this).data("tcfloatbox")||""}).get().some(function(t){return""===t})||i.unique?(s=new e(n,i),n.data("tcfloatbox",s)):(s=n.data("tcfloatbox")).init(),s}}(window.jQuery);