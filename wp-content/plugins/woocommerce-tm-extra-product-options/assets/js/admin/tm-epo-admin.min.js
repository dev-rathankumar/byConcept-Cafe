!function(t,e,o){"use strict";function c(){var t=o("#product-type").val();o(".woocommerce_tm_epo").toArray().forEach(function(e){var c=o(e),i=c.find(".tmcp_attribute").val(),a=c.find("select.tmcp_att").val(),n=c.find("select.tmcp-variation").val(),r="input.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"'],select.tmcp-price-input-variation-"+n+"[data-price-input-attribute='"+a+"']";"variable"!==t&&"variable-subscription"!==t?c.find(".show_if_variable").hide():c.find(".show_if_variable").show(),c.find("select.tmcp_att").hide(),c.find("select.tmcp_att[data-tm-attr='"+i+"']").show(),c.find("input.tmcp-price-input").hide(),c.find("select.tmcp-price-input-type").hide(),c.find(r).show()})}function i(){o(".woocommerce_tm_epos .woocommerce_tm_epo").toArray().forEach(function(t){o(".tm_epo_menu_order",t).val(parseInt(o(t).index(".woocommerce_tm_epos .woocommerce_tm_epo"),10))})}function a(t,e){var o,c=t.val(),i=t.closest(".woocommerce_tm_epo"),a=i.find("input.tmcp_loop").val(),n=i.find("select.tmcp_att").val(),r=i.find("select.tmcp-variation").val(),p="";switch(i.find("input.tmcp-price-input").hide(),i.find("select.tmcp-price-input-type").hide(),e){case"variation":r=c,p="input.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+n+"'],select.tmcp-price-input-variation-"+c+"[data-price-input-attribute='"+n+"']";break;case"attribute":n=c,p="input.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+c+"'],select.tmcp-price-input-variation-"+r+"[data-price-input-attribute='"+c+"']"}i.find(p).length<=0&&((o=i.find(".tmcp_pricing")).append('<input type="text" size="5" name="tmcp_regular_price['+a+"]["+n+"]["+r+']" value="" class="wc_input_price tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" />'),o.append('<select class="tmcp-price-input-type tmcp-price-input tmcp-price-input-variation-'+r+'" data-price-input-attribute="'+n+'" name="tmcp_regular_price_type['+a+"]["+n+"]["+r+']"><option value="">'+_.i18n_fixed_type+'</option><option value="percent">'+_.i18n_percent_type+"</option></select>")),i.find(p).show()}function n(){var t;1===m&&(o("#tm_extra_product_options").block({message:null}),t={action:"woocommerce_tm_load_epos",post_id:_.post_id,security:_.load_tm_epo_nonce},o.post(_.ajax_url,t,function(t){o(".tm_mode_local").html(t),o("#tm_extra_product_options").unblock(),o("#tm_extra_product_options").trigger("woocommerce_tm_epos_loaded"),m=0,c()}))}function r(t){t&&(o("#tm_meta_cpf_mode").val(t),o(".tm_mode_selector").addClass("tm_hidden"),o(".tm_mode_builder,.tm_mode_local,.tm_mode_settings").hide(),o(".tm_mode_"+t).show(),o(".tm_builder_select,.tm_local_select,.tm_settings_select").removeClass("button-primary"),o(".tm_"+t+"_select").addClass("button-primary"))}var p,_=t.TMEPOADMINJS,m=0;_&&o(e).ready(function(){var e=o("#bulk-action-selector-top"),l=!1;e.length>0&&e.children("option").each(function(t,e){"tcline"===o(e).val()?(l=!0,o(e).replaceWith(o('<optgroup class="tc-bulk-opt" label="'+o(e).text()+'">'))):l&&"tcclear"!==o(e).val()&&"tcproductclear"!==o(e).val()&&"tcclearexclude"!==o(e).val()&&"tcclearexcludeadd"!==o(e).val()&&o(e).appendTo(o(".tc-bulk-opt")),"tcline2"===o(e).val()&&o(e).remove()}),p={items:".woocommerce_tm_epo",cursor:"move",axis:"y",handle:"h3 .move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){t&&e.item.css("background-color","#f6f6f6")},stop:function(t,e){t&&e.item.removeAttr("style"),i()}},c(),o("#tm_extra_product_options").on("change","select.tmcp-variation",function(){a(o(this),"variation")}),o("#tm_extra_product_options").on("change","select.tmcp_att",function(){a(o(this),"attribute")}),o("#tm_extra_product_options").on("woocommerce_tm_epo_added",function(){o(".woocommerce_tm_epos").sortable(p)}),o("#tm_extra_product_options").on("woocommerce_tm_epos_loaded",function(){o(".woocommerce_tm_epos").sortable(p)}),o(".woocommerce_tm_epos").sortable(p),o("#variable_product_options").on("click","button.remove_variation",function(){m=1}),o("#variable_product_options").on("woocommerce_variations_added",function(){m=1}),o(".product_attributes").on("click","button.add_new_attribute",function(){m=1}),o(".save_attributes").on("click",function(){m=1}),o(".tm_epo_class a").on("click",function(){n()}),o("#tm_extra_product_options").on("click","button.tm_add_epo",function(){var e=o("select.tmcp_attr_list").val(),i=o(".woocommerce_tm_epos .woocommerce_tm_epo[data-epo-attr='"+e+"']"),a=o(".woocommerce_tm_epo").length,n={action:"woocommerce_tm_add_epo",post_id:_.post_id,att_id:e,loop:a,security:_.add_tm_epo_nonce};if(!(i.length>0))return o(".tm_mode_local").block({message:null}),o.post(_.ajax_url,n,function(e){"max"===e?(t.alert(_.i18n_max_tmcp),o(".tm_mode_local").unblock()):e&&(o(".woocommerce_tm_epos").append(e),o("#tm_extra_product_options").trigger("woocommerce_tm_epo_added"),c())}).always(function(){o(".tm_mode_local").unblock()}),!1;i.find(".woocommerce_tmcp_attributes").show()}),o("#tm_extra_product_options").on("click",".remove_tm_epo",function(e){var c,i,a,n=t.confirm(_.i18n_remove_tmcp);return e.preventDefault(),n&&(c=o(this).parent().parent(),(i=o(this).attr("rel"))>0?(c.block({message:null}),a={action:"woocommerce_tm_remove_epo",tmcpid:i,security:_.delete_tm_epo_nonce},o.post(_.ajax_url,a,function(){c.fadeOut("300",function(){c.remove()})})):c.fadeOut("300",function(){c.remove()})),!1}),o("#tm_extra_product_options").on("change",".tm-type",function(){var t=o(this),e=t.closest(".data").find(".tmcp_choices");"checkbox"===t.val()?e.removeClass("tm-hidden"):e.addClass("tm-hidden")}),o("#tm_extra_product_options").on("click",".tm_select_mode",function(t){var e="local";t.preventDefault(),o(this).is(".tm_builder_select")&&(e="builder"),o(this).is(".tm_settings_select")&&(e="settings"),r(e)}),o("#tm_meta_cpf_mode").val()||o("#tm_meta_cpf_mode").val("builder"),r(o("#tm_meta_cpf_mode").val()),o.tmEPOAdmin&&o.tmEPOAdmin.create_normal_dropdown(o(".tm_mode_settings")),o.fn.tmcheckboxes&&o(".tm_mode_settings").tmcheckboxes()})}(window,document,window.jQuery);