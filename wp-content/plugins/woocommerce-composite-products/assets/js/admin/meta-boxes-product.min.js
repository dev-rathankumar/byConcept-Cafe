jQuery(function(l){var d=l("#bto_product_data"),_=d.find("#_bto_shop_price_calc"),p=d.find(".bulk_toggle_wrapper"),e=l(".config_group",d),i=l(".bto_groups",e),u=l(".bto_group",i),a=u.length,f={},h=l("#bto_scenario_data"),m=h.find(".bulk_toggle_wrapper"),t=l(".scenarios_config_group",h),c=l(".bto_scenarios",h),g=l(".bto_scenario",c),s=g.length,b={},o=!1,n={image_frame:!1,$button:!1},r={message:null,overlayCSS:{background:"#fff",opacity:.6}},v={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200},y=[],$=!1;function w(t){var s=this;this.$el=t,this.$content=t.find(".bto_group_data"),this.$metabox_title=t.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$display_prices=this.$content.find(".component_display_prices"),this.$pagination_style=this.$content.find(".component_pagination_style"),this.$query_type_containers=this.$content.find(".component_query_type_selector"),this.$query_type_selector=this.$content.find("select.component_query_type"),this.$options_style_container=this.$content.find(".component_options_style"),this.$options_style_selector=this.$content.find("select.options_style_selector"),this.$categories_selector=this.$content.find("select.categories_selector"),this.$products_selector=this.$content.find("select.products_selector"),this.$default_selectors_container=this.$content.find(".default_selector_container"),this.$default_selectors=this.$content.find(".default_selector_wrapper"),this.$default_selector_categories=this.$content.find("select.default_selector_categories"),this.$default_selector_products=this.$content.find("select.default_selector_products"),this.$optional_checkbox=this.$content.find("input.component_optional"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$sort_filter_container=this.$content.find(".options_group_component--sort-filter"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.initialized_content=!1,this.component_toggled=function(){var t=s.maybe_initialize_content()?50:10,e=this.$el,o=this.$content;setTimeout(function(){e.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},t)},this.maybe_initialize_content=function(){var t=!1;return s.initialized_content||(t=!0,s.initialize_content()),t},this.section_changed=function(t){s.$section_links.removeClass("current"),t.addClass("current"),s.$sections.addClass("tab_group_hidden"),s.$content.find(".tab_group_"+t.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){s.$metabox_title.text(s.$title_input.val()),x(!0)},this.query_type_changed=function(){s.$query_type_containers.hide(),s.$default_selectors.hide();var t=s.$query_type_selector.val();s.$content.find(".component_query_type_"+t).show(),this.initialized_content&&(s.maybe_hide_static_component_content(),"category_ids"===t?(s.reinitialize_default_option_category_select(),s.maybe_update_default_option_category_ids(!0)):(s.initialize_default_option_product_select(),s.default_option_changed()),x(!0))},this.products_changed=function(){s.maybe_hide_static_component_content(),s.initialize_default_option_product_select(),s.default_option_changed(),x(!0)},this.categories_changed=function(){var t=s.get_category_ids();s.$default_selector_categories.data("include",t.join()),s.maybe_update_default_option_category_ids(!0),x(!0)},this.optional_changed=function(){s.maybe_hide_static_component_content(),s.default_option_changed(),x(!0)},this.options_style_changed=function(){"yes"===s.$options_style_selector.find('option[value="'+s.$options_style_selector.val()+'"]').data("supports").pagination?s.$pagination_style.show():s.$pagination_style.hide()},this.priced_individually_input_changed=function(){s.$priced_individually_input.is(":checked")?(s.$discount.show(),s.$display_prices.show()):(s.$discount.hide(),s.$display_prices.hide())},this.show_filters_input_changed=function(){s.$show_filters_input.is(":checked")?s.$filters.show():s.$filters.hide()},this.maybe_hide_static_component_content=function(){if("category_ids"===s.$query_type_selector.val())s.$options_style_container.show(),s.$sort_filter_container.show();else{var t=s.get_product_ids().length;1<t||1===t&&s.is_optional()?(s.$options_style_container.show(),s.$sort_filter_container.show()):(s.$options_style_container.hide(),s.$sort_filter_container.hide())}},this.default_option_changed=function(){var t=s.$query_type_selector.val(),e=s.get_default_option(),o=s.get_default_option_html(),n="category_ids"===t?s.$default_selector_categories.val():s.$default_selector_products.val(),i=!0,a=!1;if(!n&&!s.is_optional())if("category_ids"===t)"defaults"===_.val()&&0<s.get_category_ids().length&&(a="set_defaults");else{var c=s.get_product_ids().length;0<c&&("defaults"===_.val()?a="set_defaults":1===c&&(a="set_defaults_static"))}a&&(s.has_error(s.$default_selectors_container)||(setTimeout(function(){s.add_error_tip(s.$default_selectors_container,a)},5),e||s.add_error(s.$default_selectors_container,a)),"product_ids"===t?s.$default_selector_products.val(e).triggerHandler("change"):o&&s.$default_selector_categories.append(o).val(e).triggerHandler("change"),i=!1),i&&(s.clear_error(s.$default_selectors_container),s.set_default_option(n))},this.add_error_tip=function(t,e){var o=t.position();0===t.parent().find(".wc_error_tip").length&&(t.after('<div class="wc_error_tip">'+wc_composite_admin_params["i18n_"+e]+"</div>"),t.parent().find(".wc_error_tip").css("left",o.left+t.width()-t.width()/2-l(".wc_error_tip").width()/2).css("top",o.top+t.height()).fadeIn("100"))},this.has_error=function(t){return t.hasClass("selection_error")},this.add_error=function(t,e){t.find(".wc-cp-error-tip").attr("data-tip",wc_composite_admin_params["i18n_"+e]),t.find(".wc-cp-error-tip").tipTip(v),t.addClass("selection_error")},this.clear_error=function(t){t.removeClass("selection_error")},this.initialize=function(){s.query_type_changed(),s.options_style_changed(),s.priced_individually_input_changed(),s.show_filters_input_changed()},this.initialize_default_option_category_select=function(){void 0===s.get_default_option_html()&&s.save_default_option_html()},this.reinitialize_default_option_category_select=function(){var t=s.get_default_option(),e=s.get_default_option_html();e&&s.$default_selector_categories.append(e),s.$default_selector_categories.val(t).triggerHandler("change")},this.initialize_default_option_product_select=function(){var t=s.$products_selector.find(":selected").clone().removeAttr("selected").removeAttr("data-select2-id"),e=s.get_default_option()&&0<t.filter('[value="'+s.get_default_option()+'"]').length;if(s.$default_selector_products.find("option").remove(),s.$default_selector_products.append(t),s.$default_selector_products.prepend("<option/>"),!e){var o=!s.is_optional()&&0<t.length&&("defaults"===_.val()||1===t.length)?t.first().val():0;s.set_default_option(o)}s.$default_selector_products.val(s.get_default_option()).triggerHandler("change")},this.initialize_content=function(){"category_ids"===s.$query_type_selector.val()?s.initialize_default_option_category_select():s.initialize_default_option_product_select(),s.initialize_select2s(),s.$content.find(".woocommerce-help-tip").tipTip(v),s.initialized_content=!0},this.initialize_select2s=function(){s.$content.sw_select2({sortable:{stop:function(t){if(t.hasClass("products_selector")){var e=t.closest(".bto_group").data("component_metabox_id");f[e].products_changed()}}}})},this.maybe_update_default_option_category_ids=function(e){if(e=e||!1,null===s.get_default_option_category_ids()){s.update_default_option_category_ids_xhr&&s.update_default_option_category_ids_xhr.abort();var t={action:"woocommerce_get_product_categories",product_id:s.get_default_option(),security:wc_composite_admin_params.get_product_categories_nonce};s.update_default_option_category_ids_xhr=l.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){s.set_default_option_category_ids("success"===t.result?t.category_ids:[]),e&&s.check_default_option_in_category_ids()})}else e&&s.check_default_option_in_category_ids()},this.check_default_option_in_category_ids=function(){(s.get_default_option()&&!s.is_default_option_in_category_ids()||0===s.get_category_ids().length)&&(s.set_default_option(0),s.$default_selector_categories.val(0).trigger("change"))},this.is_default_option_in_category_ids=function(){var t=s.get_selector_data(s.$categories_selector),e=s.get_default_option_category_ids(),o=[];l.each(t,function(t,e){o.push(parseInt(e.id))});var n=!1;return l.each(e,function(t,e){if(s.array_contains(parseInt(e),o))return!(n=!0)}),n},this.get_default_option_category_ids=function(){return this.$default_selectors_container.data("selected_data").default_option_category_ids},this.set_default_option_category_ids=function(t){this.$default_selectors_container.data("selected_data").default_option_category_ids=t},this.get_default_option_html=function(){return this.$default_selectors_container.data("selected_data").default_option_html},this.save_default_option_html=function(){var t=this.$default_selectors_container.data("selected_data");if(s.get_default_option()){var e="category_ids"===s.$query_type_selector.val()?s.$default_selector_categories.find(":selected").clone():s.$default_selector_products.find(":selected").clone();t.default_option_html=e}else t.default_option_html=!1},this.get_default_option=function(){return this.$default_selectors_container.data("selected_data").default_option_id||0},this.set_default_option=function(t){var e=this.$default_selectors_container.data("selected_data");e.default_option_id=t||0,s.save_default_option_html(),s.set_default_option_category_ids(!!e.default_option_id&&null),s.maybe_update_default_option_category_ids()},this.get_selector_data=function(t){return t.selectSW("data")},this.get_category_ids=function(){var t=s.get_selector_data(s.$categories_selector),o=[];return l.each(t,function(t,e){o.push(parseInt(e.id))}),o},this.get_product_ids=function(){var t=s.get_selector_data(s.$products_selector),o=[];return l.each(t,function(t,e){o.push(parseInt(e.id))}),o},this.array_contains=function(t,e){return-1!==l.inArray(t,e)},this.is_optional=function(){return s.$optional_checkbox.is(":checked")},this.initialize()}function x(t){o=t=!!t}function C(){0<u.length?(e.removeClass("no-components"),p.removeClass("disabled")):(e.addClass("no-components"),p.addClass("disabled"))}function k(){f={},u.each(function(t){var e=l(this),o="component_"+t;e.data("component_metabox_id",o),f[o]=new w(e)}),i.sortable({items:".bto_group",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),d.triggerHandler("wc-cp-components-changed")}}),C()}function z(t){var i=this;this.$el=t,this.$content=t.find(".bto_scenario_data"),this.$metabox_title=t.find("h3 .scenario_name .scenario_name_inner"),this.$title_input=this.$content.find("input.scenario_title"),this.$conditional_components_action_input=this.$content.find(".toggle_conditional_components input"),this.$conditional_components_action_config=this.$content.find(".scenario_action_conditional_components_group .action_components"),this.render_content=this.$content.data("scenario_content"),this.initialized_content=!1,this.scenario_toggled=function(){var t=this.$el,e=this.$content;if(!$){var o=i.maybe_initialize_content(),n=o&&T()?200:o?50:10;setTimeout(function(){t.toggleClass("closed").toggleClass("open"),e.stop().slideToggle({always:function(){o&&T()&&(i.$el.removeClass("loading"),$=!1)}})},n)}},this.maybe_initialize_content=function(){var t=!1,e=T()?100:10;return i.initialized_content||(t=!0,T()&&(i.$el.addClass("loading"),$=!0),setTimeout(function(){i.initialize_content()},e)),t},this.title_changed=function(){i.$metabox_title.text(i.$title_input.val())},this.match_component_changed=function(t){t.is(":checked")?t.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").show():t.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").hide()},this.conditional_components_action_input_changed=function(){i.$conditional_components_action_input.is(":checked")?i.$conditional_components_action_config.show():i.$conditional_components_action_config.hide()},this.initialize_content=function(){""!==i.render_content&&(i.$content.html(i.render_content),i.$title_input=i.$content.find("input.scenario_title"),i.$conditional_components_action_input=i.$content.find(".toggle_conditional_components input"),i.$conditional_components_action_config=i.$content.find(".scenario_action_conditional_components_group .action_components")),i.initialize_select2s(),i.$content.find(".tips, .woocommerce-help-tip").tipTip(v),i.initialized_content=!0},this.initialize_select2s=function(){i.$content.sw_select2({sortable:{stop:function(t){if(t.hasClass("products_selector")){var e=t.closest(".bto_group").data("component_metabox_id");f[e].products_changed()}}}})},this.initialize=function(){},this.initialize()}function T(){return 20<u.length}function q(){0<g.length?m.removeClass("disabled"):m.addClass("disabled")}function H(){t.on("click",".expand_all",function(){return l(this).hasClass("disabled")||l.each(b,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1}).on("click",".close_all",function(){return l(this).hasClass("disabled")||l.each(b,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1}).on("click",".bto_scenario_handle",function(){var t=l(this).closest(".bto_scenario").data("scenario_metabox_id"),e=b[t];void 0!==e&&e.scenario_toggled()}).on("click","a.remove_row",function(t){var e=l(this).closest(".bto_scenario"),o=e.data("scenario_metabox_id");e.find("*").off(),e.remove(),delete b[o],h.triggerHandler("wc-cp-scenarios-changed"),t.preventDefault()}).on("keyup","input.scenario_title",function(){var t=l(this).closest(".bto_scenario").data("scenario_metabox_id");b[t].title_changed()}).on("change","input.bto_scenario_match_component",function(){var t=l(this).closest(".bto_scenario").data("scenario_metabox_id");b[t].match_component_changed(l(this))}).on("change",".toggle_conditional_components input",function(){var t=l(this).closest(".bto_scenario").data("scenario_metabox_id");b[t].conditional_components_action_input_changed()}).on("click","#active-toggle",function(){var t,e,o=l(this),n=o.closest(".wc-metabox").find(".bto_scenario_handle .handle > input.enabled");return t=o,"yes"===(e=n).val()?(e.val("no"),t.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(e.val("yes"),t.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled")),!1}).on("click","button.add_bto_scenario",function(){h.block(r),s++;var t={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:s,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){l.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){c.append(t);var e=l(".bto_scenario",c).last(),o=new z(e),n="scenario_"+s;e.data("scenario_metabox_id",n),b[n]=o,h.triggerHandler("wc-cp-scenarios-changed"),o.initialize_content(),h.triggerHandler("wc-cp-scenario-added",[o]),h.unblock()})},250),!1})}function S(){b={},g.each(function(t){var e=l(this),o="scenario_"+t;e.data("scenario_metabox_id",o),b[o]=new z(e)}),c.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),h.triggerHandler("wc-cp-scenarios-changed")}}),q()}l.each(wc_composite_admin_params.layouts,function(t,e){y.push("layout-"+e)}),l(".composite_stock_msg").appendTo("._manage_stock_field .description"),l("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),l("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),l(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),l("body").on("woocommerce-product-type-change",function(t,e){"composite"===e&&(l(".show_if_external").hide(),l(".show_if_composite").show(),l("input#_manage_stock").change())}),l("select#product-type").change(),l("input#_downloadable").change(function(){l("select#product-type").change()}),_.data("val",_.val()),d.off("click").on("click",".bto_layout_label",function(){var t=l(this);t.closest(".bto_layouts").find(".selected").removeClass("selected"),t.addClass("selected"),e.removeClass(y.join(" ")),e.addClass("layout-"+t.find("input").val())}).on("change","#_bto_shop_price_calc",function(){var t=l(this).val(),o=!1;"defaults"===t&&l.each(f,function(t,e){if(!e.is_optional()&&!e.get_default_option())return o=!0,window.alert(wc_composite_admin_params.i18n_defaults_unset),_.val(_.data("val")),!1}),o||_.data("val",t)}).one("wc-cp-component-added",function(){e.removeClass("options_group--boarding")}).on("wc-cp-components-changed",function(){i=l(".bto_groups",e),(u=l(".bto_group",i)).each(function(t,e){l(".group_position",e).val(t),l(e).attr("rel",t)}),x(!0),C()}),h.off("click").one("wc-cp-scenario-added",function(){t.removeClass("options_group--boarding")}).on("wc-cp-scenarios-changed",function(){c=l(".bto_scenarios",h),(g=l(".bto_scenario",c)).each(function(t,e){l(".scenario_position",e).val(t),l(e).attr("rel",t)}),q()}),e.on("click",".expand_all",function(){return l(this).hasClass("disabled")||l.each(f,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1}).on("click",".close_all",function(){return l(this).hasClass("disabled")||l.each(f,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1}).on("click",".bto_group_handle",function(){var t=l(this).closest(".bto_group").data("component_metabox_id"),e=f[t];void 0!==e&&e.component_toggled()}).on("click",".subsubsub a",function(t){var e=l(this),o=l(this).closest(".bto_group").data("component_metabox_id");f[o].section_changed(e),t.preventDefault()}).on("click","a.remove_row",function(t){var e=l(this).closest(".bto_group"),o=e.data("component_metabox_id");e.find("*").off(),e.remove(),delete f[o],d.triggerHandler("wc-cp-components-changed"),t.preventDefault()}).on("click","button.add_bto_group",function(){d.block(r),a++;var t={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:a,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){l.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){i.append(t);var e=l(".bto_group",i).last(),o=new w(e),n="component_"+a;e.data("component_metabox_id",n),f[n]=o,d.triggerHandler("wc-cp-components-changed"),o.initialize_content(),d.triggerHandler("wc-cp-component-added",[o]),d.unblock()})},250),!1}).on("keyup","input.group_title",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].title_changed()}).on("change","select.component_query_type",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].query_type_changed()}).on("change","select.categories_selector",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].categories_changed()}).on("change","select.products_selector",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].products_changed()}).on("change","select.default_selector_categories",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].default_option_changed()}).on("change","select.default_selector_products",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].default_option_changed()}).on("change","input.component_optional",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].optional_changed()}).on("change","select.options_style_selector",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].options_style_changed()}).on("change",".group_priced_individually input",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].priced_individually_input_changed()}).on("change",".group_show_filters input",function(){var t=l(this).closest(".bto_group").data("component_metabox_id");f[t].show_filters_input_changed()}).on("click",".upload_component_image_button",function(t){n.$button=l(this),t.preventDefault(),n.image_frame||(n.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),n.image_frame.on("select",function(){var t=n.image_frame.state().get("selection").first().toJSON(),e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;n.$button.addClass("has_image"),n.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),n.$button.find("input").val(t.id).change(),n.$button.find("img").eq(0).attr("src",e)})),n.image_frame.open()}).on("click",".remove_component_image_button",function(t){var e=l(this),o=e.closest(".component_image"),n=o.find(".upload_component_image_button");t.preventDefault(),n.removeClass("has_image"),e.removeClass("has_image"),o.find("input").val("").change(),n.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)}),k(),H(),S();var j=l(".cp_scenarios_tab"),A=j.find("a"),I=!1;j.prepend('<a class="cp_scenarios_tab_inner" href="#bto_scenario_data"></a>');var D,O,P,J,L,N,Q=j.find("a.cp_scenarios_tab_inner");Q.html(A.html()),Q.on("click",function(){o&&!I?window.confirm(wc_composite_admin_params.i18n_scenarios_panel_blocked)&&(A.trigger("click"),setTimeout(function(){!function(){d.block(r),h.block(r),u.find("*").off();var t={post_id:woocommerce_admin_meta_boxes.post_id,data:l("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){I=l.post(woocommerce_admin_meta_boxes.ajax_url,t,function(r){var t=window.location.toString();t=t.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),l.get(t,function(t){var o=[],n=[],e=l("#bto_config_group_inner",d),i=l("#bto_scenarios_inner",h),a=l(t).find("#bto_config_group_inner"),c=a.find(".bto_group"),s=l(t).find("#bto_scenarios_inner"),_=s.find(".bto_scenario");u.length===c.length&&u.each(function(){var t=l(this);if(t.hasClass("open")){var e=t.attr("rel");o.push(e)}}),c.each(function(){var t=l(this),e=t.attr("rel");-1!==l.inArray(e,o)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),g.length===_.length&&i.find(".bto_scenario").each(function(){var t=l(this);if(t.hasClass("open")){var e=t.attr("rel");n.push(e)}}),_.each(function(){var t=l(this),e=t.attr("rel");-1!==l.inArray(e,n)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),u.find("*").off(),g.find("*").off(),e.html(a.html()),i.html(s.html()),p=e.find(".bulk_toggle_wrapper"),m=i.find(".bulk_toggle_wrapper"),d.triggerHandler("wc-cp-components-changed"),k(),h.triggerHandler("wc-cp-scenarios-changed"),S(),u.each(function(){var t=l(this);if(t.hasClass("open")){var e=t.data("component_metabox_id");f[e].initialize_content()}}),g.each(function(){var t=l(this);if(t.hasClass("open")){var e=t.data("scenario_metabox_id");b[e].initialize_content()}}),0<r.length&&l.each(r,function(t,e){window.alert(e)}),d.unblock(),h.unblock(),x(I=!1)})},"json")},250)}()},150)):A.trigger("click");return!1}),"yes"===wc_composite_admin_params.is_first_composite&&(l("select#product-type").val("composite").change().focus(),setTimeout(function(){l(".composite_product_options a").trigger("click")},500)),D=d.parent().find("#shipping_product_data"),O=l("input#_virtual"),P=D.find(".options_group.composite_type"),J=P.find(".bto_type_options li"),L=!!l("input#_virtual:checked").length,N=l("select#product-type"),P.detach().prependTo(D),D.find(".form-field._weight_field").after(P.find(".form-field.composite_aggregate_weight_field")),O.on("change",function(){"composite"!==N.val()&&"bundle"!==N.val()&&(L=!!l(this).prop("checked"))}),l("body").on("woocommerce-product-type-change",function(t,e){"composite"!==e&&"simple"===e&&O.prop("checked",L).change()}),J.on("click",function(){var t=l(this),e=t.find("input").prop("checked","checked").val();J.removeClass("selected"),t.addClass("selected"),"assembled"===e?(D.removeClass("composite_unassembled"),d.removeClass("composite_unassembled")):"unassembled"===e&&(D.addClass("composite_unassembled"),d.addClass("composite_unassembled"))})});