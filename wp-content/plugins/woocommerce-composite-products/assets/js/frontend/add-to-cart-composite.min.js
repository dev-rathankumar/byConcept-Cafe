var wc_cp_composite_scripts={},$wc_cp_body=!1,$wc_cp_html=jQuery("html"),$wc_cp_window=jQuery(window),$wc_cp_document=jQuery(document),wc_cp_block_params={message:null,fadeIn:200,fadeOut:200,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:.6}};function wc_cp_toggle_element(t,e,i,n){return n=void 0===n?300:n,!0!==t.data("animating")&&(t.hasClass("closed")?(setTimeout(function(){e.slideDown({duration:n,queue:!1,always:function(){t.removeClass("opening"),t.data("animating",!1),"function"==typeof i&&i()}})},40),t.removeClass("closed").addClass("open opening"),t.find(".aria_button").attr("aria-expanded","true")):(setTimeout(function(){e.slideUp({duration:n,queue:!1,always:function(){t.removeClass("closing"),t.data("animating",!1),"function"==typeof i&&i()}})},40),t.removeClass("open").addClass("closed closing"),t.find(".aria_button").attr("aria-expanded","false")),t.data("animating",!0),!0)}function wc_cp_price_format(t,e){return e=void 0!==e&&e,wc_cp_woocommerce_number_format(wc_cp_number_format(t),e)}function wc_cp_woocommerce_number_format(t,e){var i=wc_composite_params.currency_format_decimal_sep,n=wc_composite_params.currency_position,o=wc_composite_params.currency_symbol,s=wc_composite_params.currency_format_trim_zeros,_=wc_composite_params.currency_format_num_decimals;if(e=void 0!==e&&e,"yes"==s&&0<_){for(var a=0;a<_;a++)i+="0";t=t.replace(i,"")}var c=String(t),r=e?o:'<span class="woocommerce-Price-currencySymbol">'+o+"</span>";return"left"===n?c=r+c:"right"===n?c+=r:"left_space"===n?c=r+" "+c:"right_space"===n&&(c=c+" "+r),c=e?c:'<span class="woocommerce-Price-amount amount">'+c+"</span>"}function wc_cp_number_format(t){var e=wc_composite_params.currency_format_num_decimals,i=wc_composite_params.currency_format_decimal_sep,n=wc_composite_params.currency_format_thousand_sep,o=t,s=isNaN(e=Math.abs(e))?2:e,_=void 0===i?",":i,a=void 0===n?".":n,c=o<0?"-":"",r=parseInt(o=Math.abs(+o||0).toFixed(s),10)+"",l=3<(l=r.length)?l%3:0;return c+(l?r.substr(0,l)+a:"")+r.substr(l).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?_+Math.abs(o-r).toFixed(s).slice(2):"")}function wc_cp_number_round(t,e){var i=void 0===e?wc_composite_params.currency_format_num_decimals:e,n=Math.pow(10,parseInt(i,10)),o=t*n;return Math.round(o)/n}function wc_cp_join(t){var e="",i=t.length;if(0<i)for(var n=0,o=0;o<i;o++)n++,e=1==i||1==n?t[o]:wc_composite_params.i18n_comma_sep.replace("%s",e).replace("%v",t[o]);return e}function wc_cp_get_variation_data(t,e,c){e=e||!1,c=c||!1;var i=t.find(".attribute_options"),r=i.length,l=c?{}:[],d="";return 0===r?"":(i.each(function(t){var e=jQuery(this),i=e.find("select"),n=i.data("attribute_name")||i.attr("name"),o=e.data("attribute_label"),s=i.val();if(!c&&""===s)return d="",!(l=[]);var _=c?n:o,a=c?s:e.find("select option:selected").text();c?l[_]=a:l.push({meta_key:_,meta_value:a}),d=d+'<span class="meta_element"><span class="meta_key">'+_+':</span> <span class="meta_value">'+a+"</span>",t!==r-1&&(d+='<span class="meta_element_sep">, </span>'),d+="</span>"}),e?d:l)}jQuery.fn.wc_cp_is_in_viewport=function(t,e,i){var n=$wc_cp_window;if(!(this.length<1)){var o=1<this.length?this.eq(0):this,s=o.get(0),_=n.width(),a=n.height(),c=!0!==e||s.offsetWidth*s.offsetHeight;if(i=i||"vertical","function"==typeof s.getBoundingClientRect){var r=s.getBoundingClientRect(),l=0<=r.top&&r.top<a,d=0<r.bottom&&r.bottom<=a,p=r.top<0&&r.bottom>a,u=0<=r.left&&r.left<_,m=0<r.right&&r.right<=_,h=t?l||d||p:l&&d,g=t?u||m:u&&m;if("both"===i)return c&&h&&g;if("vertical"===i)return c&&h;if("horizontal"===i)return c&&g}else{var v=n.scrollTop(),f=v+a,b=n.scrollLeft(),w=b+_,y=o.offset(),$=y.top,k=$+o.height(),x=y.left,C=x+o.width(),q=!0===t?k:$,z=!0===t?$:k,S=!0===t?C:x,T=!0===t?x:C;if("both"===i)return!!c&&z<=f&&v<=q&&T<=w&&b<=S;if("vertical"===i)return!!c&&z<=f&&v<=q;if("horizontal"===i)return!!c&&T<=w&&b<=S}}},jQuery.fn.wc_get_composite_script=function(){var t=jQuery(this);if(!t.hasClass("composite_form"))return!1;var e=t.data("script_id");return void 0!==wc_cp_composite_scripts[e]&&wc_cp_composite_scripts[e]},function(E,s){var m={};function a(t){var u=this;this.composite_id=t.$composite_data.data("container_id"),this.$composite_data=t.$composite_data,this.$composite_form=t.$composite_form,this.$composite_add_to_cart_button=t.$composite_form.find(".composite_add_to_cart_button"),this.$composite_navigation=t.$composite_form.find(".composite_navigation"),this.$composite_navigation_top=t.$composite_form.find(".composite_navigation.top"),this.$composite_navigation_bottom=t.$composite_form.find(".composite_navigation.bottom"),this.$composite_navigation_movable=t.$composite_form.find(".composite_navigation.movable"),this.$composite_pagination=t.$composite_form.find(".composite_pagination"),this.$composite_summary=t.$composite_form.find(".composite_summary"),this.$composite_summary_widget=E(".widget_composite_summary").filter(function(){return 0<E(this).find(".widget_composite_summary_content_"+u.composite_id).length}),this.$components=t.$composite_form.find(".composite_component"),this.$steps={},this.$composite_availability=t.$composite_data.find(".composite_availability"),this.$composite_price=t.$composite_data.find(".composite_price"),this.$composite_message=t.$composite_data.find(".composite_message"),this.$composite_button=t.$composite_data.find(".composite_button"),this.$composite_quantity=this.$composite_button.find("input.qty"),this.$composite_status=t.$composite_form.find(".composite_status"),this.$composite_transition_helper=t.$composite_form.find(".scroll_show_component"),this.$composite_form_blocker=t.$composite_form.find(".form_input_blocker"),this.timers={on_resize_timer:!1},this.ajax_url="yes"===wc_composite_params.use_wc_ajax?woocommerce_params.wc_ajax_url:woocommerce_params.ajax_url,this.debug_tab_count=0,this.settings=t.$composite_data.data("composite_settings"),this.is_initialized=!1,this.is_finalized=!1,this.has_transition_lock=!1,this.blocked_elements=[],this.steps=[],this.step_factory=new m.WC_CP_Step_Factory,this.scenarios=new m.WC_CP_Scenarios_Manager(this),this.actions=new m.WC_CP_Actions_Dispatcher(this),this.filters=new m.WC_CP_Filters_Manager,this.router=!1,this.data_model=!1,this.view_classes=new m.WC_CP_Views(this),this.model_classes=new m.WC_CP_Models(this),this.composite_viewport_scroller=!1,this.composite_summary_view=!1,this.composite_pagination_view=!1,this.composite_navigation_view=!1,this.composite_validation_view=!1,this.composite_availability_view=!1,this.composite_price_view=!1,this.composite_add_to_cart_button_view=!1,this.composite_summary_widget_views=[],this.api={navigate_to_step:function(t){var e=u.get_step_by("id",t);if(!1===e)return!1;u.navigate_to_step(e)},show_previous_step:function(){u.show_previous_step()},show_next_step:function(){u.show_next_step()},get_steps:function(){return u.get_steps()},get_components:function(){return u.get_components()},get_step:function(t){return u.get_step(t)},get_step_by:function(t,e){return u.get_step_by(t,e)},get_step_title:function(t){var e=u.get_step_by("id",t);return!1!==e&&e.get_title()},get_step_slug:function(t){var e=u.get_step_by("id",t);return!1!==e&&e.get_slug()},get_current_step:function(){return u.get_current_step()},get_previous_step:function(){return u.get_previous_step()},get_next_step:function(){return u.get_next_step()},get_composite_totals:function(){return u.data_model.get("totals")},get_composite_stock_status:function(){return u.data_model.get("is_in_stock")?"in-stock":"out-of-stock"},get_composite_availability:function(){var t=u.composite_availability_view.get_components_availability_string();return""===t&&!1!==u.composite_availability_view.$composite_stock_status&&(t=u.composite_availability_view.$composite_stock_status.clone().wrap("<div></div>").parent().html()),t},get_composite_validation_status:function(){return u.data_model.get("passes_validation")?"pass":"fail"},get_composite_validation_messages:function(){return u.data_model.get("validation_messages")},get_composite_configuration:function(){var t={},e=u.get_components();if(0===e.length)return!1;for(var i=0,n=e.length;i<n;i++){var o=e[i],s=u.api.get_component_configuration(o.component_id);t[o.component_id]=s}return t},get_component_totals:function(t){return!1!==u.get_step_by("id",t)&&u.data_model.get("component_"+t+"_totals")},get_component_stock_status:function(t){var e=u.get_step_by("id",t);return!1!==e&&(e.step_validation_model.get("is_in_stock")?"in-stock":"out-of-stock")},get_component_availability:function(t){var e=u.get_step_by("id",t);if(!1===e)return!1;var i=e.$component_summary_content.find(".component_wrap .stock");return 0<i.length?i.clone().wrap("<div></div>").parent().html():""},get_component_validation_status:function(t){var e=u.get_step_by("id",t);return!1!==e&&(e.step_validation_model.get("passes_validation")?"pass":"fail")},get_component_validation_messages:function(t,e){var i=u.get_step_by("id",t);return!1!==i&&("composite"===e?i.step_validation_model.get("composite_messages"):i.step_validation_model.get("component_messages"))},get_component_configuration:function(t){var e=u.get_step_by("id",t),i=!1;return!1===e?i:(i={title:e.get_title(),selection_title:e.get_selected_product_title(!1),selection_meta:e.get_selected_product_meta(!1),product_id:e.get_selected_product(!1),variation_id:e.get_selected_variation(!1),product_valid:e.is_selected_product_valid(),variation_valid:e.is_selected_variation_valid(),quantity:e.get_selected_quantity(),product_type:e.get_selected_product_type()},i=u.filters.apply_filters("component_configuration",[i,e]))},is_priced_per_product:function(){u.console_log("error","\nMethod 'WC_CP_Composite::api::is_priced_per_product' is deprecated since v3.7.0. Use 'WC_CP_Composite::api::is_component_priced_individually' instead.")},is_component_priced_individually:function(t){return"yes"===u.data_model.price_data.is_priced_individually[t]}},this.init=function(){u.$composite_data.trigger("wc-composite-initializing",[u]),this.actions.add_action("initialize_composite",function(){u.init_steps()},10,this).add_action("initialize_composite",function(){u.init_models()},20,this).add_action("initialize_composite",function(){u.actions.init()},30,this).add_action("initialize_composite",function(){u.on_resize_handler()},40,this).add_action("initialize_composite",function(){u.init_views()},50,this).add_action("initialize_composite",function(){u.scenarios.init()},60,this).add_action("initialize_composite",function(){u.console_log("debug:events","\nInitializing Options:"),u.debug_indent_incr();for(var t=0,e=u.get_components(),i=e.length;t<i;t++)e[t].component_options_model.refresh_options_state();u.debug_indent_decr(),u.console_log("debug:events","\nDone.")},61,this).add_action("initialize_composite",function(){u.console_log("debug:events","\nValidating Steps:"),u.debug_indent_incr();for(var t=0,e=u.get_steps(),i=e.length;t<i;t++)e[t].validate();u.debug_indent_decr(),u.console_log("debug:events","\nValidation complete.")},70,this).add_action("initialize_composite",function(){u.get_current_step().show_step()},80,this).add_action("initialize_composite",function(){u.init_router()},90,this),this.actions.do_action("initialize_composite"),u.is_initialized=!0,this.actions.add_action("composite_initialized",function(){u.data_model.init()},10,this).add_action("composite_initialized",function(){u.render_views()},20,this),this.actions.do_action("composite_initialized"),u.is_finalized=!0},this.init_router=function(){var t=s.Router.extend({has_initial_route:!1,is_initial_route:!1,is_history_started:!1,routes:{":step_slug":"show_step"},show_step:function(t){var e=encodeURIComponent(t),i=u.get_step_by("slug",e);i&&(this.is_history_started||(this.has_initial_route=!0,this.is_initial_route=!0),i.is_locked()?(u.console_log("warning",wc_composite_params.i18n_step_not_accessible.replace(/%s/g,i.get_title())),u.router.navigate(u.get_current_step().get_slug())):(this.is_history_started&&u.composite_viewport_scroller.scroll_viewport(u.$composite_form,{timeout:0,partial:!1,duration:0,queue:!1}),i.show_step()))},navigate_to_step:function(t){this.is_initial_route=!1,t.show_step(),this.is_routing()&&this.navigate(t.get_slug())},update_history:function(){return"yes"===u.settings.update_browser_history},is_routing:function(){return this.update_history()&&u.is_initialized&&!1===this.is_initial_route},start:function(){this.update_history()&&$wc_cp_body.hasClass("single-product")&&$wc_cp_body.hasClass("postid-"+u.composite_id)&&!u.$composite_form.parent().hasClass("quick-view-content")&&(this.is_history_started||(s.history.start(),this.is_history_started=!0,"single"===u.settings.layout||!1!==this.has_initial_route||window.location.hash||this.navigate(u.get_current_step().get_slug(),{trigger:!1})))}});u.router=new t,u.router.start()},this.init_steps=function(){u.console_log("debug:events","\nInitializing Steps..."),"paged"===u.settings.layout?"componentized"===u.settings.layout_variation?(u.$composite_form.find(".multistep.active").removeClass("active"),u.$composite_data.addClass("multistep active")):u.$composite_data.prev().hasClass("multistep")?(u.$composite_data.addClass("multistep"),u.$composite_data.hide(),"no"===u.settings.update_browser_history&&u.$composite_data.hasClass("composite_added_to_cart")&&(u.$composite_form.find(".multistep.active").removeClass("active"),u.$composite_data.addClass("active"))):(u.$composite_data.show(),u.$composite_data.find(".component_title .step_index").hide()):"progressive"===u.settings.layout?(u.$components.show(),u.$composite_data.show()):"single"===u.settings.layout&&(u.$components.show(),u.$composite_data.show()),u.$steps=u.$composite_form.find(".multistep"),u.$composite_form.find(".composite_component, .multistep").each(function(t){var e=u.step_factory.create_step(u,E(this),t);u.steps[t]=e}),u.$composite_navigation.removeAttr("style")},this.get_ajax_url=function(t){return"yes"===wc_composite_params.use_wc_ajax?this.ajax_url.toString().replace("%%endpoint%%",t):this.ajax_url},this.navigate_to_step=function(t){"object"==typeof t&&"function"==typeof t.show_step&&this.router.navigate_to_step(t)},this.show_previous_step=function(){for(var t=0,e=u.get_steps(),i=e.length;t<i;t++)if(e[t].is_previous()){u.navigate_to_step(e[t]);break}},this.show_next_step=function(){for(var t=0,e=u.get_steps(),i=e.length;t<i;t++)if(e[t].is_next()){u.navigate_to_step(e[t]);break}},this.get_steps=function(){return this.steps},this.get_components=function(){for(var t=[],e=0,i=u.get_steps(),n=i.length;e<n;e++)i[e].is_component()&&t.push(i[e]);return t},this.get_step=function(t){for(var e=!1,i=0,n=u.get_steps(),o=n.length;i<o;i++)if(n[i].step_id==t){e=n[i];break}return e},this.get_step_by=function(t,e){var i=!1;if("id"!==t&&"index"!==t&&"slug"!==t)return!1;for(var n=0,o=u.get_steps(),s=o.length;n<s;n++)if("id"===t&&String(o[n].step_id)===String(e)||"index"===t&&String(n)===String(e)||"slug"===t&&String(o[n].get_slug()).toUpperCase()===String(e).toUpperCase()){i=o[n];break}return i},this.get_current_step=function(){for(var t=!1,e=0,i=u.get_steps(),n=i.length;e<n;e++)if(i[e].is_current()){t=i[e];break}return t},this.set_current_step=function(t){var e=this.settings.layout,i=this.settings.layout_variation,n=this.get_current_step(),o=this.get_next_step(),s=this.get_previous_step(),_=this.get_last_step(),a=!1,c=!1,r=!1;if("paged"===e&&"componentized"===i)a=c=r=this.get_step_by("id","review");else for(var l=0,d=u.get_steps(),p=d.length;l<p;l++)!1===a&&d[l].step_index>t.step_index&&d[l].is_visible()&&(a=d[l]),d[l].step_index<t.step_index&&d[l].is_visible()&&(c=d[l]),d[l].is_visible()&&(r=d[l]);n._is_current=!1,t._is_current=!0,n.$el.removeClass("active"),t.$el.addClass("active"),!1!==o&&(o._is_next=!1,o.$el.removeClass("next")),!1!==a&&(a._is_next=!0,a.$el.addClass("next")),!1!==s&&(s._is_previous=!1,s.$el.removeClass("prev")),!1!==c&&(c._is_previous=!0,c.$el.addClass("prev")),!1!==_&&(_._is_last=!1,_.$el.removeClass("last")),!1!==r&&(r._is_last=!0,r.$el.addClass("last"))},this.get_previous_step=function(){for(var t=!1,e=0,i=u.get_steps(),n=i.length;e<n;e++)if(i[e].is_previous()){t=i[e];break}return t},this.get_next_step=function(){for(var t=!1,e=0,i=u.get_steps(),n=i.length;e<n;e++)if(i[e].is_next()){t=i[e];break}return t},this.get_last_step=function(){for(var t=!1,e=0,i=u.get_steps(),n=i.length;e<n;e++)if(i[e].is_last()){t=i[e];break}return t},this.on_resize_handler=function(){var t=u.$composite_form.width();if(t<=wc_composite_params.small_width_threshold?u.$composite_form.addClass("small_width"):u.$composite_form.removeClass("small_width"),t>wc_composite_params.full_width_threshold?u.$composite_form.addClass("full_width"):u.$composite_form.removeClass("full_width"),wc_composite_params.legacy_width_threshold&&(t<=wc_composite_params.legacy_width_threshold?u.$composite_form.addClass("legacy_width"):u.$composite_form.removeClass("legacy_width")),u.is_initialized)for(var e=0,i=u.get_components(),n=i.length;e<n;e++)if(i[e].component_selection_view.is_relocated()){var o=i[e].component_selection_view.get_new_relocation_data();if(o.relocate){var s=i[e].component_selection_view.$relocation_target;o.reference.after(s)}}},this.init_models=function(){for(var t=0,e=u.get_steps(),i=e.length;t<i;t++){var n=e[t];n.step_visibility_model=new u.model_classes.Step_Visibility_Model(n),n.step_validation_model=new u.model_classes.Step_Validation_Model(n),n.step_access_model=new u.model_classes.Step_Access_Model(n)}for(var o=0,s=u.get_components(),_=s.length;o<_;o++){var a=s[o];a.component_options_model=new u.model_classes.Component_Options_Model(a),a.component_selection_model=new u.model_classes.Component_Selection_Model(a)}u.data_model=new u.model_classes.Composite_Data_Model},this.init_views=function(){u.console_log("debug:events","\nInitializing Views..."),this.composite_validation_view=new u.view_classes.Composite_Validation_View({is_in_widget:!1,el:u.$composite_message,model:u.data_model}),this.composite_price_view=new u.view_classes.Composite_Price_View({is_in_widget:!1,el:u.$composite_price,model:u.data_model}),this.composite_availability_view=new u.view_classes.Composite_Availability_View({is_in_widget:!1,el:u.$composite_availability,model:u.data_model}),this.composite_add_to_cart_button_view=new u.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:!1,el:u.$composite_button,$el_button:u.$composite_add_to_cart_button,model:u.data_model}),this.composite_status_view=new u.view_classes.Composite_Status_View({el:u.$composite_status,$el_content:u.$composite_status.find(".wrapper"),model:u.data_model}),0<u.$composite_pagination.length&&(u.composite_pagination_view=new u.view_classes.Composite_Pagination_View({el:u.$composite_pagination})),0<u.$composite_summary.length&&(u.composite_summary_view=new u.view_classes.Composite_Summary_View({is_in_widget:!1,el:u.$composite_summary})),0<u.$composite_navigation.length&&(u.composite_navigation_view=new u.view_classes.Composite_Navigation_View({el:u.$composite_navigation})),0<u.$composite_summary_widget.length&&u.$composite_summary_widget.each(function(t,e){u.composite_summary_widget_views.push(new u.view_classes.Composite_Widget_View({widget_count:t+1,el:e}))}),u.composite_viewport_scroller=new u.view_classes.Composite_Viewport_Scroller;for(var t=0,e=u.get_steps(),i=e.length;t<i;t++){var n=e[t];n.validation_view=new u.view_classes.Step_Validation_View(n,{el:n.$component_message,model:n.step_validation_model}),n.step_title_view=new u.view_classes.Step_Title_View(n,{el:n.$step_title})}for(var o=0,s=u.get_components(),_=s.length;o<_;o++){var a=s[o];a.component_selection_view=new u.view_classes.Component_Selection_View(a,{el:a.$component_content,model:a.component_selection_model}),a.component_options_view=new u.view_classes.Component_Options_View(a,{el:a.$component_options,model:a.component_options_model}),a.component_pagination_view=new u.view_classes.Component_Pagination_View(a,{el:a.$component_pagination,model:a.component_options_model})}},this.render_views=function(){u.console_log("debug:views","\nRendering Views..."),u.debug_indent_incr();for(var t=0,e=u.get_components(),i=e.length;t<i;t++){var n=e[t];n.component_selection_view.render_default(),n.component_options_view.render(),n.component_pagination_view.render()}for(var o=0,s=u.get_steps(),_=s.length;o<_;o++){var a=s[o];a.step_title_view.render_navigation_state(),a.step_title_view.render_index()}!1!==u.composite_pagination_view&&u.composite_pagination_view.render(),!1!==u.composite_summary_view&&u.composite_summary_view.render(),!1!==u.composite_navigation_view&&u.composite_navigation_view.render("transition");for(var c=0,r=u.composite_summary_widget_views,l=r.length;c<l;c++)r[c].composite_summary_view.render();u.debug_indent_decr(),u.console_log("debug:views","\nRendering complete."),u.$composite_form.removeClass("cp-no-js"),u.$composite_form.find(".cp-no-js-msg").remove()},this.block=function(t){var e=t.attr("id");e=e||t.attr("class"),this.blocked_elements.push(e),1===this.blocked_elements.length&&(this.$composite_form.block(wc_cp_block_params),u.has_transition_lock=!0)},this.unblock=function(t){var e=t.attr("id");e=e||t.attr("class"),this.blocked_elements=_.without(this.blocked_elements,e),0===this.blocked_elements.length&&(this.$composite_form.unblock(),u.has_transition_lock=!1)},this.console_log=function(t,e){if(window.console&&void 0!==e){var i=!1,n=!1,o=!1;if("error"===t)n=i=!0;else if("warning"===t)o=i=!0;else if(0<wc_composite_params.script_debug_level.length)if(_.contains(wc_composite_params.script_debug_level,t))i=!0;else for(var s=0,a=wc_composite_params.script_debug_level.length;s<a;s++)if(-1<t.indexOf(wc_composite_params.script_debug_level[s])){i=!0;break}if(i){var c="";if("error"!==t)for(var r=u.debug_tab_count;0<r;r--)c+="\t";e="function"==typeof e.substring&&"\n"===e.substring(0,1)?e.replace("\n","\n"+c):c+e,n?window.console.error(e):o?window.console.warn(e):window.console.log(e)}}},this.debug_indent_incr=function(){this.debug_tab_count=this.debug_tab_count+2},this.debug_indent_decr=function(){this.debug_tab_count=this.debug_tab_count-2},this.allow_history_updates=function(){return u.console_log("warning","\nMethod 'WC_CP_Composite::allow_history_updates' is deprecated since v3.14.0. Use 'WC_CP_Composite::router::is_routing' instead."),u.router.is_routing()}}m.WC_CP_Models=function(U){this.Composite_Data_Model=function(t){return new(s.Model.extend({price_data:U.$composite_data.data("price_data"),$nyp:!1,initialize:function(){for(var t={passes_validation:!0,validation_messages:[],status_messages:[],is_in_stock:!0,stock_statuses:[],totals:{price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""}},e=0,i=U.get_components(),n=i.length;e<n;e++)t["component_"+i[e].component_id+"_totals"]={price:"",regular_price:"",price_incl_tax:"",price_excl_tax:""};this.set(t),this.price_data.suffix_exists=""!==wc_composite_params.price_display_suffix,this.price_data.suffix_contains_price_incl=-1<wc_composite_params.price_display_suffix.indexOf("{price_including_tax}"),this.price_data.suffix_contains_price_excl=-1<wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}"),U.actions.add_action("component_nyp_changed",this.nyp_changed_handler,10,this),U.actions.add_action("component_quantity_changed",this.quantity_changed_handler,20,this),U.actions.add_action("component_selection_changed",this.selection_changed_handler,30,this),U.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,30,this),U.actions.add_action("component_availability_changed",this.availability_changed_handler,10,this),U.actions.add_action("component_validation_message_changed",this.validation_status_changed_handler,10,this),U.actions.add_action("component_validation_status_changed",this.validation_status_changed_handler,10,this),U.actions.add_action("component_totals_changed",this.component_totals_changed_handler,10,this);var o=U.$composite_data.find(".nyp");0<o.length&&(this.$nyp=o,this.price_data.base_price=o.data("price"),U.$composite_data.on("woocommerce-nyp-updated-item",{model:this},function(t){var e=t.data.model;e.price_data.base_price=e.$nyp.data("price"),e.price_data.base_regular_price=e.$nyp.data("price"),e.calculate_totals()}))},init:function(){U.console_log("debug:models","\nInitializing composite data model..."),U.debug_indent_incr(),this.update_validation(),this.update_totals(),this.update_availability(),U.debug_indent_decr()},nyp_changed_handler:function(t){if(!U.is_initialized)return!1;this.update_totals(t)},selection_changed_handler:function(){if(!U.is_initialized)return!1;this.update_validation(),this.update_totals()},availability_changed_handler:function(){if(!U.is_initialized)return!1;this.update_availability()},selection_content_changed_handler:function(){if(!U.is_initialized)return!1;this.update_validation(),this.update_totals()},quantity_changed_handler:function(t){if(!U.is_initialized)return!1;this.update_totals(t)},validation_status_changed_handler:function(){this.update_validation()},component_totals_changed_handler:function(){this.calculate_totals()},update_validation:function(){var t=[],e=this.get_validation_status();this.is_purchasable()?t=this.get_validation_messages():t.push(wc_composite_params.i18n_unavailable_text),U.console_log("debug:models","\nUpdating 'Composite_Data_Model' validation state... Attribute count: \"validation_messages\": "+t.length+', Attribute: "passes_validation": '+(0===t.length).toString()),U.debug_indent_incr(),this.set({validation_messages:t,passes_validation:e}),U.debug_indent_decr()},get_validation_status:function(){var t=!0;if(!this.is_purchasable())return!1;for(var e=0,i=U.get_steps(),n=i.length;e<n;e++)if(!i[e].step_validation_model.get("passes_validation")){t=!1;break}return t},get_validation_messages:function(){for(var t=[],e=0,i=U.get_steps(),n=i.length;e<n;e++)for(var o=i[e].get_title(),s=0,_=i[e].get_validation_messages("composite"),a=_.length;s<a;s++)if(i[e].is_review())t.push({sources:!1,content:_[s].toString()});else{var c=!1;if(0<t.length)for(var r=0,l=t.length;r<l;r++)if(t[r].content===_[s]){var d=t[r].sources;d.push(o),t[r]={sources:d,content:_[s]},c=!0;break}c||t.push({sources:[o],content:_[s].toString()})}var p=[];if(0<t.length)for(var u=0,m=t.length;u<m;u++)if(!1===t[u].sources)p.push(t[u].content);else{var h=wc_cp_join(t[u].sources);p.push(wc_composite_params.i18n_validation_issues_for.replace("%c",h).replace("%e",t[u].content))}return p=U.filters.apply_filters("composite_validation_messages",[p])},is_purchasable:function(){return"no"!==this.price_data.is_purchasable},get_quantity:function(){return 0<U.$composite_quantity.length?parseInt(U.$composite_quantity.val(),10):1},update_availability:function(){for(var t=[],e=!0,i=0,n=U.get_components(),o=n.length;i<o;i++)t.push(n[i].step_validation_model.get("is_in_stock"));e=!_.contains(t,!1),U.console_log("debug:models","\nUpdating 'Composite_Data_Model' availability... Attribute: \"stock_statuses\": "+t.toString()+', Attribute: "is_in_stock": '+e.toString()),U.debug_indent_incr(),this.set({stock_statuses:t,is_in_stock:e}),U.debug_indent_decr()},update_totals:function(t){if(U.console_log("debug:models","\nUpdating 'Composite_Data_Model' totals..."),U.debug_indent_incr(),void 0===t){for(var e=0,i=U.get_components(),n=i.length;e<n;e++)this.update_component_prices(i[e]);this.calculate_subtotals()}else this.update_component_prices(t),this.calculate_subtotals(t);U.debug_indent_decr()},get_taxed_totals:function(t,e,i,n){n=void 0===n?1:n;var o=!(!i||void 0===i.incl)&&Number(i.incl),s=!(!i||void 0===i.excl)&&Number(i.excl),_={price:n*t,regular_price:n*e,price_incl_tax:n*t,price_excl_tax:n*t};return o&&s&&(_.price_incl_tax=wc_cp_number_round(_.price*o),_.price_excl_tax=wc_cp_number_round(_.price*s),"incl"===wc_composite_params.tax_display_shop?(_.price=_.price_incl_tax,_.regular_price=wc_cp_number_round(_.regular_price*o)):(_.price=_.price_excl_tax,_.regular_price=wc_cp_number_round(_.regular_price*s))),_},calculate_totals:function(t){var e=void 0===t?this.price_data:t;U.console_log("debug:models","\nAdding totals...");var i={price:e.base_price_totals.price,regular_price:e.base_price_totals.regular_price,price_incl_tax:e.base_price_totals.price_incl_tax,price_excl_tax:e.base_price_totals.price_excl_tax};e.base_display_price=i.price;for(var n=0,o=U.get_components(),s=o.length;n<s;n++){var _=void 0===t?this.get("component_"+o[n].component_id+"_totals"):t["component_"+o[n].component_id+"_totals"];i.price+=_.price,i.regular_price+=_.regular_price,i.price_incl_tax+=_.price_incl_tax,i.price_excl_tax+=_.price_excl_tax}return i=U.filters.apply_filters("composite_totals",[i]),void 0===t&&(U.debug_indent_incr(),this.set({totals:i}),U.debug_indent_decr()),i},calculate_subtotals:function(t,e,i){var n=void 0===e?this.price_data:e;if(i=void 0===i?1:parseInt(i,10),!1===(t=void 0!==t&&t)){var o=Number(n.base_price),s=Number(n.base_regular_price),_=n.base_price_tax_ratios;n.base_price_totals=this.get_taxed_totals(o,s,_,i)}for(var a=0,c=U.get_components(),r=c.length;a<r;a++)if(!1===t||t.component_id===c[a].component_id){var l=n.quantities[c[a].component_id]*i,d=this.calculate_component_subtotals(c[a],n,l);void 0===e?(U.console_log("debug:models","Updating 'Composite_Data_Model' component totals... Attribute: \"component_"+c[a].component_id+'_totals".'),U.debug_indent_incr(),this.set("component_"+c[a].component_id+"_totals",d),U.debug_indent_decr()):n["component_"+c[a].component_id+"_totals"]=d}if(void 0!==e)return n},calculate_component_subtotals:function(t,e,i){var n=void 0===e?this.price_data:e,o="variable"===t.get_selected_product_type()?t.get_selected_variation(!1):t.get_selected_product(!1),s=n.price_tax_ratios[t.component_id],_=n.regular_prices[t.component_id]+n.addons_prices[t.component_id],a=n.prices[t.component_id]+n.addons_prices[t.component_id],c={price:0,regular_price:0,price_incl_tax:0,price_excl_tax:0};return U.console_log("debug:models",'Calculating "'+t.get_title()+'" totals...'),"yes"===wc_composite_params.calc_taxes?0<o&&0<i&&(0<a||0<_)&&(c=this.get_taxed_totals(a,_,s,i)):(c.price=i*a,c.regular_price=i*_,c.price_incl_tax=i*a,c.price_excl_tax=i*a),U.filters.apply_filters("component_totals",[c,t,i])},update_component_prices:function(t){U.console_log("debug:models",'Fetching "'+t.get_title()+'" price data...');var e=t.get_selected_quantity();this.price_data.prices[t.component_id]=t.component_selection_model.get_price(),this.price_data.regular_prices[t.component_id]=t.component_selection_model.get_regular_price(),this.price_data.price_tax_ratios[t.component_id]=t.component_selection_model.get_tax_ratios(),this.price_data.addons_prices[t.component_id]=Number(t.component_selection_model.get_addons_price()),this.price_data.quantities[t.component_id]=0<e?parseInt(e,10):0},add_status_message:function(t,e){var i=E.extend(!0,[],this.get("status_messages"));i.push({message_source:t,message_content:e}),U.console_log("debug:models",'Adding "'+t+'" status message: "'+e+'"...'),this.set({status_messages:i})},remove_status_message:function(e){U.console_log("debug:models",'Removing "'+e+'" status message...');var t=_.filter(this.get("status_messages"),function(t){return t.message_source!==e});this.set({status_messages:t})}}))(t)},this.Step_Access_Model=function(t,e){var o=t;return new(s.Model.extend({is_lockable:!1,initialize:function(){if(this.set({is_locked:!1}),this.is_lockable="single"!==U.settings.layout&&("componentized"!==U.settings.layout_variation||"yes"===U.settings.sequential_componentized_progress&&!1===o.is_review()),this.is_lockable)for(var t=0,e=U.get_steps(),i=e.length;t<i;t++)e[t].is_review()||e[t].step_index<o.step_index&&(this.listenTo(e[t].step_validation_model,"change:passes_validation",this.update_lock_state),this.listenTo(e[t].step_access_model,"change:is_locked",this.update_lock_state));this.listenTo(o.step_visibility_model,"change:is_visible",this.update_lock_state)},update_lock_state:function(){var t=!1;if(!1===o.is_visible())t=!0;else if(this.is_lockable)for(var e=0,i=U.get_steps(),n=i.length;e<n&&i[e].step_index!==o.step_index;e++)if(!1!==i[e].is_visible()){if(i[e].step_access_model.get("is_locked")){t=!0;break}if(!1===i[e].step_validation_model.get("passes_validation")){t=!0;break}}U.console_log("debug:models","\nUpdating 'Step_Access_Model': \""+o.get_title()+'", Attribute: "is_locked": '+t.toString()),this.get("is_locked")!==t?U.console_log("debug:models","Lock state changed.\n"):U.console_log("debug:models","Lock state unchanged.\n"),U.debug_indent_incr(),this.set({is_locked:t}),U.debug_indent_decr()}}))(e)},this.Step_Validation_Model=function(t,e){var n=t;return new(s.Model.extend({initialize:function(){this.set({passes_validation:!0,is_in_stock:!0,component_messages:[],composite_messages:[]}),U.actions.add_action("component_quantity_changed",this.quantity_changed_handler,10,this),U.actions.add_action("component_selection_changed",this.selection_changed_handler,20,this),U.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,20,this)},addons_changed_handler:function(t){if(U.is_initialized){if(t.step_id!==n.step_id)return;n.validate()}},quantity_changed_handler:function(t){if(U.is_initialized){if(t.step_id!==n.step_id)return;n.validate()}},selection_changed_handler:function(){if(U.is_initialized){if(n.is_component()&&n.component_selection_model.has_pending_updates())return;n.validate()}},selection_content_changed_handler:function(t){if(U.is_initialized){if(t.step_id!==n.step_id)return;n.validate()}},update:function(t,e){var i={passes_validation:t,is_in_stock:e,component_messages:n.get_validation_messages("component"),composite_messages:n.get_validation_messages("composite")};U.console_log("debug:models","\nUpdating 'Step_Validation_Model': \""+n.get_title()+'", Attribute: "passes_validation": '+i.passes_validation.toString()+', Attribute: "is_in_stock": '+i.is_in_stock.toString()),this.get("passes_validation")!==i.passes_validation?U.console_log("debug:models","Validation state changed.\n"):U.console_log("debug:models","Validation state unchanged.\n"),_.isEqual(this.get("component_messages"),i.component_messages)?U.console_log("debug:models","Validation message unchanged.\n"):U.console_log("debug:models","Validation message changed.\n"),this.get("is_in_stock")!==i.is_in_stock?U.console_log("debug:models","Stock state changed.\n"):U.console_log("debug:models","Stock state unchanged.\n"),U.debug_indent_incr(),this.set(i),U.debug_indent_decr()}}))(e)},this.Step_Visibility_Model=function(t,e){var i=t;return new(s.Model.extend({recursing:!1,initialize:function(){this.set({is_visible:!0}),i.is_component()&&U.actions.add_action("hidden_components_changed",this.update_visibility_state,10,this)},update_visibility_state:function(){var t=!0;U.console_log("debug:models",'\nUpdating "'+i.get_title()+'" visibility...'),U.scenarios.is_component_hidden(i.step_id)&&(t=!1),U.debug_indent_incr(),U.console_log("debug:models","\nUpdating 'Step_Visibility_Model': \""+i.get_title()+'", Attribute: "is_visible": '+t.toString()),this.get("is_visible")!==t?U.console_log("debug:models","Visibility state changed.\n"):U.console_log("debug:models","Visibility state unchanged.\n"),U.debug_indent_incr(),this.recursing?U.console_log("error","\nStep visibility model recursion detected. Stepping out..."):(this.recursing=!0,this.set({is_visible:t})),this.recursing=!1,U.debug_indent_decr(),U.debug_indent_decr()}}))(e)},this.Component_Options_Model=function(t,e){var M=t;return new(s.Model.extend({available_options_data:[],xhr:!1,initialize:function(){this.available_options_data=M.find_options_data();var t=[];0<this.available_options_data.length&&(t=_.pluck(this.available_options_data,"option_id"));var e={filters:M.find_active_filters(),orderby:M.find_order_by(),page:M.find_pagination_param("page"),pages:M.find_pagination_param("pages"),available_options:t,active_options:t.slice(),options_state:{active:_.pluck(_.where(this.available_options_data,{is_in_view:!0}),"option_id"),inactive:[]},options_in_scenarios:U.scenarios.clean_masked_scenarios(U.scenarios.get_scenarios_by_type("compat_group"),M.component_id)};this.set(e),U.actions.add_action("component_selection_changed",this.component_selection_changed_handler,15,this),U.actions.add_action("available_options_changed_"+M.step_id,this.available_options_changed_handler,10,this),"single"!==U.settings.layout&&U.actions.add_action("active_step_changed_"+M.step_id,this.active_step_changed_handler,10,this)},active_step_changed_handler:function(){U.is_initialized&&this.refresh_options_state()},available_options_changed_handler:function(){this.refresh_options_state()},component_selection_changed_handler:function(t){if(U.settings.layout&&M.step_index<t.step_index)return!1;this.refresh_options_state()},reload_options_on_scenarios_change:function(){var t=!1;return M.hide_disabled_products()&&M.has_options_style("thumbnails")&&M.get_max_results()>M.get_results_per_page()&&(!1===M.append_results()?t=!0:_.pluck(_.where(this.available_options_data,{is_in_view:!0}),"option_id").length<M.get_max_results()&&(t=!0)),t},request_options:function(t,e){var i=this;this.set(_.omit(t,"page"));var n={action:"woocommerce_show_component_options",component_id:M.component_id,composite_id:U.composite_id,load_page:t.page?t.page:1,selected_option:M.get_selected_product(!1),filters:this.get("filters"),orderby:this.get("orderby"),options_in_scenarios:this.reload_options_on_scenarios_change()?this.get("options_in_scenarios"):[]};this.xhr&&this.xhr.abort(),this.xhr=E.post(U.get_ajax_url(n.action),n,function(t){i.trigger("component_options_data_loaded",t,e),"success"===t.result?"reload"===e?(i.available_options_data=t.options_data,U.scenarios.set_component_scenario_data(M.component_id,t.scenario_data),i.set(t.pagination_data),i.refresh_options(_.pluck(i.available_options_data,"option_id"))):"append"===e&&(i.available_options_data=_.union(_.where(i.available_options_data,{is_in_view:!0}),_.map(t.options_data,function(t){return _.extend(t,{is_appended:!0})})),U.scenarios.merge_component_scenario_data(M.component_id,t.scenario_data),i.set(t.pagination_data),i.refresh_options(_.pluck(i.available_options_data,"option_id")),i.available_options_data=_.map(i.available_options_data,function(t){return _.omit(t,"is_appended")})):window.alert(t.message),U.actions.do_action("component_options_loaded",[M])},"json")},get_option_data:function(t,e){var i=null,n=this;if(""!==t&&0<n.available_options_data.length)for(var o=0,s=n.available_options_data.length;o<s;o++)if(parseInt(n.available_options_data[o].option_id,10)===parseInt(t,10)){i=e?void 0!==n.available_options_data[o][e]?n.available_options_data[o][e]:null:n.available_options_data[o];break}return i},set_option_data:function(t,e,i){var n=this;if(""!==t&&0<n.available_options_data.length)for(var o=0,s=n.available_options_data.length;o<s;o++)if(parseInt(t,10)===parseInt(n.available_options_data[o].option_id,10)){i?n.available_options_data[o][i]=e:n.available_options_data[o]=e;break}},refresh_options:function(t){U.console_log("debug:models",'\nUpdating "'+M.get_title()+'" options: '+_.map(t,function(t){return""===t?"0":t})),U.debug_indent_incr(),_.isEqual(this.get("available_options"),t)?this.refresh_options_state():this.set({available_options:t}),U.debug_indent_decr()},refresh_options_state:function(){U.console_log("debug:models",'\nUpdating "'+M.get_title()+'" options state...'),U.debug_indent_incr();var t=[],e=[],i={active:[],inactive:[]},n=M.component_id,o=U.scenarios.get_scenario_data().scenario_data[n],s=!1,a=!1,c=!1;if(e=U.scenarios.calculate_active_scenarios("compat_group",M,!0,!0),U.console_log("debug:models","\nReference scenarios: ["+e+"]"),U.console_log("debug:models","Removing scenarios where the current component is masked..."),0===(e=U.scenarios.clean_masked_scenarios(e,n)).length&&e.push("0"),U.console_log("debug:models","\nUpdating 'Component_Options_Model': \""+M.get_title()+'", Attribute: "options_in_scenarios"...'),_.isEqual(this.get("options_in_scenarios"),e)?U.console_log("debug:models","\nActive options scenarios unchanged - ["+this.get("options_in_scenarios")+"] => ["+e+"].\n"):U.console_log("debug:models","\nActive options scenarios changed - ["+this.get("options_in_scenarios")+"] => ["+e+"].\n"),U.debug_indent_incr(),this.set({options_in_scenarios:e}),U.debug_indent_decr(),0 in o){for(var r=o[0],l=0,d=r.length;l<d;l++)if(-1<E.inArray(r[l],e)){s=!0;break}i.inactive.push("")}else!1===M.is_visible()&&(s=!0);s&&(U.console_log("debug:models","Component set as optional."),t.push(""),i.active.push(""));for(var p=0,u=this.available_options_data.length;p<u;p++){var m=this.available_options_data[p],h=m.option_id,g=h in o?o[h]:[],v=!1;U.console_log("debug:models","Updating selection #"+h+":"),U.console_log("debug:models","\tSelection in scenarios: ["+g+"]");for(var f=0,b=g.length;f<b;f++)if(-1<E.inArray(g[f],e)){v=!0;break}v?(U.console_log("debug:models","\tSelection enabled."),t.push(h),m.is_in_view&&i.active.push(h)):(U.console_log("debug:models","\tSelection disabled."),m.is_in_view&&i.inactive.push(h),M.get_selected_product(!1)===h&&(a=!0)&&U.console_log("debug:models","\t--- Selection invalid."))}if("variable"===M.get_selected_product_type()){var w,y,$,k=M.get_selected_variation(),x=M.component_selection_model.get_available_variations_data();U.console_log("debug:models","\tChecking variations..."),0<k&&U.console_log("debug:models","\t\t--- Stored variation is #"+k);for(var C=0,q=x.length;C<q;C++){$=!1,y=(w=x[C].variation_id.toString())in o?o[w]:[],U.console_log("debug:models","\t\tChecking variation #"+w+":"),U.console_log("debug:models","\t\tSelection in scenarios: ["+y+"]");for(var z=0,S=y.length;z<S;z++){var T=y[z];if(-1<E.inArray(T,e)){$=!0;break}}$?(U.console_log("debug:models","\t\tVariation enabled."),t.push(w),i.active.push(w)):(U.console_log("debug:models","\t\tVariation disabled."),i.inactive.push(w.toString()),M.get_selected_variation(!1).toString()===w&&(c=!0)&&U.console_log("debug:models","\t\t--- Selection invalid."))}}U.console_log("debug:models","Done.\n"),U.debug_indent_decr();var V=!0;"single"!==U.settings.layout&&!M.is_current()||(U.console_log("debug:models",'\nChecking current "'+M.get_title()+'" selections:'),c?(V=!1,U.console_log("debug:models","\nVariation selection invalid - resetting...\n\n"),U.debug_indent_incr(),M.component_selection_view.resetting_variation=!0,M.$component_summary_content.find(".reset_variations").trigger("click"),M.component_selection_view.resetting_variation=!1,U.debug_indent_decr()):a?U.console_log("debug:models","\nProduct selection invalid.\n\n"):U.console_log("debug:models","...looking good!")),V&&(_.isEqual(this.get("active_options"),t)?U.console_log("debug:models","\nActive options unchanged - ["+_.map(this.get("active_options"),function(t){return""===t?"0":t})+"] => ["+_.map(t,function(t){return""===t?"0":t})+"].\n"):U.console_log("debug:models","\nActive options changed - ["+_.map(this.get("active_options"),function(t){return""===t?"0":t})+"] => ["+_.map(t,function(t){return""===t?"0":t})+"].\n"),U.debug_indent_incr(),this.set({active_options:t}),U.debug_indent_decr(),_.isEqual(this.get("options_state"),i)?U.console_log("debug:models","\nOptions state unchanged.\n"):U.console_log("debug:models","\nOptions state changed.\n"),U.debug_indent_incr(),this.set({options_state:i}),U.debug_indent_decr())}}))(e)},this.Component_Selection_Model=function(t,e){var p=t;return new(s.Model.extend({selected_product_data:!1,initialize:function(){var t="",e=!1;if(0<p.component_options_model.available_options_data.length)for(var i=0,n=p.component_options_model.available_options_data.length;i<n;i++){var o=p.component_options_model.available_options_data[i];if(o.is_selected){t=o.option_id,e=E.extend(!0,{},o.option_product_data);break}}var s={selected_product:t,selected_variation:t&&"variable"===e.product_type?e.variation_id:"",selected_variation_data:!1,selected_quantity:0,selected_addons:!1,selected_nyp:0};this.selected_product_data=e,this.set(s),U.actions.add_action("component_options_state_changed_"+p.step_id,this.update_active_variations_data,0,this)},get_product_data:function(){return this.selected_product_data},get_product_image_data:function(){return this.selected_product_data.image_data||!1},get_variation_data:function(){return this.get("selected_variation_data")},get_variation_image_data:function(){var t=this.get("selected_variation"),e=this.get_available_variations_data(),i=!1;if(0<t&&e)for(var n=0,o=e.length;n<o;n++){var s=e[n];if(parseInt(s.variation_id,10)===parseInt(t,10)){s.image?i={image_src:s.image.src,image_srcset:s.image.srcset,image_sizes:s.image.sizes,image_title:s.image.title}:s.image_src&&(i={image_src:s.image_src,image_srcset:s.image_srcset,image_sizes:s.image_sizes,image_title:s.image_title});break}}return i},get_meta_data:function(){var t=[];return 0<this.get("selected_variation")&&(t=this.get_variation_data().meta_data||[]),t},get_available_variations_data:function(){return this.selected_product_data.variations_data||[]},get_active_variations_data:function(){return this.selected_product_data.active_variations_data||[]},get_type:function(){return this.selected_product_data.product_type||"none"},get_price:function(){return this.selected_product_data.price?Number(this.selected_product_data.price):0},set_price:function(t){this.selected_product_data.price=t},get_regular_price:function(){return this.selected_product_data.regular_price?Number(this.selected_product_data.regular_price):0},set_regular_price:function(t){this.selected_product_data.regular_price=t},get_addons_price:function(){return this.selected_product_data.addons_price?Number(this.selected_product_data.addons_price):0},set_addons_price:function(t){this.selected_product_data.addons_price=t},get_tax_ratios:function(){return this.selected_product_data.tax_ratios||!1},set_tax_ratios:function(t){this.selected_product_data.tax_ratios=t},get_details_html:function(){return this.selected_product_data.details_html||""},get_stock_status:function(){return this.selected_product_data.stock_status||""},set_stock_status:function(t){this.selected_product_data.stock_status=t},load_selection_data:function(e,i){i=i||!1;var n=this,t={action:"woocommerce_show_composited_product",product_id:e,component_id:p.component_id,composite_id:U.composite_id};E.ajax({type:"POST",url:U.get_ajax_url(t.action),data:t,timeout:15e3,dataType:"json",success:function(t){"success"===t.result?(U.console_log("debug:models","\nFetched 'Component_Selection_Model' data: \""+p.get_title()+'", Product ID: #'+(""===e?"0":e)),p.component_options_model.set_option_data(e,t.product_data,"option_product_data"),n.trigger("selected_product_data_loaded",e,t.product_data),i&&n.update_selected_product(e,t.product_data)):n.trigger("selected_product_data_load_error",e)},error:function(){n.trigger("selected_product_data_load_error",e)}})},update_selection:function(t){if(""!==t){var e=p.component_options_model.get_option_data(t,"option_product_data");e?this.update_selected_product(t,e):(U.console_log("debug:models","\nFetching 'Component_Selection_Model' data: \""+p.get_title()+'", Product ID: #'+(""===t?"0":t)),this.load_selection_data(t,!0))}else this.update_selected_product("",wc_composite_params.empty_product_data)},update_selected_product:function(t,e){if(this.selected_product_data=E.extend(!0,{},e),this.get("selected_product")!==t){var i=0;t&&(i="yes"===U.settings.component_qty_restore?this.get("selected_quantity"):1),U.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+p.get_title()+'", Attribute: "selected_product": #'+(""===t?"0":t)),U.debug_indent_incr(),this.set({selected_product:t,selected_variation:"",selected_variation_data:!1,selected_quantity:i,selected_addons:!1,selected_nyp:0}),U.debug_indent_decr(),this.trigger("selected_product_updated")}},update_selected_variation:function(t,e){this.get("selected_variation")===t&&_.isEqual(this.get("selected_variation_data"),e)||(U.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+p.get_title()+'", Attribute: "selected_variation": #'+(""===t?"0":t)),U.debug_indent_incr(),this.set({selected_variation:t,selected_variation_data:e}),U.debug_indent_decr(),this.trigger("selected_variation_updated"))},update_selected_quantity:function(t){this.get("selected_quantity")!==t&&(U.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+p.get_title()+'", Attribute: "selected_quantity": '+t),U.debug_indent_incr(),this.set({selected_quantity:t}),U.debug_indent_decr())},update_selected_addons:function(t,e){e=e||0,this.set_addons_price(e),this.get("selected_addons")!==t&&(U.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+p.get_title()+'", Attribute: "selected_addons"...'),U.debug_indent_incr(),this.set({selected_addons:t}),U.debug_indent_decr())},update_nyp:function(t){this.get("selected_nyp")!==t&&(U.console_log("debug:models","\nUpdating 'Component_Selection_Model': \""+p.get_title()+'", Attribute: "nyp_price": '+t),this.set_price(t),this.set_regular_price(t),U.debug_indent_incr(),this.set({selected_nyp:t}),U.debug_indent_decr())},update_active_variations_data:function(){if("variable"===this.get_type()){U.console_log("debug:models",'\nUpdating "'+p.get_title()+'" variations data...');for(var t,e,i,n=p.get_selected_variation(!1),o=p.component_options_model.get("options_state"),s=this.get_available_variations_data(),a=[],c=0,r=s.length;c<r;c++)if(t=s[c].variation_id.toString(),e=_.contains(o.active,t),!1===p.hide_disabled_variations()){var l=!1;if(i=E.extend(!0,{},s[c]),!e)for(var d in i.variation_is_active=!1,i.attributes)if(i.attributes.hasOwnProperty(d)&&""===i.attributes[d]){l=!0;break}l||a.push(i)}else e?a.push(s[c]):parseInt(n,10)===parseInt(t,10)&&((i=E.extend(!0,{},s[c])).variation_is_active=!1,a.push(i));this.selected_product_data.active_variations_data=a}},has_pending_updates:function(){return"variable"===this.get_type()&&!1===this.get_variation_data()}}))(e)}},m.WC_CP_Views=function(O){this.Composite_Viewport_Scroller=function(t){return new(s.View.extend({scroll_viewport_target:!1,initialize:function(){"single"===O.settings.layout?O.actions.add_action("show_step",this.autoscroll_single,10,this):"paged"===O.settings.layout?(O.actions.add_action("active_step_changed",this.autoscroll_paged,120,this),O.actions.add_action("active_step_transition_end",this.autoscroll_paged_relocated,10,this)):"progressive"===O.settings.layout&&O.actions.add_action("active_step_transition_end",this.autoscroll_progressive,10,this),O.actions.add_action("component_options_update_requested",this.component_options_update_requested,10,this),O.actions.add_action("component_selection_details_updated",this.selection_details_updated,10,this),O.actions.add_action("component_selection_details_animated",this.selection_details_animated,10,this),O.actions.add_action("component_selection_details_relocation_ended",this.selection_details_relocation_ended,10,this)},component_options_update_requested:function(t,e,i,n){"reload"===i&&!1===n&&O.composite_viewport_scroller.scroll_viewport(t.$component_pagination.filter(".top"),{offset:50,duration:200,partial:!0,queue:!1,on_complete:function(){O.is_finalized&&"yes"===wc_composite_params.accessible_focus_enabled&&t.$component_pagination.filter(".top").find(".woocommerce-result-count").focus()}})},selection_details_relocation_ended:function(t){t.component_selection_view.flushing_component_options&&setTimeout(function(){t.$component_content.slideDown(250),O.composite_viewport_scroller.scroll_viewport("relative",{offset:-t.$component_summary.outerHeight(!0),timeout:0,duration:250,queue:!1})},200)},selection_details_updated:function(t){O.is_finalized&&!t.can_autotransition()&&t.is_current()&&this.autoscroll_selection_details(t,"updated")},selection_details_animated:function(t){t.can_autotransition()||this.autoscroll_selection_details(t,"animated")},autoscroll_selection_details:function(t,e){var i=t.component_selection_view,n=!0,o=t.$component_content_scroll_target;if(""!==t.get_selected_product(!1)){if(i.is_relocated()){if("animated"!==e)return;o=i.$relocation_target,n=!1}else if("animated"===e)return;O.is_initialized&&O.composite_viewport_scroller.scroll_viewport(o,{timeout:50,duration:250,queue:!1,partial:n,scroll_method:"quarter",on_complete:function(){t.has_options_style("thumbnails")&&"yes"===wc_composite_params.accessible_focus_enabled&&t.$component_summary_content.find(".composited_product_title_wrapper").focus()}})}},autoscroll_single:function(t){O.is_initialized&&O.composite_viewport_scroller.scroll_viewport(t.$el,{partial:!1,duration:250,queue:!1})},autoscroll_paged:function(t){var e=O.is_initialized,i=t.is_component();i&&(!!i&&t).component_selection_view.is_relocated()||e&&O.composite_viewport_scroller.scroll_viewport(O.$composite_transition_helper,{timeout:20,partial:!1,duration:250,queue:!1})},autoscroll_paged_relocated:function(t){var e=O.is_initialized,i=t.is_component(),n=!!i&&t;i&&n.component_selection_view.is_relocated()&&e&&O.composite_viewport_scroller.scroll_viewport(n.$component_content,{timeout:0,partial:!1,duration:250,queue:!1,scroll_method:"middle"})},autoscroll_progressive:function(t){O.is_initialized&&t.$el.hasClass("autoscrolled")&&(t.$step_title.wc_cp_is_in_viewport(!1)||O.composite_viewport_scroller.scroll_viewport(t.$el,{timeout:0,partial:!1,duration:250,queue:!1}))},scroll_viewport:function(i,t){var n,o,s=void 0===t.partial||t.partial,_=void 0===t.offset?50:t.offset,e=void 0===t.timeout?5:t.timeout,a=void 0===t.duration?250:t.duration,c=void 0!==t.queue&&t.queue,r=void 0!==t.always_on_complete&&t.always_on_complete,l=void 0!==t.scroll_method&&t.scroll_method,d=!1,p=$wc_cp_window,u=$wc_cp_document;n=void 0===t.on_complete||!1===t.on_complete?function(){return!1}:t.on_complete;function m(){if("relative"===i)o=p.scrollTop()-_,d=!0;else if("absolute"===i)o=_,d=!0;else if(0<i.length&&i.is(":visible")&&!1===i.wc_cp_is_in_viewport(s)){var t=_;t="bottom"===l||i.hasClass("scroll_bottom")?p.height()-i.outerHeight(!0)-_:"middle"===l?p.height()/3*2-i.outerHeight(!0)-_:"quarter"===l?p.height()/4+_:parseInt(wc_composite_params.scroll_viewport_top_offset,10)+_,o=i.offset().top-t,i.offset().top<o&&(o=i.offset().top),d=!0}if(d){if(o>u.height()-p.height()&&(o=u.height()-p.height()-100),!this.scroll_viewport_target){var e=$wc_cp_html.scrollTop();this.scroll_viewport_target=$wc_cp_body,e?$wc_cp_html.scrollTop($wc_cp_html.scrollTop()-1):$wc_cp_html.scrollTop($wc_cp_html.scrollTop()+1),e!=$wc_cp_html.scrollTop()&&(this.scroll_viewport_target=$wc_cp_html)}O.console_log("debug:animations","\nStarting viewport auto-scrolling..."),this.scroll_viewport_target.animate({scrollTop:o},{duration:a,queue:c,complete:function(){O.console_log("debug:animations","\nEnded viewport auto-scrolling.")},always:n})}else r&&n()}0<e?setTimeout(function(){m()},e):m()},illusion_scroll:function(t){if(void 0===t||void 0===t.target||!t.target)return null;var e=t.target,i=$wc_cp_window.scrollTop(),n=void 0!==t.type?t.type:"hide",o=!0,s=0,_=0;if("hide"===n){if("none"===e.css("display"))return null}else if("none"!==e.css("display"))return null;return"hide"!==n&&e.css({height:"0",display:"block"}),(o=e.offset().top<i&&!1===e.wc_cp_is_in_viewport(!0))&&("hide"!==n&&e.css({height:"",position:"absolute"}),void 0===(_=e.get(0).getBoundingClientRect().height)&&(_=e.outerHeight()),o=1<=_),"hide"!==n&&e.css({height:"",position:"",display:"none"}),o&&(s="hide"===n?i-Math.round(_):i+Math.round(_),setTimeout(function(){window.scroll(0,s),"hide"===n?e.hide():e.show()},10)),o}}))(t)},this.Composite_Status_View=function(t){return new(s.View.extend({is_active:!1,template:!1,worker:!1,$el_content:!1,initialize:function(t){var i=this;this.template=wp.template("wc_cp_composite_status"),this.$el_content=t.$el_content,this.listenTo(this.model,"change:status_messages",this.status_changed);this.worker=new function(){var e=this;this.timer=!1,this.tasks=[],this.last_added_task=[],this.is_idle=function(){return!1===this.timer},this.work=function(){if(0<e.tasks.length){var t=e.tasks.shift();i.render(t),e.timer=setTimeout(function(){e.work()},400)}else clearTimeout(e.timer),e.timer=!1},this.add_task=function(e){var t=[];t=_.pluck(_.where(this.last_added_task,{is_old:!1}),"message_content").length<e.length?_.map(e,function(t){return{message_content:t,is_old:!1}}):_.map(_.where(this.last_added_task,{is_old:!1}),function(t){return{message_content:t.message_content,is_old:!1===_.contains(e,t.message_content)}}),this.last_added_task=t,this.tasks.push(t),_.where(t,{is_old:!0}).length===t.length&&this.tasks.push([])}}},render:function(t){var e=this;0===t.length?(O.console_log("debug:views","\nHiding composite status view..."),this.$el.removeClass("visible"),setTimeout(function(){e.$el.removeClass("active")},200),this.is_active=!1):(O.console_log("debug:views","\nUpdating composite status view..."),this.$el_content.html(this.template(t)),!1===this.is_active?(this.$el.addClass("active"),setTimeout(function(){e.$el.addClass("visible")},5),this.is_active=!0):setTimeout(function(){e.$el.find(".message:not(.current)").addClass("old")},100))},status_changed:function(){var t=this.model.get("status_messages");0<t.length?this.worker.add_task(_.pluck(t,"message_content")):this.worker.add_task([]),this.worker.is_idle()&&this.worker.work()}}))(t)},this.Composite_Validation_View=function(t){return new(s.View.extend({render_timer:!1,is_in_widget:!1,template:!1,initialize:function(t){this.template=wp.template("wc_cp_validation_message"),this.is_in_widget=t.is_in_widget,O.actions.add_action("composite_validation_message_changed",this.render,100,this)},render:function(){var t=this,e=this.model;O.console_log("debug:views","\nScheduled update of composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){O.console_log("debug:views","\nUpdating composite validation view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var e=t.get("validation_messages");!1===t.get("passes_validation")&&0<e.length?(this.$el.html(this.template(e)),this.$el.removeClass("inactive"),this.is_in_widget?this.$el.show():this.$el.slideDown(200)):(this.$el.addClass("inactive"),this.is_in_widget?this.$el.hide():this.$el.slideUp(200))}}))(t)},this.Composite_Price_View=function(t){return new(s.View.extend({render_timer:!1,is_in_widget:!1,suffix:"",suffix_contains_price_incl:!1,suffix_contains_price_excl:!1,$addons_totals:!1,show_addons_totals:!1,initialize:function(t){this.is_in_widget=t.is_in_widget,this.is_in_widget||"yes"!==wc_composite_params.is_pao_installed||(this.$addons_totals=O.$composite_data.find("#product-addons-total"),this.has_addons()?1==this.$addons_totals.data("show-sub-total")&&(this.$addons_totals.data("show-sub-total",0),this.$el.after(this.$addons_totals),this.show_addons_totals=!0,O.actions.add_action("composite_totals_changed",this.update_addons_totals,100,this),O.$composite_data.on("updated_addons",{view:this},this.updated_addons_handler)):this.$addons_totals=!1),""!==wc_composite_params.price_display_suffix&&(this.suffix=' <small class="woocommerce-price-suffix">'+wc_composite_params.price_display_suffix+"</small>",this.suffix_contains_price_incl=-1<wc_composite_params.price_display_suffix.indexOf("{price_including_tax}"),this.suffix_contains_price_excl=-1<wc_composite_params.price_display_suffix.indexOf("{price_excluding_tax}")),O.actions.add_action("composite_totals_changed",this.render,100,this),O.actions.add_action("composite_validation_status_changed",this.render,100,this)},has_addons:function(){return"yes"===wc_composite_params.is_pao_installed&&this.$addons_totals&&0<this.$addons_totals.length},updated_addons_handler:function(t){var e=t.data.view;e.render_task(e.model),t.stopPropagation()},get_addons_raw_price:function(){var t=0;if(!this.has_addons())return t;for(var e=this.$addons_totals.data("price_data"),i=O.data_model.price_data.base_price_tax_ratios,n=0,o=e.length;n<o;n++){var s=e[n];if(s.is_custom_price){var _=!(!i||void 0===i.incl)&&Number(i.incl),a=!(!i||void 0===i.excl)&&Number(i.excl);"incl"===wc_composite_params.tax_display_shop&&"no"===wc_composite_params.prices_include_tax?t+=s.cost_raw/(_||1):"excl"===wc_composite_params.tax_display_shop&&"yes"===wc_composite_params.prices_include_tax?t+=s.cost_raw/(a||1):t+=s.cost_raw}else"quantity_based"===s.price_type?t+=s.cost_raw_pu:"flat_fee"===s.price_type?t+=s.cost_raw:"percentage_based"===s.price_type&&(t+=s.cost_raw_pct*O.data_model.price_data.base_price)}return t},get_price_html:function(t){var e=this.model,i=void 0===t?e.price_data:t,n=void 0===t?e.get("totals"):t.totals,o=wc_composite_params.i18n_total?'<span class="total">'+wc_composite_params.i18n_total+"</span>":"",s="";if(this.has_addons()){i=E.extend(!0,{},i);var _=this.get_addons_raw_price();0<_&&(i.base_price=Number(i.base_price)+Number(_),i.base_regular_price=Number(i.base_regular_price)+Number(_),i=e.calculate_subtotals(!1,i,1),n=e.calculate_totals(i))}if(0===n.price&&"yes"===i.show_free_string)s=wc_composite_params.i18n_price_format.replace("%t",o).replace("%p",wc_composite_params.i18n_free).replace("%s","");else{var a=wc_cp_price_format(n.price),c=wc_cp_price_format(n.regular_price),r=this.get_formatted_price_suffix(n);n.regular_price>n.price&&(a=wc_composite_params.i18n_strikeout_price_string.replace("%f",c).replace("%t",a)),s=wc_composite_params.i18n_price_format.replace("%t",o).replace("%p",a).replace("%s",r)}return s='<p class="price">'+s+"</p>",O.filters.apply_filters("composite_price_html",[s,this,t])},get_formatted_price_suffix:function(t){var e=this.model,i=this.suffix;return t=void 0===t?e.get("totals"):t,""!==i&&(this.suffix_contains_price_incl&&(i=i.replace("{price_including_tax}",wc_cp_price_format(t.price_incl_tax))),this.suffix_contains_price_excl&&(i=i.replace("{price_excluding_tax}",wc_cp_price_format(t.price_excl_tax)))),i},render:function(){var t=this,e=this.model;O.console_log("debug:views","\nScheduled update of composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){var e=0===t.get("validation_messages").length&&(t.price_data.total!==t.price_data.base_display_price||"yes"===t.price_data.has_price_range),i=e&&t.get("passes_validation");if(O.console_log("debug:views","\nUpdating composite price view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),e){if(i){var n=this.get_price_html();this.$el.html(n),this.$el.removeClass("inactive"),this.is_in_widget?this.$el.show():this.$el.slideDown(200)}}else this.$el.addClass("inactive"),this.is_in_widget?this.$el.hide():this.$el.slideUp(200)}}))(t)},this.Composite_Availability_View=function(t){return new(s.View.extend({$composite_stock_status:!1,is_in_widget:!1,render_timer:!1,initialize:function(t){this.is_in_widget=t.is_in_widget,0<O.$composite_data.find(".composite_wrap p.stock").length&&(this.$composite_stock_status=O.$composite_data.find(".composite_wrap p.stock").clone()),O.actions.add_action("composite_availability_message_changed",this.render,100,this)},render:function(){var t=this,e=this.model;O.console_log("debug:views","\nScheduled update of composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){O.console_log("debug:views","\nUpdating composite availability view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var e=this.get_insufficient_stock_components();if(0<e.length){var i=wc_composite_params.i18n_insufficient_stock.replace("%s",wc_cp_join(_.map(e,function(t){return O.api.get_step_title(t)})));this.$el.html(i),this.is_in_widget?this.$el.show():this.$el.slideDown(200)}else!1!==this.$composite_stock_status?(this.$el.html(this.$composite_stock_status),this.is_in_widget?this.$el.show():this.$el.slideDown(200)):this.is_in_widget?this.$el.hide():this.$el.slideUp(200)},get_insufficient_stock_components:function(){for(var t=[],e=0,i=O.get_components(),n=i.length;e<n;e++)i[e].step_validation_model.get("is_in_stock")||t.push(i[e].component_id);return t}}))(t)},this.Composite_Add_To_Cart_Button_View=function(t){return new(s.View.extend({render_timer:!1,is_in_widget:!1,$el_button:!1,$el_qty:!1,widget_qty_synced:!1,initialize:function(t){var a=this.model;this.is_in_widget=t.is_in_widget,this.$el_button=t.$el_button,this.$el_qty=this.$el.find(".quantity input.qty"),O.actions.add_action("composite_availability_status_changed",this.render,100,this),O.actions.add_action("composite_validation_status_changed",this.render,100,this),this.is_in_widget||(-1<window.navigator.userAgent.indexOf("Edge")&&O.$composite_form.on("submit",function(){O.$composite_form.attr("action",window.location.href)}),this.$el_button.on("click",function(t){if(a.get("passes_validation")&&a.get("is_in_stock"))for(var e=0,i=O.get_steps(),n=i.length;e<n;e++){var o=i[e];if(o.$el.find("select, input").each(function(){E(this).prop("disabled",!1)}),o.is_component()){var s=o.has_addons();if(!s&&"bundle"===o.get_selected_product_type()){var _=o.get_bundle_script(o.component_id);_&&E.each(_.bundled_items,function(t,e){if(e.has_addons())return!(s=!0)})}s&&o.$component_summary_content.find(".wc-pao-required-addon [required]").prop("required",!1),!1===o.step_visibility_model.get("is_visible")&&o.$component_summary_content.append('<input name="wccp_component_selection_nil['+o.step_id+']" value="1"/>')}}else t.preventDefault(),window.alert(wc_composite_params.i18n_validation_issues)})),this.is_in_widget&&(this.$el_button.on("click",function(){O.composite_add_to_cart_button_view.$el_button.trigger("click")}),0<this.$el_qty.length&&(this.$el_qty.on("change",{view:this},function(t){var e=t.data.view;e.widget_qty_synced||(O.console_log("debug:views","\nCopying widget #"+e.is_in_widget+" quantity value into composite add-to-cart quantity field..."),e.widget_qty_synced=!0,O.composite_add_to_cart_button_view.$el_qty.val(e.$el_qty.val()).change(),e.widget_qty_synced=!1)}),O.composite_add_to_cart_button_view.$el_qty.on("change",{view:this},function(t){var e=t.data.view;O.console_log("debug:views","\nCopying composite add-to-cart quantity value into widget #"+e.is_in_widget+" quantity field..."),e.$el_qty.val(O.composite_add_to_cart_button_view.$el_qty.val()).change()})))},render:function(){var t=this,e=this.model;O.console_log("debug:views","\nScheduled update of composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render_task(e)},10)},render_task:function(t){O.console_log("debug:views","\nUpdating composite add-to-cart button view"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),0===t.get("validation_messages").length&&t.get("is_in_stock")?"new"===O.settings.button_behaviour||this.is_in_widget?this.$el_button.removeClass("disabled"):this.$el.slideDown(200):"new"===O.settings.button_behaviour||this.is_in_widget?this.$el_button.addClass("disabled"):this.$el.slideUp(200)}}))(t)},this.Composite_Pagination_View=function(t){return new(s.View.extend({template:!1,template_html:"",initialize:function(){this.template=wp.template("wc_cp_composite_pagination"),O.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),O.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this),O.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this),this.$el.on("click",".pagination_element a",this.clicked_pagination_element)},step_visibility_changed_handler:function(){this.render()},step_access_changed_handler:function(){this.render()},active_step_changed_handler:function(){this.render()},clicked_pagination_element:function(){if(E(this).blur(),O.has_transition_lock)return!1;if(E(this).hasClass("inactive"))return!1;var t=E(this).closest(".pagination_element").data("item_id"),e=O.get_step(t);return e&&O.navigate_to_step(e),!1},render:function(){var t=[];if(!O.is_initialized)return!1;O.console_log("debug:views","\nRendering pagination view elements...");for(var e=0,i=O.get_steps(),n=i.length;e<n;e++){var o=i[e];if(o.is_visible()){var s={element_id:o.step_id,element_link:o.get_route(),element_title:o.get_title(),element_class:"",element_state_class:""};o.is_current()?(s.element_state_class="inactive",s.element_class="pagination_element_current"):o.is_locked()&&(s.element_state_class="inactive"),t.push(s)}}t=O.filters.apply_filters("composite_pagination_view_data",[t]);var _=this.template(t);_!==this.template_html?(this.template_html=_,this.$el.html(_)):O.console_log("debug:views","...skipped!")}}))(t)},this.Composite_Summary_View=function(t){return new(s.View.extend({update_content_timers:{},update_height_timers:{},view_elements:{},is_in_widget:!1,template:!1,$carousel_wrapper:!1,$carousel_buttons:!1,$carousel_button_prev:!1,$carousel_button_next:!1,carousel_offset:0,initialize:function(t){var o=this;this.template=wp.template("wc_cp_summary_element_content"),this.is_in_widget=t.is_in_widget,this.$carousel_wrapper=this.$el.parent();for(var e=0,i=O.get_steps(),n=i.length;e<n;e++)i[e].step_validation_model.on("change:passes_validation",function(t){return function(){o.render_element_content(i[t])}}(e));for(var s=0,_=O.get_components(),a=_.length;s<a;s++)o.view_elements[_[s].component_id]={$summary_element:o.$el.find(".summary_element_"+_[s].component_id),$summary_element_wrapper:o.$el.find(".summary_element_"+_[s].component_id+" .summary_element_wrapper"),$summary_element_inner:o.$el.find(".summary_element_"+_[s].component_id+" .summary_element_wrapper_inner"),template_html:"",load_height:0};O.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),O.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this),O.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this),O.actions.add_action("component_selection_changed",this.selection_changed_handler,100,this),O.actions.add_action("component_selection_content_changed",this.selection_changed_handler,100,this),O.actions.add_action("component_totals_changed",this.component_totals_changed_handler,100,this),"single"!==O.settings.layout&&O.actions.add_action("active_step_transition_start",this.active_step_changed_handler,100,this),this.$el.on("click",".summary_element_select",this.clicked_summary_element),this.is_in_widget&&1<this.get_columns()&&(this.$carousel_buttons=this.$el.closest(".widget_composite_summary_details_wrapper").find(".summary_carousel_button"),this.$carousel_button_prev=this.$carousel_buttons.first(),this.$carousel_button_next=this.$carousel_buttons.last(),this.$carousel_button_prev.on("click",{view:this},this.clicked_carousel_button_prev),this.$carousel_button_next.on("click",{view:this},this.clicked_carousel_button_next),"yes"===O.settings.summary_carousel_autoscroll&&O.actions.add_action("active_step_transition_end",this.sync_carousel_pos,100,this),$wc_cp_window.resize(function(){if(!O.is_initialized)return!1;var t,e=o.get_columns(),i=o.get_carousel_viewport_width(),n=o.get_summary_element_indexes().length;t=e<n?i*n/e:i,o.$el.css({width:t})}))},step_access_changed_handler:function(t){this.render_element_state(t)},step_visibility_changed_handler:function(t){this.render_element_visibility(t),this.render_columns(t.step_index)},active_step_changed_handler:function(){this.render_state()},selection_changed_handler:function(t){this.render_element_content(t)},quantity_changed_handler:function(t){this.render_element_content(t)},component_totals_changed_handler:function(t){this.render_element_content(t)},clicked_summary_element:function(){if(O.has_transition_lock)return!1;if(E(this).hasClass("disabled"))return!1;var t=E(this).closest(".summary_element").data("item_id"),e=O.get_step(t);return!1===e||e.is_current()&&"single"!==O.settings.layout||O.navigate_to_step(e),!1},clicked_carousel_button_next:function(t){E(this).hasClass("inactive")||t.data.view.scroll_carousel("incr")},clicked_carousel_button_prev:function(t){E(this).hasClass("inactive")||t.data.view.scroll_carousel("decr")},get_columns:function(){return parseInt(this.$el.data("summary_columns"),10)},get_carousel_viewport_width:function(){var t=null;return 1<this.get_columns()&&this.is_in_widget&&void 0===(t=this.$carousel_wrapper.get(0).getBoundingClientRect().width)&&(t=this.$carousel_wrapper.width()),t},get_summary_element_indexes:function(){for(var t=[],e=0,i=O.get_steps(),n=i.length;e<n;e++)i[e].is_component()&&i[e].is_visible()&&t.push(i[e].step_index);return t},get_element_price_html:function(t){var e=O.data_model.price_data,i="";if(t.is_component()&&t.is_subtotal_visible()&&t.passes_validation()){var n=t,o=n.component_id,s="variable"===n.get_selected_product_type()?n.get_selected_variation(!1):n.get_selected_product(!1),_=n.get_selected_quantity();if(0<s&&0<_){var a=O.data_model.get("component_"+o+"_totals");if("no"===e.is_priced_individually[o]&&0===a.price&&0===a.regular_price)i="";else{var c=wc_cp_price_format(a.price),r=wc_cp_price_format(a.regular_price);a.regular_price>a.price&&(c=wc_composite_params.i18n_strikeout_price_string.replace("%f",r).replace("%t",c)),i='<span class="price summary_element_content">'+c+"</span>"}}}return i},sync_carousel_pos:function(t){if(t.is_component()){for(var e=this.get_columns(),i=this.get_summary_element_indexes(),n=i.length,o=this.get_carousel_viewport_width(),s=this.carousel_offset,_=1/n*(e<n?o*n/e:o),a=0,c=0,r=i.length;c<r;c++){if(i[c]===t.step_index){a=c*_;break}}o+s-1<a&&this.scroll_carousel(a-(e-1)*_),a<s-1&&this.scroll_carousel(a)}},scroll_carousel:function(t){if(!E(this).hasClass("inactive")){"incr"!==t&&"decr"!==t&&(t=parseInt(t,10));var e=this.get_columns(),i=this.get_summary_element_indexes().length,n=this.get_carousel_viewport_width(),o=this.carousel_offset,s=e<i?n*i/e:n,_=1/i*s;"incr"===t?o+=Math.round(e*O.settings.summary_carousel_scroll_coeff)*_:"decr"===t?o-=Math.round(e*O.settings.summary_carousel_scroll_coeff)*_:o=t,1<o+n-s&&(o=s-n),o<1&&(o=0),o<1?this.$carousel_button_prev.addClass("inactive"):this.$carousel_button_prev.removeClass("inactive"),1<o+n+_-s?this.$carousel_button_next.addClass("inactive"):this.$carousel_button_next.removeClass("inactive"),this.carousel_offset=o,this.$el.css({transform:"translateX(-"+o+"px)"})}},render_columns:function(t){if(!O.is_initialized)return!1;var e=0,i=this.get_columns(),n=this;if(O.console_log("debug:views","\nUpdating summary view element columns..."),t=void 0===t?0:t,1<i&&n.is_in_widget){var o,s,_=this.get_summary_element_indexes().length,a=this.get_carousel_viewport_width();t=0,s=1/_*(o=i<_?a*_/i:a),i<_?n.$carousel_buttons.removeClass("disabled"):n.$carousel_buttons.addClass("disabled"),1<n.carousel_offset+a-o&&(n.carousel_offset=o-a),n.carousel_offset<1?n.$carousel_button_prev.addClass("inactive"):n.$carousel_button_prev.removeClass("inactive"),1<n.carousel_offset+a+s-o?n.$carousel_button_next.addClass("inactive"):n.$carousel_button_next.removeClass("inactive"),n.$el.css({width:o,transform:"translateX(-"+n.carousel_offset+"px)"})}for(var c=0,r=O.get_steps(),l=r.length;c<l;c++){var d=r[c];if(void 0!==n.view_elements[d.step_id])if(d.step_index<t)d.is_visible()&&e++;else{var p="";d.is_visible()&&((++e-1)%i!=0&&1!=i||(p+=" first"),e%i==0&&(p+=" last")),1<i&&n.is_in_widget?n.view_elements[d.step_id].$summary_element.removeClass("first last"):n.view_elements[d.step_id].$summary_element.removeClass("first last").addClass(p)}}},render_visibility:function(){if(!O.is_initialized)return!1;O.console_log("debug:views","\nRendering summary view element visibility"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),O.debug_indent_incr();for(var t=0,e=O.get_steps(),i=e.length;t<i;t++)this.render_element_visibility(e[t]);O.debug_indent_decr()},render_state:function(){if(!O.is_initialized)return!1;O.console_log("debug:views","\nRendering summary view element states"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),O.debug_indent_incr();for(var t=0,e=O.get_steps(),i=e.length;t<i;t++)this.render_element_state(e[t]);O.debug_indent_decr()},render_content:function(){O.console_log("debug:views","\nRendering summary view element contents"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),O.debug_indent_incr();for(var t=0,e=O.get_steps(),i=e.length;t<i;t++)this.render_element_content(e[t]);O.debug_indent_decr()},render:function(){O.console_log("debug:views","\nRendering summary view elements"+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),O.debug_indent_incr(),this.render_visibility(),this.render_state(),this.render_columns(),this.render_content(),O.debug_indent_decr()},render_element_content:function(t){if(!O.is_initialized)return!1;var e=this;return void 0!==this.view_elements[t.step_id]&&(!t.component_selection_model.has_pending_updates()&&(O.console_log("debug:views",'\nScheduled update of "'+t.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"."),void 0!==this.update_content_timers[t.step_index]&&clearTimeout(e.update_content_timers[t.step_index]),void(this.update_content_timers[t.step_index]=setTimeout(function(){e.render_element_content_task(t)},10))))},render_element_content_task:function(t){if(t.is_component()){O.console_log("debug:views",'\nRendering "'+t.get_title()+'" summary view element content'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"...");var i=this,e=t,n=e.component_id,o=this.view_elements[n].$summary_element_wrapper,s=this.view_elements[n].$summary_element_inner,_=this.view_elements[n].template_html,a={element_index:t.get_title_index(),element_title:t.get_title(),element_selection_title:"",element_action:"",element_label:"",element_button_classes:"",element_image_src:"",element_image_srcset:"",element_image_sizes:"",element_image_title:"",element_price:""},c=!1,r=0;if(i.update_height_timers[t.step_index]||(void 0===(r=s.get(0).getBoundingClientRect().height)&&(r=s.outerHeight()),this.view_elements[n].load_height=r,o.css("height",this.view_elements[n].load_height)),a.element_selection_title=e.get_selected_product_title(!0,!1),a.element_is_in_widget=this.is_in_widget,a.element_button_link=e.get_route(),a.element_selection_title&&e.passes_validation())e.is_static()?a.element_action=wc_composite_params.i18n_summary_static_component:a.element_action=wc_composite_params.i18n_summary_configured_component;else{var l=t.get_selected_product(),d=t.get_selected_product_type();a.element_action=wc_composite_params.i18n_summary_empty_component,0<l&&"simple"!==d&&"invalid-product"!==d&&(a.element_action=wc_composite_params.i18n_summary_pending_component)}a.element_label=wc_composite_params.i18n_summary_action_label.replace("%a",a.element_action).replace("%c",a.element_title),!1===(c=e.get_selected_product_image_data(!1))&&(c=e.get_placeholder_image_data()),c&&(a.element_image_src=c.image_src,a.element_image_srcset=c.image_srcset?c.image_srcset:"",a.element_image_sizes=c.image_sizes?c.image_sizes:"",a.element_image_title=c.image_title),a.element_price=this.get_element_price_html(t),a=O.filters.apply_filters("component_summary_element_content_data",[a,e,this]);var p=this.template(a);p!==_?(this.view_elements[n].template_html=p,s.html(p)):O.console_log("debug:views","...skipped!"),e.passes_validation()?o.addClass("configured"):o.removeClass("configured"),O.actions.do_action("component_summary_content_updated",[e,this]);void 0!==this.update_height_timers[t.step_index]&&clearTimeout(i.update_height_timers[t.step_index]),this.update_height_timers[t.step_index]=setTimeout(function(){var e;e=s.find(".summary_element_image img"),new m.WC_CP_Async_Task(function(){var t=!1;if(c.image_src&&e.is(":visible")&&0===e.height()&&this.get_async_time()<5e3)return!(t=!0);t||this.done()},50).complete(function(){var t=s.outerHeight(!0),e=!1;i.$el.is(":visible")&&1<Math.abs(t-i.view_elements[n].load_height)?e=!0:o.css("height","auto"),e&&o.animate({height:t},{duration:200,queue:!0,start:function(){O.console_log("debug:animations","Starting updated summary element content animation...")},always:function(){O.console_log("debug:animations","Ended updated summary element content animation."),o.css({height:"auto"})}})}),i.update_height_timers[t.step_index]=0},200)}},render_element_visibility:function(t){if(!O.is_initialized)return!1;if(void 0===this.view_elements[t.step_id])return!1;var e=this.view_elements[t.step_id].$summary_element;O.console_log("debug:views",'\nUpdating "'+t.get_title()+'" summary view element visibility'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),!1===t.is_visible()?e.addClass("hidden"):e.removeClass("hidden")},render_element_state:function(t){if(!O.is_initialized)return!1;if(void 0===this.view_elements[t.step_id])return!1;var e=this.view_elements[t.step_id].$summary_element_wrapper;O.console_log("debug:views",'\nUpdating "'+t.get_title()+'" summary view element state'+(this.is_in_widget?" (widget #"+this.is_in_widget+")":"")+"..."),t.is_current()?(e.removeClass("disabled"),"single"!==O.settings.layout&&e.addClass("selected")):t.is_locked()?(e.removeClass("selected"),e.addClass("disabled")):(e.removeClass("disabled"),e.removeClass("selected"))}}))(t)},this.Composite_Navigation_View=function(t){return new(s.View.extend({render_timer:!1,render_movable_timer:!1,updated_buttons_data:{},navi_in_step:!1,template:!1,$el_progressive:O.$composite_form.find(".composite_navigation.progressive"),$el_paged_top:O.$composite_navigation_top,$el_paged_bottom:O.$composite_navigation_bottom,$el_paged_movable:O.$composite_navigation_movable,initialize:function(){this.template=wp.template("wc_cp_composite_navigation"),O.actions.add_action("component_selection_changed",this.selection_changed_handler,110,this),O.actions.add_action("component_selection_details_updated",this.selection_details_updated_handler,10,this),O.actions.add_action("component_selection_content_changed",this.selection_content_changed_handler,100,this),O.actions.add_action("active_step_transition_start",this.active_step_transition_start_handler,110,this),O.actions.add_action("component_options_state_rendered",this.options_state_rendered_handler,20,this),this.$el.on("click",".page_button",this.clicked_navigation_button)},selection_details_updated_handler:function(t){t.is_current()&&this.render_movable_task()},selection_content_changed_handler:function(){if(!O.is_initialized)return!1;this.render_change()},selection_changed_handler:function(t){return!!O.is_initialized&&(t.can_autotransition()?(O.show_next_step(),!1):void this.render_change())},active_step_transition_start_handler:function(){clearTimeout(this.render_timer),this.render("transition")},options_state_rendered_handler:function(t,e){if(!O.is_initialized)return!1;t.is_current()&&_.contains(e,"thumbnails")&&t.component_selection_view.is_relocated()&&this.render_movable()},clicked_navigation_button:function(){var t=E(this);return t.hasClass("inactive")||O.has_transition_lock||(t.hasClass("next")?O.get_next_step()?O.show_next_step():O.composite_viewport_scroller.scroll_viewport(O.$composite_form.find(".scroll_final_step"),{partial:!1,duration:250,queue:!1}):O.show_previous_step()),!1},update_buttons:function(){var t={prev_btn:{btn_classes:"",btn_text:"",btn_link:"",btn_label:""},next_btn:{btn_classes:"",btn_text:"",btn_link:"",btn_label:""}};!1!==this.updated_buttons_data.button_next_link&&(t.next_btn.btn_link=this.updated_buttons_data.button_next_link),!1!==this.updated_buttons_data.button_prev_link&&(t.prev_btn.btn_link=this.updated_buttons_data.button_prev_link),!1!==this.updated_buttons_data.button_next_html&&(t.next_btn.btn_text=this.updated_buttons_data.button_next_html),!1!==this.updated_buttons_data.button_prev_html&&(t.prev_btn.btn_text=this.updated_buttons_data.button_prev_html),!1!==this.updated_buttons_data.button_next_label&&(t.next_btn.btn_label=this.updated_buttons_data.button_next_label),!1!==this.updated_buttons_data.button_prev_label&&(t.prev_btn.btn_label=this.updated_buttons_data.button_prev_label),!1===this.updated_buttons_data.button_next_visible&&(t.next_btn.btn_classes="invisible"),!1===this.updated_buttons_data.button_prev_visible&&(t.prev_btn.btn_classes="invisible"),!1===this.updated_buttons_data.button_next_active&&(t.next_btn.btn_classes+=" inactive"),this.$el.html(this.template(t))},render_change:function(){var t=this;O.console_log("debug:views","\nScheduling navigation UI update..."),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){t.render("change")},40)},render:function(t){O.console_log("debug:views","\nRendering navigation UI...");var e=O.get_current_step(),i=O.get_next_step(),n=O.get_previous_step(),o=this;if(this.updated_buttons_data={button_next_link:!1,button_prev_link:!1,button_next_label:!1,button_prev_label:!1,button_next_html:!1,button_prev_html:!1,button_next_visible:!1,button_prev_visible:!1,button_next_active:!1},"transition"===t&&"paged"===O.settings.layout&&"componentized"===O.settings.layout_variation&&(e.is_review()?this.$el_paged_bottom.hide():this.$el_paged_bottom.show()),i&&(this.updated_buttons_data.button_next_link=i.get_route()),n&&(this.updated_buttons_data.button_prev_link=n.get_route()),e.is_component()&&(i&&"componentized"!==O.settings.layout_variation?(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_next_step.replace("%s",i.get_title()),this.updated_buttons_data.button_next_label=i.is_review()?wc_composite_params.i18n_final_step:wc_composite_params.i18n_next_step_label.replace("%s",i.get_title()),this.updated_buttons_data.button_next_visible=!0):i&&"paged"===O.settings.layout&&(this.updated_buttons_data.button_next_html=wc_composite_params.i18n_final_step,this.updated_buttons_data.button_next_label=wc_composite_params.i18n_final_step,this.updated_buttons_data.button_next_visible=!0)),e.passes_validation()||"componentized"===O.settings.layout_variation&&e.is_component())i&&(this.updated_buttons_data.button_next_active=!0),n&&"paged"===O.settings.layout&&n.is_component()?(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",n.get_title()),this.updated_buttons_data.button_prev_label=wc_composite_params.i18n_previous_step_label.replace("%s",n.get_title()),this.updated_buttons_data.button_prev_visible=!0):(this.updated_buttons_data.button_prev_html="",this.updated_buttons_data.button_prev_label="");else if(n&&n.is_component()){var s=n.get_selected_product();(0<s||"0"===s||""===s&&n.is_optional())&&"paged"===O.settings.layout&&(this.updated_buttons_data.button_prev_html=wc_composite_params.i18n_previous_step.replace("%s",n.get_title()),this.updated_buttons_data.button_prev_label=wc_composite_params.i18n_previous_step_label.replace("%s",n.get_title()),this.updated_buttons_data.button_prev_visible=!0)}if("progressive"===O.settings.layout){var _=o.$el_progressive;if(o.navi_in_step!==e.step_id)_.slideUp({duration:200,always:function(){o.update_buttons(),_.appendTo(e.$inner_el).hide(),o.navi_in_step=e.step_id,setTimeout(function(){var t=!1;e.is_last()||e.passes_validation()&&!i.has_toggle()&&(t=!0),t&&_.slideDown({duration:200,queue:!1})},200)}});else{o.update_buttons();var a=!1;e.is_last()||e.passes_validation()&&!i.has_toggle()&&(a=!0),a?_.slideDown(200):_.slideUp(200)}}else"paged"===O.settings.layout&&(o.navi_in_step!==e.step_id&&(e.$el.prepend(o.$el_paged_top),e.$el.append(o.$el_paged_bottom),o.navi_in_step=e.step_id),o.update_buttons(),"transition"===t&&o.render_movable_task())},render_movable:function(){var t=this;O.console_log("debug:views","\nScheduling movable navigation visibility update..."),clearTimeout(t.render_movable_timer),t.render_movable_timer=setTimeout(function(){t.render_movable_task()},10)},render_movable_task:function(){var t=O.get_current_step();if(t.is_component()&&t.has_options_style("thumbnails")&&0<t.get_selected_product()){var e=0<t.$component_content.find(".composite_navigation").length,i=!1;if(t.append_results()&&t.component_selection_view.is_relocated()){var n=t.$component_options.find(".component_option_thumbnail_container").not(".hidden"),o=t.$component_options.find(".component_option_thumbnail.selected").closest(".component_option_thumbnail_container"),s=n.index(o)+1,_=O.$composite_form.width()>wc_composite_params.small_width_threshold&&!1===O.$composite_form.hasClass("legacy_width")?t.component_options_view.get_columns():1;Math.ceil(s/_)===Math.ceil(n.length/_)&&(i=!0)}e||i||(this.$el_paged_movable.appendTo(t.$component_summary),e=!0),e&&(i||t.is_static()?this.$el_paged_movable.addClass("hidden"):this.$el_paged_movable.removeClass("hidden"))}}}))(t)},this.Composite_Widget_View=function(t){return new(s.View.extend({show_hide_timer:!1,initialize:function(t){this.$el.removeClass("cp-no-js"),this.validation_view=new O.view_classes.Composite_Validation_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_error .composite_message"),model:O.data_model}),this.price_view=new O.view_classes.Composite_Price_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_price .composite_price"),model:O.data_model}),this.availability_view=new O.view_classes.Composite_Availability_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_availability .composite_availability"),model:O.data_model}),this.add_to_cart_button_view=new O.view_classes.Composite_Add_To_Cart_Button_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_button .composite_button"),$el_button:this.$el.find(".widget_composite_summary_button .composite_button .composite_add_to_cart_button"),model:O.data_model}),this.composite_summary_view=new O.view_classes.Composite_Summary_View({is_in_widget:t.widget_count,el:this.$el.find(".widget_composite_summary_elements")}),O.actions.do_action("widget_view_initialized",[t,this]),"paged"===O.settings.layout?O.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this):this.show_hide()},active_step_changed_handler:function(){this.show_hide()},show_hide:function(){var t=this;clearTimeout(t.show_hide_timer),this.show_hide_timer=setTimeout(function(){t.show_hide_task()},20)},show_hide_task:function(){var t=this,e=0,i=O.get_current_step().is_review(),n=void 0===this.$el.data("is_hidden"),o=void 0!==O.settings.show_widget_in_review_step&&"yes"===O.settings.show_widget_in_review_step?"yes":"no";i&&"no"==o?(this.$el.data("is_hidden",!0),O.console_log("debug:animations","Starting widget slide-up animation..."),this.$el.hasClass("widget_position_default")&&(e=250,this.$el.addClass("summary_widget_inactive")),setTimeout(function(){t.$el.slideUp({duration:250,always:function(){O.console_log("debug:animations","Ended widget slide-up animation."),t.$el.addClass("summary_widget_hidden").show()}})},e)):(this.$el.data("is_hidden")||n)&&(this.$el.data("is_hidden",!1),O.console_log("debug:animations","Starting widget slide-down animation..."),n?this.$el.show().removeClass("summary_widget_hidden"):this.$el.hide().removeClass("summary_widget_hidden").slideDown({duration:250,always:function(){O.console_log("debug:animations","Ended widget slide-down animation.")}}),setTimeout(function(){t.$el.removeClass("summary_widget_inactive")},10))}}))(t)},this.Step_Validation_View=function(t,e){var a=t;return new(s.View.extend({render_timer:!1,render_html:!1,template:!1,event_type:"",initialize:function(){var t=this;this.template=wp.template("wc_cp_validation_message"),this.listenTo(this.model,"change:component_messages",function(){if(!a.is_current()||void 0===a.$component_message)return!1;O.console_log("debug:views",'\nScheduling "'+a.get_title()+'" validation message update...'),clearTimeout(t.render_timer),t.render_timer=setTimeout(function(){if(t.prepare_render("change"),a.can_autotransition())return!1;t.render()},10)}),"single"!==O.settings.layout&&O.actions.add_action("active_step_changed_"+a.step_id,this.active_step_changed_handler,100,this),"single"!==O.settings.layout&&O.actions.add_action("active_step_transition_end_"+a.step_id,this.active_step_transition_end_handler,100,this),O.actions.add_action("component_selection_details_relocation_started",this.relocation_started_handler,100,this),O.actions.add_action("component_selection_details_relocation_ended",this.relocation_ended_handler,100,this),O.actions.add_action("component_selection_details_relocation_container_created",this.relocation_container_created_handler,100,this)},relocation_started_handler:function(t){if(t.step_id===a.step_id){var e=a.$component_message.filter(".top");if(O.console_log("debug:views",'\nHiding "'+a.get_title()+'" validation message to prepare for component details relocation...'),e)!1===O.composite_viewport_scroller.illusion_scroll({target:e,type:"hide"})&&e.slideUp(200)}},relocation_container_created_handler:function(t){if(t.step_id===a.step_id){O.console_log("debug:views",'\nMoving "'+a.get_title()+'" validation message into relocation target...');var e=a.$component_message.filter(".top");e&&a.component_selection_view.$relocation_target.prepend(e)}},relocation_ended_handler:function(t){if(t.step_id===a.step_id){var e=a.$component_message.filter(".top");O.console_log("debug:views",'\nMoving "'+a.get_title()+'" validation message back to its original position...'),e&&a.component_selection_view.$relocation_origin.after(e)}},active_step_changed_handler:function(){if(!a.is_current()||void 0===a.$component_message)return!1;this.prepare_render("transition"),!1===this.render_html&&this.render()},active_step_transition_end_handler:function(){if(!a.is_current()||void 0===a.$component_message)return!1;!1!==this.render_html&&(clearTimeout(this.render_timer),this.render())},prepare_render:function(t){if(this.event_type=""===this.event_type?t:this.event_type,O.console_log("debug:views",'\nPreparing "'+a.get_title()+'" validation message update...'),this.render_html=!1,!(a.passes_validation()||"componentized"===O.settings.layout_variation&&a.is_component())&&(!a.is_last()||"progressive"===!O.settings.layout)){var e=a.get_validation_messages();0<e.length&&(this.render_html=this.template(e))}"transition"===this.event_type&&!1===this.render_html&&("progressive"===O.settings.layout?a.has_toggle()&&a.$component_message.hide():"paged"===O.settings.layout&&a.$component_message.hide())},render:function(){var _=this;if(O.console_log("debug:views",'\nUpdating "'+a.get_title()+'" validation message...'),"progressive"===O.settings.layout){var t="transition"===this.event_type?200:1;setTimeout(function(){!1!==_.render_html&&a.$component_message.html(_.render_html),!1===_.render_html?a.$component_message.slideUp(200):a.$component_message.slideDown(200)},t)}else"paged"===O.settings.layout&&a.$component_message.each(function(t,e){var i=!1,n=E(e),o=n.hasClass("top"),s=o&&"change"===_.event_type&&a.component_selection_view.is_relocated()?a.component_selection_view.get_animation_duration("close")+50:0;setTimeout(function(){!1!==_.render_html&&a.$component_message.html(_.render_html),o&&(i=O.composite_viewport_scroller.illusion_scroll({target:n,type:!1===_.render_html?"hide":"show"})),!1===i&&(!1===_.render_html?n.slideUp(200):n.slideDown(200))},s)});this.event_type=""}}))(e)},this.Step_Title_View=function(e,t){var i=e;return new(s.View.extend({$step_title_index:!1,initialize:function(){this.$step_title_index=i.$step_title.find(".step_index"),e.is_component&&i.has_toggle()&&(this.$el.on("click",this.clicked_title_handler),"progressive"===O.settings.layout&&(O.actions.add_action("step_access_changed",this.step_access_changed_handler,100,this),O.actions.add_action("active_step_changed",this.active_step_changed_handler,100,this))),!1!==this.$step_title_index&&O.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,100,this)},clicked_title_handler:function(){if(!i.has_toggle())return!1;if("single"===O.settings.layout)wc_cp_toggle_element(i.$el,i.$component_inner);else{if(i.is_current()){if("progressive"!==O.settings.layout)return!1;e.toggle_step("open",!0)}if(E(this).hasClass("inactive"))return!1;O.navigate_to_step(i)}return!1},step_access_changed_handler:function(t){t.step_id===i.step_id&&this.render_navigation_state()},active_step_changed_handler:function(){this.render_navigation_state()},render_navigation_state:function(){"progressive"===O.settings.layout&&i.has_toggle()&&(O.console_log("debug:views",'\nUpdating "'+i.get_title()+'" component title state...'),i.is_current()?this.$el.removeClass("inactive"):i.is_locked()?this.$el.addClass("inactive"):this.$el.removeClass("inactive"))},render_index:function(){if(!O.is_initialized)return!1;if(!1===this.$step_title_index)return!1;var t=e.get_title_index();this.$step_title_index.text(t)},step_visibility_changed_handler:function(t){if(i.step_index<t.step_index)return!1;this.render_index()}}))(t)},this.Component_Pagination_View=function(t,e){var i=t;return new(s.View.extend({template:!1,initialize:function(){this.template=wp.template("wc_cp_options_pagination"),this.listenTo(this.model,"change:page change:pages",this.render),i.$el.on("click",".component_pagination a.component_pagination_element",{view:this},this.load_page),i.$el.on("click",".component_pagination .component_options_load_more",{view:this},this.load_more)},load_page:function(){var t=parseInt(E(this).data("page_num"),10);return 0<t&&(O.block(i.$component_options),i.component_options_view.$blocked_element=i.$component_options,i.component_options_view.update_options({page:t},"reload")),!1},load_more:function(){var t=parseInt(i.component_options_model.get("page"),10),e=parseInt(i.component_options_model.get("pages"),10);return 0<t&&t<e&&(O.block(i.$component_options),i.component_options_view.$blocked_element=i.$component_options,i.component_options_view.update_options({page:t+1},"append")),!1},render:function(){if(!O.is_initialized)return!1;var t=this.model,e={page:t.get("page"),pages:t.get("pages"),range_mid:i.get_pagination_range(),range_end:i.get_pagination_range("end"),pages_in_range:2*(i.get_pagination_range()+i.get_pagination_range("end"))+1,i18n_page_of_pages:wc_composite_params.i18n_page_of_pages.replace("%p",t.get("page")).replace("%t",t.get("pages"))};O.console_log("debug:views",'\nRendering "'+i.get_title()+'" options pagination...'),i.append_results()?e.page<e.pages?this.$el.slideDown(200):this.$el.slideUp(200):this.$el.html(this.template(e))}}))(e)},this.Component_Options_View=function(t,e){var F=t;return new(s.View.extend({templates:{dropdown:!1,thumbnails:!1,radios:!1},reference_price:0,reference_option:!1,update_action:"",load_height:0,$blocked_element:!1,append_results_retry_count:0,changes:{dropdown:{changed:!1,to:""},thumbnails:{changed:!1,to:""},radios:{changed:!1,to:""},variations:{changed:!1,to:[]}},initialize:function(){this.templates.dropdown=wp.template("wc_cp_options_dropdown"),this.templates.thumbnails=wp.template("wc_cp_options_thumbnails"),this.templates.radios=wp.template("wc_cp_options_radio_buttons"),F.$el.on("click",".component_filter_option .toggle_filter_option",{view:this},this.activate_filter),F.$el.on("click",".component_filters .reset_component_filter",{view:this},this.reset_filter),F.$el.on("click",".component_filters .reset_component_filters",{view:this},this.reset_filters),F.$el.on("change",".component_ordering select",{view:this},this.order_by),F.$el.on("click",".component_filter_title .component_filter_name",{view:this},this.toggle_filter),"progressive"===O.settings.layout&&F.$el.on("click",".block_component_selections_inner",{view:this},this.clicked_blocked_area),F.has_options_style("thumbnails")&&F.$el.on("click",".component_option_thumbnail_select",{view:this},this.selected_thumbnail),F.has_options_style("radios")&&F.$el.on("change",".component_option_radio_buttons input",{view:this},this.clicked_radio),O.actions.add_action("component_options_loaded_"+F.step_id,this.updated_options,10,this),O.actions.add_action("component_options_state_changed_"+F.step_id,this.render,10,this),F.is_priced_individually()&&"relative"===F.get_price_display_format()&&(O.actions.add_action("component_selection_changed",this.component_selection_changed_handler,100,this),O.actions.add_action("component_selection_content_changed",this.component_selection_changed_handler,100,this)),this.listenTo(this.model,"change:options_in_scenarios",this.options_in_scenarios_changed)},component_selection_changed_handler:function(t){F.step_id!==t.step_id||F.component_selection_model.has_pending_updates()||F.component_options_view.render()},options_in_scenarios_changed:function(){this.model.reload_options_on_scenarios_change()&&(O.block(F.$component_options),this.$blocked_element=F.$component_options,O.data_model.add_status_message(F.component_id,wc_composite_params.i18n_loading_options.replace("%s",F.get_title())),this.update_options({page:1},"reload",!0))},clicked_blocked_area:function(){return O.navigate_to_step(F),!1},selected_thumbnail:function(){var t=E(this).closest(".component_option_thumbnail");if(F.$el.hasClass("disabled")||t.hasClass("disabled"))return!0;if(!t.hasClass("selected")){var e=t.data("val");F.$component_options_select.val(e).change()}return!1},clicked_radio:function(){var t=E(this),e=t.closest(".component_option_radio_button");if(F.$el.hasClass("disabled")||e.hasClass("disabled"))return!0;if(!e.hasClass("selected")){var i=t.val();F.$component_options_select.val(i).change()}},toggle_filter:function(){var t=E(this).closest(".component_filter"),e=t.find(".component_filter_content");return wc_cp_toggle_element(t,e,!1,200),!1},activate_filter:function(t){var e=E(this);if(F.$el.hasClass("disabled"))return!1;var i=t.data.view,n=e.closest(".component_filter_option");if(n.hasClass("selected"))n.removeClass("selected"),n.find(".toggle_filter_option").attr("aria-checked","false");else{var o=e.closest(".component_filter");if(!("yes"===o.data("multiselect"))){var s=o.find(".component_filter_option.selected");s.removeClass("selected"),s.find(".toggle_filter_option").attr("aria-checked","false")}n.addClass("selected"),n.find(".toggle_filter_option").attr("aria-checked","true")}return i.update_filters_ui(),O.block(F.$component_filters),i.$blocked_element=F.$component_filters,i.update_options({page:1,filters:F.find_active_filters()},"reload"),!1},reset_filter:function(t){var e=E(this),i=t.data.view,n=e.closest(".component_filter").find(".component_filter_option.selected");return 0==n.length||(n.removeClass("selected"),n.find(".toggle_filter_option").attr("aria-checked","false"),i.update_filters_ui(),O.block(F.$component_filters),i.$blocked_element=F.$component_filters,i.update_options({page:1,filters:F.find_active_filters()},"reload")),!1},reset_filters:function(t){E(this).blur();var e=t.data.view,i=F.$component_filters.find(".component_filter_option.selected");return 0==i.length||(i.removeClass("selected"),i.find(".toggle_filter_option").attr("aria-checked","false"),e.update_filters_ui(),O.block(F.$component_filters),e.$blocked_element=F.$component_filters,e.update_options({page:1,filters:F.find_active_filters()},"reload")),!1},update_filters_ui:function(){var t=F.$component_filters.find(".component_filter"),e=!0;if(0==t.length)return!1;t.each(function(){var t=E(this);0==t.find(".component_filter_option.selected").length?t.removeClass("active"):(t.addClass("active"),e=!1)}),e?F.$component_filters.removeClass("filtered"):F.$component_filters.addClass("filtered")},order_by:function(t){var e=E(this),i=t.data.view,n=e.val();return O.block(F.$component_options),i.$blocked_element=F.$component_options,i.update_options({page:1,orderby:n},"reload"),!1},get_columns:function(){var t=null;return F.has_options_style("thumbnails")?(t=parseInt(F.$component_thumbnail_options.data("component_option_columns"),10),isNaN(t)&&(t=void 0!==F.$component_thumbnail_options.data("columns")?parseInt(F.$component_thumbnail_options.data("columns"),10):1)):F.has_options_style("radios")&&(t=1),t},get_reference_option_data:function(){return{option_id:this.reference_option,option_price:this.reference_price}},render:function(t){if(!O.is_initialized)return!1;t=void 0!==t&&t,O.console_log("debug:views",'\nRendering "'+F.get_title()+'" options in view...');var e,i=F.component_options_model,n=F.get_price_display_format(),o=i.get("options_state").active,s=F.get_selected_product(!1),a=E.extend(!0,[],i.available_options_data);this.changes.dropdown.changed=!1,this.changes.thumbnails.changed=!1,this.changes.radios.changed=!1,this.changes.variations.changed=!1,O.is_finalized&&s!==this.reference_option||"relative"!==F.get_price_display_format()||!F.has_valid_selections(!1)||(this.reference_price=O.data_model.calculate_component_subtotals(F,O.data_model.price_data,1).price,this.reference_option=s);for(var c=0,r=a.length;c<r;c++){var l=a[c],d=l.option_id,p=_.contains(o,d);a[c].is_disabled=!p,a[c].is_hidden=a[c].is_disabled&&F.hide_disabled_products(),a[c].is_selected=a[c].option_id===s,a[c].option_button_text=l.is_configurable?wc_composite_params.i18n_configure_option_button:wc_composite_params.i18n_select_option_button,a[c].option_button_label=l.is_configurable?wc_composite_params.i18n_configure_option_button_label.replace("%s",l.option_title):wc_composite_params.i18n_select_option_button_label.replace("%s",l.option_title),a[c].option_display_title=l.option_title,a[c].option_price_html=F.get_formatted_option_price_html(a[c])}for(var u=E.extend(!0,[],a),m=0,h=u.length;m<h;m++){var g=u[m];if(u[m].is_selected=g.is_selected&&F.is_selected_product_valid(),g.option_price_html&&F.has_options_style("dropdowns")){var v="relative"===n?wc_composite_params.i18n_dropdown_title_relative_price:wc_composite_params.i18n_dropdown_title_price;u[m].option_display_title=v.replace("%t",g.option_display_title).replace("%p",g.option_price_html)}}var f,b=!1,w=!1,y=!1;if(0===o.length?(b=!0,f=wc_composite_params.i18n_no_options):(f=F.is_optional()?wc_composite_params.i18n_no_option.replace("%s",F.get_title()):wc_composite_params.i18n_select_option.replace("%s",F.get_title()),F.maybe_is_optional()?(!(b=!0)===F.is_selected_product_valid()&&(w=!0),!1===F.is_optional()&&(""===s&&(w=!0),y=!0,f=wc_composite_params.i18n_no_option.replace("%s",F.get_title()))):!1===F.is_static()&&F.show_placeholder_option()||""===s&&!1===F.show_placeholder_option()?b=!0:!1===F.is_selected_product_valid()&&!1===F.show_placeholder_option()&&(w=!0)),b){var $={option_id:"",option_display_title:f,is_disabled:y,is_hidden:y&&F.hide_disabled_products(),is_selected:""===s&&!1===w};if("relative"===n&&F.has_options_style("dropdowns")&&F.maybe_is_optional()){$.option_price_html="",$.option_price_data={price:0,regular_price:0,max_price:0,max_regular_price:0,min_qty:1,discount:""};var k=F.get_formatted_option_price_html($);k&&($.option_display_title=wc_composite_params.i18n_dropdown_title_relative_price.replace("%t",$.option_display_title).replace("%p",k))}u.unshift($)}if(w&&u.unshift({option_id:"",option_display_title:wc_composite_params.i18n_select_option.replace("%s",F.get_title()),is_disabled:!1,is_hidden:!1,is_selected:!1}),this.changes.dropdown.changed=!0,this.changes.dropdown.to=this.templates.dropdown(u),!1===t){if(F.has_options_style("thumbnails")){var x=_.where(a,{is_in_view:!0}),C=this.get_columns(),q=0;if(0<x.length)for(var z=0,S=x.length;z<S;z++){var T=x[z];x[z].outer_classes=T.is_hidden?"hidden":"",x[z].inner_classes=T.is_disabled?"disabled":"",x[z].inner_classes+=T.option_id===s?" selected":"",x[z].inner_classes+=T.is_appended?" appended":"",!1===T.is_hidden&&((++q-1)%C!=0&&1!=C||(x[z].outer_classes+=" first"),q%C==0&&(x[z].outer_classes+=" last"))}var V=this.templates.thumbnails(x);V.replace(/ selected/g,"")!==this.changes.thumbnails.to.replace(/ selected/g,"")?(this.changes.thumbnails.changed=!0,this.changes.thumbnails.to=V):O.console_log("debug:views","...skipped!")}else if(F.has_options_style("radios")){var M=_.where(a,{is_in_view:!0}),U=!1,A=F.maybe_is_optional()&&!1===F.is_optional(),P=A&&F.hide_disabled_products();if(F.maybe_is_optional()?U=!0:!1===F.is_static()&&F.show_placeholder_option()&&(P=U=!0),U){var I={option_id:"",option_display_title:wc_composite_params.i18n_no_option.replace("%s",F.get_title()),is_disabled:A,is_hidden:P,is_selected:""===s};if("relative"===n&&F.maybe_is_optional()){I.option_price_html="",I.option_price_data={price:0,regular_price:0,max_price:0,max_regular_price:0,min_qty:1,discount:""};var D=F.get_formatted_option_price_html(I);D&&(I.option_price_html=D)}M.unshift(I)}if(0<M.length)for(var R=0,j=M.length;R<j;R++){var N=M[R];M[R].outer_classes=N.is_hidden?"hidden":"",M[R].inner_classes=N.is_disabled?"disabled":"",M[R].inner_classes+=N.option_id===s?" selected":"",M[R].option_suffix=""===N.option_id?"0":N.option_id,M[R].option_group_id=F.component_id}this.changes.radios.changed=!0,this.changes.radios.to=this.templates.radios(M)}if("variable"===F.get_selected_product_type()){var W=F.component_selection_model.get_active_variations_data();this.changes.variations.changed=!_.isEqual(this.changes.variations.to,W)&&0<this.changes.variations.to.length,this.changes.variations.to=W}}0<(e=_.keys(_.pick(this.changes,function(t){return t.changed}))).length&&(O.actions.do_action("component_options_state_render",[F,e]),this.changes.dropdown.changed&&F.$component_options_select.html(this.changes.dropdown.to),this.changes.thumbnails.changed&&(F.$component_thumbnail_options.html(this.changes.thumbnails.to),"reload"===this.update_action&&F.$component_selections.removeClass("refresh_component_options")),this.changes.radios.changed&&F.$component_radio_button_options.html(this.changes.radios.to),this.changes.variations.changed&&F.component_selection_view.get_rendered_product()===s&&(O.console_log("debug:views",'\nVariations data in "'+F.get_title()+'" has changed. Reinitializing variations view...'),F.$component_summary_content.data("product_variations",F.component_selection_model.get_active_variations_data()),O.debug_indent_incr(),F.$component_summary_content.triggerHandler("reload_product_variations"),O.debug_indent_decr()),O.actions.do_action("component_options_state_rendered",[F,e]))},update_options:function(t,e,i){i=void 0!==i&&i,"reload"===(this.update_action=e)&&F.$component_selections.addClass("refresh_component_options"),this.load_height=F.$component_options.get(0).getBoundingClientRect().height,void 0===this.load_height&&(this.load_height=F.$component_options.outerHeight()),F.$component_options.css("height",this.load_height),setTimeout(function(){F.component_options_model.request_options(t,e)},200),O.actions.do_action("component_options_update_requested",[F,t,e,i])},updated_options:function(){if(!1===this.$blocked_element)return!1;if("append"===this.update_action&&F.hide_disabled_products()&&F.$component_thumbnail_options.find(".appended:not(.disabled)").length<F.get_results_per_page()){var t=this.model.get("page")<this.model.get("pages");if(t&&10<this.append_results_retry_count&&!1===window.confirm(wc_composite_params.i18n_reload_threshold_exceeded.replace("%s",F.get_title()))&&(t=!1),t)return this.append_results_retry_count++,this.model.request_options({page:this.model.get("page")+1},"append"),!1;this.append_results_retry_count=0}var i=F.$component_thumbnail_options.find(".component_option_thumbnails_container"),n=i.find(".component_option_thumbnail_container:not(.hidden) img"),e=this;new m.WC_CP_Async_Task(function(){var t=!1,e=this;0<n.length&&i.is(":visible")&&n.each(function(){if(0===E(this).height()&&e.get_async_time()<2e4)return!(t=!0)}),t||this.done()},50).complete(function(){e.animate_options()})},animate_options:function(){"append"===this.update_action&&F.$component_thumbnail_options.find(".appended").removeClass("appended");var t=this,e=F.$component_options_inner.outerHeight(!0),i=!1;1<Math.abs(e-t.load_height)?i=!0:F.$component_options.css("height","auto");i?(O.console_log("debug:animations","Starting component options height animation..."),F.$component_options.animate({height:e},{duration:250,queue:!1,always:function(){F.$component_options.css({height:"auto"}),O.console_log("debug:animations","Ended component options height animation."),setTimeout(function(){t.unblock()},100)}})):setTimeout(function(){t.unblock()},250),O.actions.do_action("component_options_updated",[F])},unblock:function(){F.$component_selections.removeClass("refresh_component_options"),O.unblock(this.$blocked_element),this.$blocked_element=!1,O.data_model.remove_status_message(F.component_id),this.update_action="",O.actions.do_action("component_options_refreshed",[F])},is_updating:function(){return!1!==this.$blocked_element}}))(e)},this.Component_Selection_View=function(t,e){var v=t;return new(s.View.extend({templates:{},$relocation_origin:!1,relocated:!1,relocating:!1,relocating_to_origin:!1,$relocation_target:!1,$relocation_reference:!1,load_height:0,flushing_component_options:!1,blocked:!1,rendered_product:"",initialize:function(){this.templates={selection_title:wp.template("wc_cp_component_selection_title"),selection_title_html:""},v.$el.on("change",".component_options select.component_options_select",{view:this},this.option_changed),v.$el.on("woocommerce_variation_has_changed",{view:this},function(t){var e=v.$component_summary_content.find(".single_variation_wrap .variations_button input.variation_id").val(),i=v.$component_summary_content.find(".variations"),n={meta_data:[]};(e=e||"")&&0<i.length&&(n.meta_data=wc_cp_get_variation_data(i,!1)),t.data.view.model.update_selected_variation(e,n),v.$component_variations_reset_wrapper&&(t.data.view.model.get("selected_variation")?v.$component_variations_reset_wrapper.slideDown(200):v.$component_variations_reset_wrapper.slideUp(200)),v.step_validation_model.get("is_in_stock")&&v.$component_quantity.trigger("change"),v.has_wc_core_gallery_class||v.$component_summary_content.find(".composited_product_images").removeClass("images")}),v.$el.on("woocommerce_variation_select_change",function(){v.has_wc_core_gallery_class||v.$component_summary.find(".composited_product_images").addClass("images"),v.component_selection_model.set_price(0),v.component_selection_model.set_regular_price(0),v.component_selection_model.set_tax_ratios(!1),v.component_selection_model.set_stock_status("")}),v.$el.on("found_variation",function(t,e){v.component_selection_model.set_price(e.price),v.component_selection_model.set_regular_price(e.regular_price),v.component_selection_model.set_tax_ratios(e.tax_ratios),e.is_in_stock||v.component_selection_model.set_stock_status("out-of-stock")}),v.$el.on("input change",".component_wrap input.qty",function(t){var e=E(this),i=parseFloat(e.attr("min")),n=parseFloat(e.attr("max"));"yes"!==wc_composite_params.force_min_max_qty_input&&!v.component_selection_view.is_blocked()||("change"===t.type&&0<=i&&(parseFloat(e.val())<i||isNaN(parseFloat(e.val())))&&e.val(i),"change"===t.type&&0<n&&parseFloat(e.val())>n&&e.val(n)),v.component_selection_model.update_selected_quantity(parseInt(e.val()))}),v.$el.on("wc-composite-component-loaded",{view:this},function(){if("yes"===wc_composite_params.photoswipe_enabled&&"undefined"!=typeof PhotoSwipe){var t=v.$component_summary_content.find(".composited_product_images");t.wc_product_gallery({zoom_enabled:!1,flexslider_enabled:!1});var e=t.find("a.placeholder_image");0<e.length&&e.on("click",function(){return!1})}else if(E.isFunction(E.fn.prettyPhoto)){var i=v.$component_summary_content.find('a[data-rel^="prettyPhoto"]'),n=i.not(".placeholder_image"),o=i.filter(".placeholder_image");0<n.length&&n.prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1}),0<o.length&&o.on("click",function(){return!1})}}),v.$el.on("click",".clear_component_options",function(){if(E(this).hasClass("reset_component_options"))return!1;var t=v.$component_options_select.find('option[value=""]');return 0<t.length&&!1===t.first().prop("disabled")&&v.$component_options_select.val("").change(),!1}),v.$el.on("click",".reset_component_options",function(){var t=v.$component_options_select.find('option[value=""]');return v.unblock_step_inputs(),v.set_active(),0<t.length&&!1===t.first().prop("disabled")&&v.$component_options_select.val("").change(),v.block_next_steps(),!1}),v.$el.on("updated_addons",this.updated_addons_handler),v.$el.on("woocommerce-nyp-updated-item",this.updated_nyp_handler),"yes"===wc_composite_params.relocated_content_reset_on_return&&O.actions.add_action("active_step_transition",this.active_step_transition_handler,100,this),O.actions.add_action("component_options_state_changed_"+v.step_id,this.options_state_changed_handler,100,this),O.actions.add_action("component_options_state_render",this.options_state_render_handler,10,this),O.actions.add_action("component_options_state_rendered",this.options_state_rendered_handler,10,this),O.actions.add_action("component_options_state_rendered",this.options_state_rendered_autoselect_attributes,30,this),O.actions.add_action("component_selection_details_updated_"+v.step_id,this.refresh_selection_title,10,this),O.actions.add_action("component_selection_changed",this.component_selection_changed_handler,100,this),v.maybe_autotransition()&&O.actions.add_action("active_step_transition_end",this.active_step_transition_end_handler,10,this),this.listenTo(this.model,"selected_product_data_load_error",this.selection_data_load_error),this.listenTo(v.component_options_model,"component_options_data_loaded",this.component_options_flush_handler),O.actions.add_action("component_quantity_changed",this.quantity_changed_handler,100,this)},get_rendered_product:function(){return this.rendered_product},get_animation_duration:function(t){var e=v.is_current()||"single"===O.settings.layout?220:0;return t="open"!==t&&"close"!==t?"open":t,O.filters.apply_filters("component_selection_change_animation_duration",[e,t,v])},active_step_transition_handler:function(t){v.step_id===t.step_id&&this.is_relocated()&&this.reset_relocated_content()},options_state_changed_handler:function(){O.is_initialized&&this.get_rendered_product()===this.model.get("selected_product")&&this.update_selection_title()},options_state_render_handler:function(t,e){v.step_id===t.step_id&&_.contains(e,"thumbnails")&&this.is_relocated()&&v.$el.append(this.$relocation_target.hide())},options_state_rendered_handler:function(t,e){if(v.step_id===t.step_id&&_.contains(e,"thumbnails")&&this.is_relocated()){var i=this.get_new_relocation_data();i.relocate&&(this.$relocation_reference=i.reference,this.$relocation_reference.after(this.$relocation_target),this.$relocation_target.show())}},options_state_rendered_autoselect_attributes:function(t,e){v.step_id===t.step_id&&t.autoselect_attributes()&&_.contains(e,"variations")&&this.autoselect_attributes()&&v.$component_summary_content.find(".variations select").last().change()},autoselect_attributes:function(){for(var t=_.where(v.component_selection_model.get_active_variations_data(),{variation_is_active:!0}),e=!1,i="",n={},o=0,s=t.length;o<s;o++)if(t.hasOwnProperty(o)){var a=t[o].attributes;for(i in a)a.hasOwnProperty(i)&&(""===a[i]?n[i]="":""!==n[i]&&(void 0===n[i]&&(n[i]=[]),n[i].push(a[i]),n[i]=_.uniq(n[i])))}for(i in n)if(n.hasOwnProperty(i)&&""!==n[i]&&1===n[i].length){var c=n[i].pop(),r=c.replace(/"/g,'\\"'),l=v.$component_summary_content.find('.variations select[data-attribute_name="'+i+'"]');!l.val()&&l.find('option[value="'+r+'"]')&&(e=!0,l.val(c))}return e},quantity_changed_handler:function(t){t.step_id===v.step_id&&this.update_selection_title(this.model)},updated_addons_handler:function(t){if(!E(t.target).hasClass("bundled_item_cart_content")){var e,i=0,n=O.data_model.price_data.price_tax_ratios[v.component_id];if(v.has_addons()){for(var o=0,s=(e=v.$component_addons_totals.data("price_data")).length;o<s;o++){var _=e[o];if(_.is_custom_price){var a=!(!n||void 0===n.incl)&&Number(n.incl),c=!(!n||void 0===n.excl)&&Number(n.excl);"incl"===wc_composite_params.tax_display_shop&&"no"===wc_composite_params.prices_include_tax?i+=_.cost_raw/(a||1):"excl"===wc_composite_params.tax_display_shop&&"yes"===wc_composite_params.prices_include_tax?i+=_.cost_raw/(c||1):i+=_.cost_raw,i/=v.get_selected_quantity()}else"quantity_based"===_.price_type?i+=_.cost_raw_pu:"flat_fee"===_.price_type?i+=_.cost_raw/v.get_selected_quantity():"percentage_based"===_.price_type&&(i+=_.cost_raw_pct*O.data_model.price_data.prices[v.component_id])}i=i||0,v.component_selection_model.update_selected_addons(e,i);var r=O.data_model.price_data,l=r.addons_prices[v.component_id];if(l=l||0,v.show_addons_totals)if(v.passes_validation()){var d=v.get_selected_quantity();if(0<O.data_model.get_taxed_totals(l,l,n,d).price){var p=Number(r.prices[v.component_id])+Number(l),u=O.data_model.get_taxed_totals(p,p,n,d),m=wc_cp_price_format(u.price),h=O.composite_price_view.get_formatted_price_suffix(u),g='<span class="price"><span class="subtotal">'+wc_composite_params.i18n_subtotal+"</span>"+m+h+"</span>";v.$component_addons_totals.html(g)}else v.$component_addons_totals.empty()}else v.$component_addons_totals.empty();t.stopPropagation()}}},updated_nyp_handler:function(){var t=v.$component_summary_content.find(".nyp"),e=0<t.length?Number(t.data("price")):0;v.component_selection_model.update_nyp(e)},refresh_selection_title:function(){this.templates.selection_title_html="",this.update_selection_title(this.model)},update_selection_title:function(t){t=void 0===t?this.model:t,0<v.get_selected_product(!1)&&(O.console_log("debug:views",'\nUpdating "'+v.get_title()+'" selection title...'),this.update_selection_title_task(t))},get_updated_selection_title:function(t){var e=parseInt(t.get("selected_quantity"),10),i=v.get_selected_product_title(!1),n=1<e?wc_composite_params.i18n_qty_string.replace("%s",e):"";return wc_composite_params.i18n_title_string.replace("%t",i).replace("%q",n).replace("%p","")},update_selection_title_task:function(t){var e=v.$component_summary_content.find(".composited_product_title_wrapper"),i={tag:"single"!==O.settings.layout&&"progressive"!==O.settings.layout||v.has_options_style("thumbnails")?"h4":"p",show_title:"yes"===e.data("show_title"),show_selection_ui:!v.is_static(),show_reset_ui:v.show_placeholder_option()&&!1===v.maybe_is_optional()||v.is_optional()||!1===v.is_selected_product_valid(),selection_title:this.get_updated_selection_title(t),selection_data:t.get_product_data()},n=this.templates.selection_title(i);if(n!==this.templates.selection_title_html&&(this.templates.selection_title_html=n,e.html(n)),"invalid-product"===v.get_selected_product_type()){var o=v.$component_options_select.find('option[value=""]');0!==o.length&&!o.first().prop("disabled")||v.$component_summary_content.find(".clear_component_options").remove()}},block:function(){this.blocked=!0,O.block(v.$component_options)},unblock:function(){this.blocked=!1,v.$component_content.removeClass("updating"),v.$component_thumbnail_options.find(".loading").removeClass("loading"),O.unblock(v.$component_options)},is_blocked:function(){return this.blocked},option_changed:function(t){var e=t.data.view,i=E(this).val();return e.set_option(i),!1},set_option:function(t){var e=this;if(v.get_selected_product(!1)===t)return!1;if(v.has_options_style("thumbnails"))v.$component_thumbnail_options.find(".selected").removeClass("selected"),v.$component_thumbnail_options.find("#component_option_thumbnail_"+t).addClass("selected loading");else if(v.has_options_style("radios")){var i=v.$component_radio_button_options.find(".selected");i.removeClass("selected"),i.find("input").prop("checked",!1),v.$component_options.find("#component_option_radio_button_"+(""===t?"0":t)).addClass("selected").find("input").prop("checked",!0)}""!==t?(this.block(),v.$component_content.addClass("updating"),setTimeout(function(){e.model.update_selection(t)},120)):e.model.update_selection("")},selection_data_load_error:function(){var t=v.get_selected_product(!1);if(v.$component_options_select.val(t).change(),this.unblock(),v.has_options_style("thumbnails"))v.$component_thumbnail_options.find(".selected").removeClass("selected"),v.$component_thumbnail_options.find("#component_option_thumbnail_"+t).addClass("selected");else if(v.has_options_style("radios")){var e=v.$component_radio_button_options.find(".selected");e.removeClass("selected"),e.find("input").prop("checked",!1),v.$component_options.find("#component_option_radio_button_"+(""===t?"0":t)).addClass("selected").find("input").prop("checked",!0)}window.alert(wc_composite_params.i18n_selection_request_timeout)},render_default:function(){var t=this.model.get("selected_product");(this.rendered_product=t)?this.render_content():this.reset_content()},component_selection_changed_handler:function(t){return v.step_id===t.step_id&&(!v.can_autotransition()&&void this.maybe_render())},active_step_transition_end_handler:function(){this.maybe_render()},maybe_render:function(){var t=this.model.get("selected_product");return!!O.is_initialized&&(this.get_rendered_product()!==t&&void this.render())},render:function(){var t=this,e=this.model.get("selected_product");if(this.rendered_product=e,O.console_log("debug:views",'\nPreparing "'+v.get_title()+'" selection view...'),t.prepare_relocation(),e)if(t.is_relocating())if(t.is_relocating_to_origin())O.console_log("debug:animations","Starting component content height animation..."),v.$component_content.animate({height:0},{duration:t.get_animation_duration("close"),queue:!1,always:function(){O.console_log("debug:animations","Ended component content height animation."),t.reset_relocated_content(),t.render_content()}}),t.load_height=0;else{if(v.$component_content.offset().top<t.$relocation_reference.offset().top&&!1===v.$component_content.wc_cp_is_in_viewport(!0)){var i=0,n=t.load_height;setTimeout(function(){i=$wc_cp_window.scrollTop()-Math.round(n),setTimeout(function(){window.scroll(0,i),v.$component_content.css({height:0}),setTimeout(function(){t.render_content()},10)},50)},50)}else O.console_log("debug:animations","Starting component content height animation..."),v.$component_content.animate({height:0},{duration:t.get_animation_duration("close"),queue:!1,always:function(){O.console_log("debug:animations","Ended component content height animation."),t.render_content()}});t.load_height=0}else v.$component_content.css("height",t.load_height),t.render_content();else O.console_log("debug:animations","Starting component content height animation..."),v.$component_content.animate({height:0},{duration:t.get_animation_duration("close"),queue:!1,always:function(){O.console_log("debug:animations","Ended component content height animation."),t.reset_content(),v.$component_content.css({height:"auto"})}})},prepare_relocation:function(){var t=this,e=this.model.get("selected_product"),i=this.can_relocate();if(t.load_height=v.$component_content.get(0).getBoundingClientRect().height,void 0===t.load_height&&(t.load_height=v.$component_content.outerHeight()),t.relocating=!1,t.relocating_to_origin=!1,i&&!1===t.$relocation_origin&&(t.$relocation_origin=E('<div class="component_content_origin">'),v.$component_content.before(t.$relocation_origin)),i&&""!==e&&v.is_current()){var n=t.get_new_relocation_data();n.relocate&&(t.$relocation_reference=n.reference,t.relocating=n.relocate)}else t.is_relocated()&&(t.relocating=!0,t.relocating_to_origin=!0);t.relocating&&(O.actions.do_action("component_selection_details_relocation_started",[v]),v.$component_content.addClass("relocating"))},maybe_relocate_content:function(){var t=this;t.is_relocating()&&(t.is_relocated()?t.$relocation_reference.after(t.$relocation_target):(t.$relocation_target=E('<li class="component_option_content_container">'),t.$relocation_reference.after(t.$relocation_target),v.$component_content.appendTo(t.$relocation_target),O.actions.do_action("component_selection_details_relocation_container_created",[v])),t.relocated=!0,v.$component_content.addClass("relocated"))},render_content:function(){var t=this,e=t.model.get_product_data().product_html;if(O.console_log("debug:views",'\nRendering "'+v.get_title()+'" selection view content...'),v.reset_scripts(),t.maybe_relocate_content(),v.$component_summary_content.addClass("populated"),v.$component_summary_content.html(e),t.rendered_content(),O.is_finalized){var n=v.is_current()?v.$component_summary_content.find("img"):[];new m.WC_CP_Async_Task(function(){var e=!1,i=this;0<n.length&&n.each(function(){var t=E(this);if(t.is(":visible")&&0===t.height()&&i.get_async_time()<1e4)return!(e=!0)}),e||this.done()},50).complete(function(){setTimeout(function(){t.is_relocated()&&v.$component_content.removeClass("relocating"),t.animate_rendered_content()},300)})}},rendered_content:function(){O.console_log("debug:views",'\nInitializing "'+v.get_title()+'" view content scripts...'),O.debug_indent_incr(),0<this.model.get("selected_product")?v.init_scripts():v.init_scripts(!1),O.debug_indent_decr(),O.console_log("debug:views",'\nDone initializing "'+v.get_title()+'" view content scripts.'),O.actions.do_action("component_selection_details_updated",[v])},reset_content:function(){v.reset_scripts(),v.$component_summary_content.html(""),v.$component_summary_content.removeClass("populated"),0<v.$el.find(".composite_navigation.movable").length&&O.$composite_navigation_movable.addClass("hidden"),this.reset_relocated_content(),this.rendered_content(),v.$component_content.removeClass("relocating")},animate_rendered_content:function(){var t=v.$component_summary.outerHeight(!0),e=!1,i=this;(v.is_current()||"single"===O.settings.layout)&&(i.is_relocating()||1<Math.abs(t-this.load_height))?e=!0:v.$component_content.css("height","auto"),e?(O.console_log("debug:animations","Starting updated content height animation..."),v.$component_content.animate({height:t},{duration:i.get_animation_duration("open"),queue:!1,always:function(){O.console_log("debug:animations","Ended updated content height animation."),v.$component_content.css({height:"auto"}),i.unblock(),O.actions.do_action("component_selection_details_animated",[v])}})):(i.unblock(),O.actions.do_action("component_selection_details_animated",[v]))},component_options_flush_handler:function(t,e){this.is_relocated()&&"reload"===e&&"success"===t.result&&(this.flushing_component_options=!0,v.$component_content.hide(),this.reset_relocated_content(),this.flushing_component_options=!1)},reset_relocated_content:function(){var t=this;this.is_relocated()&&(t.$relocation_origin.after(v.$component_content),O.actions.do_action("component_selection_details_relocation_ended",[v]),t.$relocation_origin.remove(),t.$relocation_target.remove(),t.$relocation_origin=!1,t.$relocation_target=!1,t.$relocation_reference=!1,t.relocated=!1,t.relocating=!1,v.$component_content.removeClass("relocated"))},is_initializing_view_content:function(){return v.initializing_scripts},can_relocate:function(){var t=!1;if("paged"===O.settings.layout&&v.append_results()&&v.has_options_style("thumbnails")&&"off"!==v.get_relocation_mode())if(this.is_relocated())t=!0;else if("forced"===v.get_relocation_mode())t=!0;else if("adaptive"===v.get_relocation_mode()){1<parseInt(v.component_options_model.get("page"),10)&&(t=!0)}return t},is_relocated:function(){return this.relocated},is_relocating:function(){return this.relocating},is_relocating_to_origin:function(){return this.relocating_to_origin},get_new_relocation_data:function(){var t=!1,e=!1,i=v.$component_options.find(".component_option_thumbnail.selected").closest(".component_option_thumbnail_container"),n=i.outerWidth(!0)/v.$component_options.outerWidth(),o=i.hasClass("last")||.6<n?i:i.nextAll(".last").first();return 0===(e=0<o.length?o:v.$component_options.find(".component_option_thumbnail_container").last()).next(".component_option_content_container").length&&(t=!0),{relocate:t,reference:e}}}))(e)}},m.WC_CP_Actions_Dispatcher=function(n){var o=this,s={},a={},c={add_action:function(t,e,i,n){var o={callback:e,priority:i,context:n},s=a[t];s=s?(s.push(o),this.sort_actions(s)):[o],a[t]=s},remove_action:function(t,e,i){var n,o,s;if(a[t])if(e)if(n=a[t],i)for(s=n.length;s--;)(o=n[s]).callback===e&&o.context===i&&n.splice(s,1);else for(s=n.length;s--;)n[s].callback===e&&n.splice(s,1);else a[t]=[]},sort_actions:function(t){for(var e,i,n,o=1,s=t.length;o<s;o++){for(e=t[o],i=o;(n=t[i-1])&&n.priority>e.priority;)t[i]=t[i-1],--i;t[i]=e}return t},do_action:function(t,e){var i=a[t];if(!i)return!1;for(var n=0,o=i.length;n<o;n++)i[n].callback.apply(i[n].context,e);return!0}};this.init=function(){n.console_log("debug:events","\nInitializing Actions Dispatcher...");for(var t=0,e=n.get_steps(),i=e.length;t<i;t++)!function(i){i.is_component()&&(i.component_selection_model.on("change:selected_product change:selected_variation change:selected_variation_data",function(t){var e=E.extend(!0,{},t.changed);_.isEqual(e,s[i.step_id])||(s[i.step_id]=e,o.do_action("component_selection_changed",[i,t.changed]))}),i.component_selection_model.on("change:selected_quantity",function(){o.do_action("component_quantity_changed",[i])}),i.component_selection_model.on("change:selected_addons",function(){o.do_action("component_addons_changed",[i]),o.do_action("component_selection_content_changed",[i])}),i.component_selection_model.on("change:selected_nyp",function(){o.do_action("component_nyp_changed",[i])}),i.component_options_model.on("change:options_state",function(){o.do_action("component_options_state_changed",[i])}),i.component_options_model.on("change:active_options",function(){o.do_action("active_options_changed",[i])}),i.component_options_model.on("change:available_options",function(){o.do_action("available_options_changed",[i])}),n.data_model.on("change:component_"+i.step_id+"_totals",function(){o.do_action("component_totals_changed",[i])}),i.$el.on("woocommerce-composited-product-update",function(){o.do_action("component_selection_changed",[i])})),i.step_access_model.on("change:is_locked",function(){o.do_action("step_access_changed",[i])}),i.step_visibility_model.on("change:is_visible",function(){o.do_action("step_visibility_changed",[i])}),i.step_validation_model.on("change:composite_messages",function(){o.do_action("component_validation_message_changed",[i])}),i.step_validation_model.on("change:passes_validation",function(){o.do_action("component_validation_status_changed",[i])}),i.step_validation_model.on("change:is_in_stock",function(){o.do_action("component_availability_changed",[i])})}(e[t]);o.add_action("show_step",function(t){o.do_action("show_step_"+t.step_id)},0,this),o.add_action("active_step_changed",function(t){o.do_action("active_step_changed_"+t.step_id)},0,this),o.add_action("active_step_transition_start",function(t){o.do_action("active_step_transition_start_"+t.step_id)},0,this),o.add_action("active_step_transition_end",function(t){o.do_action("active_step_transition_end_"+t.step_id)},0,this),o.add_action("component_options_state_changed",function(t){o.do_action("component_options_state_changed_"+t.step_id)},0,this),o.add_action("active_options_changed",function(t){o.do_action("active_options_changed_"+t.step_id)},0,this),o.add_action("available_options_changed",function(t){o.do_action("available_options_changed_"+t.step_id)},0,this),o.add_action("component_selection_details_updated",function(t){o.do_action("component_selection_details_updated_"+t.step_id)},0,this),o.add_action("component_options_loaded",function(t){o.do_action("component_options_loaded_"+t.step_id),t.$el.trigger("wc-composite-component-options-loaded",[t,n])},0,this),o.add_action("component_scripts_initialized",function(t){o.do_action("component_scripts_initialized_"+t.step_id),t.$el.trigger("wc-composite-component-loaded",[t,n])},0,this),o.add_action("component_scripts_reset",function(t){o.do_action("component_scripts_reset_"+t.step_id),t.$el.trigger("wc-composite-component-unloaded",[t,n])},0,this),n.scenarios.on("active_scenarios_changed",function(t){o.do_action("active_scenarios_changed",[t])}),n.scenarios.on("active_scenarios_updated",function(t){o.do_action("active_scenarios_updated",[t])}),n.scenarios.on("hidden_components_changed",function(t){o.do_action("hidden_components_changed",[t])}),n.data_model.on("change:totals",function(){o.do_action("composite_totals_changed")}),n.data_model.on("change:passes_validation",function(){o.do_action("composite_validation_status_changed")}),n.data_model.on("change:validation_messages",function(){o.do_action("composite_validation_message_changed")}),n.data_model.on("change:is_in_stock",function(){o.do_action("composite_availability_status_changed")}),n.data_model.on("change:stock_statuses",function(){o.do_action("composite_availability_message_changed")})},this.add_action=function(t,e,i,n){return"string"==typeof t&&"function"==typeof e&&(i=parseInt(i||10,10),c.add_action(t,e,i,n)),o},this.do_action=function(t,e){return"string"==typeof t&&c.do_action(t,e),o},this.remove_action=function(t,e){return"string"==typeof t&&c.remove_action(t,e),o}},m.WC_CP_Filters_Manager=function(){var o=this,_={},s={add_filter:function(t,e,i,n){var o={callback:e,priority:i,context:n},s=_[t];s=s?(s.push(o),this.sort_filters(s)):[o],_[t]=s},remove_filter:function(t,e,i){var n,o,s;if(_[t])if(e)if(n=_[t],i)for(s=n.length;s--;)(o=n[s]).callback===e&&o.context===i&&n.splice(s,1);else for(s=n.length;s--;)n[s].callback===e&&n.splice(s,1);else _[t]=[]},sort_filters:function(t){for(var e,i,n,o=1,s=t.length;o<s;o++){for(e=t[o],i=o;(n=t[i-1])&&n.priority>e.priority;)t[i]=t[i-1],--i;t[i]=e}return t},apply_filters:function(t,e){var i=_[t];if(!i)return e[0];for(var n=0,o=i.length;n<o;n++)e[0]=i[n].callback.apply(i[n].context,e);return e[0]}};this.add_filter=function(t,e,i,n){return"string"==typeof t&&"function"==typeof e&&(i=parseInt(i||10,10),s.add_filter(t,e,i,n)),o},this.apply_filters=function(t,e){if("string"==typeof t)return s.apply_filters(t,e)},this.remove_filter=function(t,e){return"string"==typeof t&&s.remove_filter(t,e),o}},m.WC_CP_Scenarios_Manager=function(V){var M=this,U={scenario_data:V.$composite_data.data("scenario_data"),active_scenarios:{},hidden_components:[]};_.extend(M,s.Events),this.init=function(){for(var t,e=this.get_scenario_actions(),i=e.length-1;0<=i;i--)t=e[i],this.is_scenario_action_managed(t)&&(U.active_scenarios[t]=[]);V.actions.add_action("available_options_changed",this.available_options_changed_handler,-10,this),V.actions.add_action("component_selection_changed",this.selection_changed_handler,10,this),V.console_log("debug:events","\nInitializing Scenarios Manager..."),V.debug_indent_incr(),M.update_active_scenarios(_.first(V.steps),!1,!1),V.debug_indent_decr(),V.console_log("debug:events","\nScenarios Manager initialized.\n")},this.get_scenarios_by_type=function(t){return this.filter_scenarios_by_type(this.get_scenario_data().scenarios,t)},this.get_scenario_actions=function(){return _.keys(U.scenario_data.action_settings)},this.get_scenario_action_settings=function(t){return U.scenario_data.action_settings[t]||[]},this.is_scenario_action_managed=function(t){return"yes"===M.get_scenario_action_settings(t).is_managed},this.is_scenario_action_calculation=function(t,e){return _.contains(M.get_scenario_action_settings(t).calculation,e)},this.get_active_scenarios=function(){return U.active_scenarios},this.get_active_scenarios_by_type=function(t){return U.active_scenarios[t]||[]},this.get_scenario_data=function(){return U.scenario_data},this.set_component_scenario_data=function(t,e){U.scenario_data.scenario_data[t]=e},this.merge_component_scenario_data=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(U.scenario_data.scenario_data[t][i]=e[i])},this.selection_changed_handler=function(t){V.console_log("debug:scenarios",'\nUpdating active scenarios in response to "'+t.get_title()+'" selection state change...'),V.debug_indent_incr(),this.update_active_scenarios(t),V.debug_indent_decr()},this.available_options_changed_handler=function(t){V.console_log("debug:scenarios",'\nUpdating active scenarios in response to "'+t.get_title()+'" options state change...'),V.debug_indent_incr(),this.update_active_scenarios(t),V.debug_indent_decr()},this.update_active_scenarios=function(t){var e,i=U.active_scenarios,n=U.hidden_components,o={},s=[],a=this.get_scenario_actions();o.conditional_components=this.calculate_active_scenarios("conditional_components"),n.length!==U.hidden_components.length||n.length!==_.intersection(n,U.hidden_components).length?(V.console_log("debug:scenarios","\nHidden components changed: - ["+n+"] => ["+U.hidden_components+"]"),s.push("conditional_components"),this.trigger("hidden_components_changed",t)):V.console_log("debug:scenarios","\nHidden components unchanged.");for(var c=0;c<a.length;c++)"conditional_components"!==(e=a[c])&&this.is_scenario_action_managed(e)&&(o[e]=this.calculate_active_scenarios(e),i[e].length===o[e].length&&i[e].length===_.intersection(i[e],o[e]).length||s.push(e));if(s.length){U.active_scenarios=o;for(var r=s.length-1;0<=r;r--)e=s[r],V.console_log("debug:scenarios",'\nActive "'+e+'" scenarios changed: - ['+i[e]+"] => ["+o[e]+"]");this.trigger("active_scenarios_changed",t,s)}else V.console_log("debug:scenarios","\nActive scenarios unchanged.");this.trigger("active_scenarios_updated",t)},this.calculate_active_scenarios=function(t,e,i,n){var o=!!e&&e.step_index,s=M.get_scenarios_by_type(t);if("compat_group"===t&&0===s.length&&s.push("0"),0===s.length)return[];e&&e.is_review()&&(o=1e3);var a=this.is_scenario_action_calculation(t,"preemptive"),c=this.is_scenario_action_calculation(t,"masked"),r=this.is_scenario_action_calculation(t,"strict"),l=this.is_scenario_action_calculation(t,"skip_invalid"),d=a?s:[],p=[],u=[];V.console_log("debug:scenarios",'\nCalculating active "'+t+'" Scenarios...\n');for(var m=0,h=V.get_components(),g=h.length;m<g;m++){var v=h[m];if(0<v.step_index)if("conditional_components"===t){var f=!0,b=d;c&&p.length&&(V.console_log("debug:scenarios",'Removing "conditional_component" scenarios where all scenario shaping components ('+p+") are masked..."),b=M.get_binding_scenarios(b,p)),r&&(V.console_log("debug:scenarios",'Removing "conditional_component" scenarios that contain any non-shaping + non-masked components...'),b=M.get_strictly_matching_scenarios(b,p)),V.console_log("debug:scenarios",'Removing "conditional_component" scenarios that contain any hidden + non-masked components...'),b=M.get_visible_component_scenarios(b,u),V.console_log("debug:scenarios",'Calculating "'+v.get_title()+'" visibility...'),V.debug_indent_incr(),V.console_log("debug:scenarios",'Active "Hide Components" Scenarios: ['+b+"]");var w=M.get_scenario_data().scenario_settings.conditional_components;if(0<b.length&&void 0!==w)for(var y in w)if(w.hasOwnProperty(y)){var $=w[y];_.contains(b,y.toString())&&_.contains($,v.component_id.toString())&&(f=!1)}if(f?V.console_log("debug:scenarios","Component is visible."):(u.push(v.component_id.toString()),V.console_log("debug:scenarios","Component is hidden.")),V.debug_indent_decr(),!f)continue}else if(!v.is_visible())continue;if(!e||!n||parseInt(v.step_index,10)!==parseInt(o,10)){if(e&&i&&v.step_index>o)break;var k=v.get_selected_product(!1),x=v.get_selected_product_type(),C="variable"===x?v.get_selected_variation(!1):"";if(null!==k&&0<=k){var q=M.get_scenario_data().scenario_data[v.component_id];if(""===k){if(!(0 in q))continue;k="0"}var z=[];if("variable"===x){if(a||C)z=k in q?M.filter_scenarios_by_type(q[k],t):[];else if(!C&&!(z=k+"_variations"in q?M.filter_scenarios_by_type(q[k+"_variations"],t):[]).length){V.console_log("debug:scenarios","Selection #"+k+' of "'+v.get_title()+'" not contributing to the active "'+t+'" Scenarios.');continue}}else z=k in q?M.filter_scenarios_by_type(q[k],t):[];V.console_log("debug:scenarios","Selection #"+k+' of "'+v.get_title()+'" in Scenarios: ['+z+"]");var S=a||0!==p.length?_.intersection(d,z):z;if("variable"===x&&0<C&&0<S.length){var T=C in q?M.filter_scenarios_by_type(q[C],t):[];V.console_log("debug:scenarios","Variation selection #"+C+' of "'+v.get_title()+'" in Scenarios: ['+T+"]"),S=_.intersection(S,T)}(!l||0<S.length)&&(p.push(v.component_id),V.console_log("debug:scenarios","Active Scenarios: ["+S+"]"),d=S)}}}return"conditional_components"===t&&(U.hidden_components=u),c&&p.length&&(V.console_log("debug:scenarios","Removing scenarios where all scenario shaping components ("+p+") are masked..."),d=M.get_binding_scenarios(d,p)),r&&(V.console_log("debug:scenarios","Removing scenarios that contain any non-shaping + non-masked components..."),d=M.get_strictly_matching_scenarios(d,p)),V.console_log("debug:scenarios","Calculated scenarios: ["+d+"]\n"),d},this.get_binding_scenarios=function(t,e){var i=this.get_scenario_data().scenario_settings.masked_components,n=t.length,o=[];if(0<e.length){if(0<n)for(var s=0;s<n;s++){for(var _=t[s],a=!0,c=0,r=e.length;c<r;c++){var l=e[c];if(-1==E.inArray(l.toString(),i[_])){a=!1;break}}a||o.push(_)}}else o=t;return 0===o.length&&0<n&&(o=t),o},this.filter_scenarios_by_type=function(t,e){var i=[],n=t.length,o="";if(0<n)for(var s=0;s<n;s++)"0"===(o=t[s])&&"compat_group"===e?i.push(o):("all"===e||-1<E.inArray(e,this.get_scenario_data().scenario_settings.scenario_actions[o]))&&i.push(o);return i},this.clean_masked_scenarios=function(t,e){var i=this.get_scenario_data().scenario_settings.masked_components,n=t.length,o=[],s="";if(0<n)for(var _=0;_<n;_++)s=t[_],-1==E.inArray(e.toString(),i[s])&&o.push(s);return o},this.get_masked_scenarios=function(t,e){var i=this.get_scenario_data().scenario_settings.masked_components,n=t.length,o=[],s="";if(0<n)for(var _=0;_<n;_++)s=t[_],-1<E.inArray(e.toString(),i[s])&&o.push(s);return o},this.get_unmasked_scenarios=function(t,e){var i=this.get_scenario_data().scenario_settings.masked_components,n=t.length,o=[],s="";if(0<n)for(var _=0;_<n;_++)s=t[_],-1===E.inArray(e.toString(),i[s])&&o.push(s);return o},this.get_strictly_matching_scenarios=function(t,e){for(var i=_.difference(_.pluck(V.get_components(),"component_id"),e),n=0,o=i.length;n<o;n++)t=_.difference(t,this.get_unmasked_scenarios(t,i[n]));return t},this.get_visible_component_scenarios=function(t,e){for(var i=0,n=e.length;i<n;i++)t=_.difference(t,this.get_unmasked_scenarios(t,e[i]));return t},this.is_component_hidden=function(t){return _.contains(U.hidden_components,t.toString())},this.get_hidden_components=function(){return U.hidden_components}},m.WC_CP_Step_Factory=function(){function n(t,e,i){this.composite=t,this.$step=e,this.step_index=i,this.init_step()}n.prototype.init_step=function(){this.step_id=this.$step.data("item_id"),this.step_title=this.$step.data("nav_title"),this.step_slug=this.composite.settings.slugs[this.step_id],this._component_messages=[],this._composite_messages=[],this._is_component=this.$step.hasClass("component"),this._is_review=this.$step.hasClass("cart"),this._is_current=this.$step.hasClass("active"),this._is_previous=this.$step.hasClass("prev"),this._is_next=this.$step.hasClass("next"),this._is_last=this.$step.hasClass("last"),this._toggled=this.$step.hasClass("toggled"),this._autotransition=this.$step.hasClass("autotransition"),this._autoselect_attributes=this.$step.hasClass("autoselect_attributes"),this.$el=this.$step,this.$inner_el=this.$step.find(".component_inner"),this.$step_title=this.$step.find(".step_title_wrapper"),this.composite.actions.add_action("step_visibility_changed",this.step_visibility_changed_handler,10,this)},n.prototype.step_visibility_changed_handler=function(){var t=this.composite;if("paged"!==t.settings.layout&&(!1===this.is_visible()?t.is_initialized?this.$el.slideUp(200):this.$el.hide():this.$el.slideDown(200)),!t.is_initialized)return!1;this.is_current()&&t.set_current_step(t.get_current_step())},n.prototype.maybe_autotransition=function(){return this._autotransition&&"single"!==this.composite.settings.layout},n.prototype.can_autotransition=function(){return this.maybe_autotransition()&&this.passes_validation()&&0<this.get_selected_product()&&"invalid-product"!==this.get_selected_product_type()&&!1===this.is_selected_product_configurable()&&("progressive"!==this.composite.settings.layout||!this.is_last())},n.prototype.autoselect_attributes=function(){return this._autoselect_attributes},n.prototype.is_animating=function(){return this.$el.hasClass("animating")},n.prototype.has_toggle=function(){return this._toggled},n.prototype.is_locked=function(){var t=this.step_access_model.get("is_locked");return this.composite.filters.apply_filters("step_is_locked",[t,this])},n.prototype.is_visible=function(){return this.step_visibility_model.get("is_visible")},n.prototype.lock=function(){this.step_access_model.set({locked:!0})},n.prototype.unlock=function(){this.step_access_model.set({locked:!1})},n.prototype.get_title_index=function(){var e=this,t=this.composite,i=_.filter(t.get_steps(),function(t){if(!1===t.step_visibility_model.get("is_visible")&&t.step_index<e.step_index)return t}).length;return this.step_index+1-i},n.prototype.get_title=function(){return this.step_title},n.prototype.get_slug=function(){return this.step_slug},n.prototype.get_route=function(){return"#"+this.step_slug},n.prototype.get_element=function(){return this.$el},n.prototype.is_review=function(){return this._is_review},n.prototype.is_component=function(){return this._is_component},n.prototype.get_component=function(){return!!this._is_component&&this},n.prototype.is_current=function(){return this._is_current},n.prototype.is_next=function(){return this._is_next},n.prototype.is_previous=function(){return this._is_previous},n.prototype.is_last=function(){return this._is_last},n.prototype.show_step=function(){if(this.is_locked()||this.is_animating())return!1;var t=this.is_current(),e=this.composite;"single"===e.settings.layout&&e.is_initialized&&this.toggle_step("open",!0),t&&e.is_initialized||this.set_active(),e.actions.do_action("show_step",[this])},n.prototype.set_active=function(){var i=this,n=this.composite,t=n.settings.layout,e=n.get_current_step(),o=e.$el,s=i.$el,_=i.step_index-e.step_index,a=0;n.set_current_step(i),n.actions.do_action("active_step_transition",[this]),e.step_id!==i.step_id?"paged"===t?(n.$composite_form_blocker.addClass("blocked"),n.has_transition_lock=!0,setTimeout(function(){var t="faded",e="invisible faded";0<_?(t+=" faded-out",e+=" faded-in"):(t+=" faded-in",e+=" faded-out"),o.addClass(t),s.addClass(e),setTimeout(function(){void 0===(a=o.get(0).getBoundingClientRect().height)&&(a=o.outerHeight()),o.addClass("invisible"),o.css("height",a),n.actions.do_action("active_step_transition_start",[i]),n.console_log("debug:events","Starting transition..."),o.slideUp({duration:150,always:function(){o.css("height","auto")}}),s.slideDown({duration:150,always:function(){setTimeout(function(){n.actions.do_action("active_step_transition_end",[i])},250),n.console_log("debug:events","Transition ended."),setTimeout(function(){n.$steps.removeClass("faded-in faded-out faded invisible"),"yes"===wc_composite_params.accessible_focus_enabled&&setTimeout(function(){i.$step_title.focus()},250)},10),n.has_transition_lock=!1,n.$composite_form_blocker.removeClass("blocked")}})},250)},10)):("progressive"===t&&i.update_block_state(),n.has_transition_lock=!0,setTimeout(function(){n.actions.do_action("active_step_transition_start",[i])},5),setTimeout(function(){n.actions.do_action("active_step_transition_end",[i]),n.has_transition_lock=!1},350)):i.$el.show(),n.actions.do_action("active_step_changed",[this])},n.prototype.update_block_state=function(){if("progressive"!==this.composite.settings.layout)return!1;for(var t=0,e=this.composite.get_steps(),i=e.length;t<i;t++)e[t].step_index<this.step_index&&(e[t].block_step_inputs(),e[t].$el.hasClass("block-open")||e[t].toggle_step("closed",!0));this.unblock_step_inputs(),this.unblock_step(),this.block_next_steps()},n.prototype.unblock_step=function(){this.toggle_step("open",!0),this.$el.removeClass("blocked")},n.prototype.block_next_steps=function(){for(var t=this.step_index,e=0,i=this.composite.get_steps(),n=i.length;e<n;e++)t<e&&(i[e].$el.hasClass("disabled")&&i[e].unblock_step_inputs(),i[e].block_step())},n.prototype.block_step=function(){this.$el.addClass("blocked"),this.toggle_step("closed",!1)},n.prototype.toggle_step=function(t,e,i){this.has_toggle()&&("open"===t?this.$el.hasClass("closed")&&wc_cp_toggle_element(this.$el,this.$inner_el,i):"closed"===t&&this.$el.hasClass("open")&&wc_cp_toggle_element(this.$el,this.$inner_el,i),e?this.$step_title.removeClass("inactive"):this.$step_title.addClass("inactive"))},n.prototype.unblock_step_inputs=function(){this.$el.removeClass("disabled"),this.$el.find(".clear_component_options").html(wc_composite_params.i18n_clear_selection).removeClass("reset_component_options")},n.prototype.block_step_inputs=function(){this.$el.addClass("disabled"),this.has_toggle()&&!this.$el.hasClass("block-open")||this.$el.find(".clear_component_options").html(wc_composite_params.i18n_reset_selection).addClass("reset_component_options")},n.prototype.is_blocked=function(){return this.$el.hasClass("blocked")},n.prototype.has_blocked_inputs=function(){return this.$el.hasClass("disabled")},n.prototype.add_validation_message=function(t,e){"composite"===(e=void 0===e?"component":e)?this._composite_messages.push(t.toString()):this._component_messages.push(t.toString())},n.prototype.get_validation_messages=function(t){var e;return e="composite"===(t=void 0===t?"component":t)?this._composite_messages:this._component_messages,this.composite.filters.apply_filters("step_validation_messages",[e,t,this])},n.prototype.validate=function(){var t=!0,e=!0;if(this._component_messages=[],this._composite_messages=[],this.is_component()){var i=this.get_selected_product(),n=this.get_selected_product_type();(t=this.has_valid_selections())||(0<i?"invalid-product"===n?this.add_validation_message(wc_composite_params.i18n_item_unavailable_text,"composite"):("variable"===n&&(this.is_selected_variation_valid()?(this.add_validation_message(wc_composite_params.i18n_select_product_options),this.add_validation_message(wc_composite_params.i18n_select_product_options_for,"composite")):this.add_validation_message(wc_composite_params.i18n_selected_product_options_invalid,"composite")),this.has_required_addons()&&!this.has_valid_required_addons()&&(this.add_validation_message(wc_composite_params.i18n_select_product_addons),this.add_validation_message(wc_composite_params.i18n_select_product_addons_for,"composite"))):this.is_selected_product_valid()?(this.add_validation_message(wc_composite_params.i18n_select_component_option),this.add_validation_message(wc_composite_params.i18n_select_component_option_for,"composite")):(this.add_validation_message(wc_composite_params.i18n_selected_product_invalid),this.add_validation_message(wc_composite_params.i18n_selected_product_invalid,"composite"))),this.is_in_stock()||(this.add_validation_message(wc_composite_params.i18n_selected_product_stock_insufficient),e=t=!1)}t=this.composite.filters.apply_filters("step_is_valid",[t,this]),this.composite.actions.do_action("validate_step",[this,t]),this.step_validation_model.update(t,e)},n.prototype.passes_validation=function(){return this.step_validation_model.get("passes_validation")};function o(t,e,i){n.call(this,t,e,i),this.init_component()}function t(){}((o.prototype=(t.prototype=n.prototype,new t)).constructor=o).prototype.init_component=function(){this.initializing_scripts=!1,this.component_index=this.step_index,this.component_id=this.$step.attr("data-item_id"),this.component_title=this.$step.data("nav_title"),this._hide_disabled_products=this.$step.hasClass("hide-incompatible-products"),this._hide_disabled_variations=this.$step.hasClass("hide-incompatible-variations"),this._is_static=this.$step.hasClass("static"),this.$component_summary=this.$step.find(".component_summary"),this.$component_summary_content=this.$step.find(".component_summary > .content"),this.$component_selections=this.$step.find(".component_selections"),this.$component_content=this.$step.find(".component_content"),this.$component_options=this.$step.find(".component_options"),this.$component_filters=this.$step.find(".component_filters"),this.$component_ordering=this.$step.find(".component_ordering select"),this.$component_options_inner=this.$step.find(".component_options_inner"),this.$component_inner=this.$step.find(".component_inner"),this.$component_pagination=this.$step.find(".component_pagination"),this.$component_message=this.$step.find(".component_message"),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),this.$component_options_select=this.$component_options.find("select.component_options_select"),this.$component_thumbnail_options=this.$component_options.find(".component_option_thumbnails"),this.$component_radio_button_options=this.$component_options.find(".component_option_radio_buttons"),this.$component_content_scroll_target=this.$step.find(".scroll_show_component_details"),this.$component_addons_totals=!1,this.$required_addons=!1,this.$component_selection_gallery=!1,this.$component_variations_reset_wrapper=!1,this.show_addons_totals=!1,this.has_wc_core_gallery_class=!1,0===this.$component_content_scroll_target.length&&(this.$component_content_scroll_target=this.$component_content)},o.prototype.append_results=function(){return"yes"===this.composite.settings.pagination_data[this.step_id].append_results},o.prototype.get_results_per_page=function(){return this.composite.settings.pagination_data[this.step_id].results_per_page},o.prototype.get_max_results=function(){return this.composite.settings.pagination_data[this.step_id].max_results},o.prototype.get_pagination_range=function(t){void 0===t&&(t="mid");var e="end"===t?"pagination_range_end":"pagination_range";return this.composite.settings.pagination_data[this.step_id][e]},o.prototype.get_relocation_mode=function(){return this.composite.settings.pagination_data[this.step_id].relocation_mode},o.prototype.get_selected_product=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),t&&!this.is_selected_product_valid()||e&&!this.is_visible()?null:this.component_selection_model.get("selected_product")},o.prototype.get_selected_variation=function(t){return void 0===t&&(t=!0),t&&!this.is_selected_variation_valid()?null:this.component_selection_model.get("selected_variation")},o.prototype.get_selected_quantity=function(){return!1===this.is_visible()?0:this.component_selection_model.get("selected_quantity")},o.prototype.get_selected_product_type=function(){return this.component_selection_model.get_type()},o.prototype.get_selected_product_title=function(t,e){if(t=void 0!==t&&t,(e=void 0!==e&&e)&&!this.is_selected_product_valid())return"";var i=this.get_selected_product(!1),n=this.get_selected_quantity(),o="",s="",_="",a="";if(""===i)o=wc_composite_params.i18n_no_selection;else if(""!==i&&0<this.component_options_model.available_options_data.length)for(var c=0,r=this.component_options_model.available_options_data,l=r.length;c<l;c++)if(r[c].option_id===i){o=r[c].option_title;break}return(o=this.composite.filters.apply_filters("component_selection_title",[o,this]))&&t&&(s=""===i?'<span class="content_product_title none">'+o+"</span>":(a=1<n?"<strong>"+wc_composite_params.i18n_qty_string.replace("%s",n)+"</strong>":"",s=wc_composite_params.i18n_title_string.replace("%t",o).replace("%q",a).replace("%p",""),(_=this.get_selected_product_meta(!0))&&(s=wc_composite_params.i18n_selected_product_string.replace("%t",s).replace("%m",_)),'<span class="content_product_title">'+s+"</span>"),s=this.composite.filters.apply_filters("component_selection_formatted_title",[s,o,n,_,this])),t?s:o},o.prototype.get_selected_product_meta=function(t){t=void 0!==t&&t;var e="",i=this.component_selection_model.get_meta_data();if(0<(i=this.composite.filters.apply_filters("component_selection_meta",[i,this])).length&&t){e='<ul class="content_product_meta">';for(var n=0,o=i.length;n<o;n++)e=e+'<li class="meta_element"><span class="meta_key">'+i[n].meta_key+':</span> <span class="meta_value">'+i[n].meta_value+"</span>",n!==o-1&&(e+='<span class="meta_element_sep">, </span>'),e+="</li>";e+="</ul>",e=this.composite.filters.apply_filters("component_selection_formatted_meta",[e,i,this])}return t?e:i},o.prototype.get_selected_product_image_data=function(t){if((t=void 0===t||t)&&!this.is_selected_product_valid())return!1;var e=0<this.get_selected_variation(t)&&this.component_selection_model.get_variation_image_data();return 0<this.get_selected_variation(t)&&e?e:this.component_selection_model.get_product_image_data()},o.prototype.is_selected_product_configurable=function(){var t=this.component_options_model.get_option_data(this.get_selected_product());return!(!t||!t.is_configurable)},o.prototype.is_selected_product_valid=function(t){return void 0===t&&(t=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_product")||_.contains(t,this.component_selection_model.get("selected_product"))},o.prototype.is_selected_variation_valid=function(t){return void 0===t&&(t=this.component_options_model.get("active_options")),""===this.component_selection_model.get("selected_variation")||_.contains(t,this.component_selection_model.get("selected_variation"))},o.prototype.has_valid_selections=function(t){t=void 0===t||t;var e=this.get_selected_product(t),i=this.get_selected_variation(t),n=this.get_selected_product_type(),o=!1;return this.is_visible()?""===e?(this.is_optional()||!1===t&&this.maybe_is_optional())&&(o=!0):0<e&&"invalid-product"!==n&&("variable"===n?(i||0===this.get_selected_quantity()&&this.composite.is_initialized)&&(o=!0):"simple"===n||"bundle"===n||"none"===n?o=!0:0===this.get_selected_quantity()&&(o=!0)):o=!0,o&&this.is_visible()&&this.has_required_addons()&&(o=this.has_valid_required_addons()),this.composite.filters.apply_filters("component_is_valid",[o,t,this])},o.prototype.has_valid_required_addons=function(){return 0===this.$component_summary_content.find("input, textarea, select").filter("[required]").filter(function(){return""===this.value}).length},o.prototype.hide_disabled_products=function(){return this.composite.filters.apply_filters("component_hide_disabled_products",[this._hide_disabled_products,this])},o.prototype.hide_disabled_variations=function(){return this.composite.filters.apply_filters("component_hide_disabled_variations",[this._hide_disabled_variations,this])},o.prototype.find_selected_product_param=function(){return this.composite.console_log("error","\nMethod 'WC_CP_Component::find_selected_product_param' has been deprecated with no alternatives or fallbacks since v4.0.0. Please update your code!"),!1},o.prototype.find_pagination_param=function(t){var e=this.$component_pagination.first().data("pagination_data"),i=1;return e&&("page"===t?i=e.page:"pages"===t&&(i=e.pages)),i},o.prototype.find_order_by=function(){var t="";return 0<this.$component_ordering.length&&(t=this.$component_ordering.val()),t},o.prototype.find_active_filters=function(){var t=this.$component_filters,n={};return 0==t.length||t.find(".component_filter_option.selected").each(function(){var t=E(this).closest(".component_filter").data("filter_type"),e=E(this).closest(".component_filter").data("filter_id"),i=E(this).data("option_id");t in n?e in n[t]||(n[t][e]=[]):(n[t]={},n[t][e]=[]),n[t][e].push(i)}),n},o.prototype.find_options_data=function(){return this.$component_options.data("options_data")},o.prototype.is_in_stock=function(){var t=!0;return 0<this.get_selected_quantity()&&"out-of-stock"===this.component_selection_model.get_stock_status()&&("variable"!==this.get_selected_product_type()||0<this.get_selected_variation(!1))&&(t=!1),t},o.prototype.is_nyp=function(){return 0<this.component_selection_model.get("selected_nyp")},o.prototype.has_options_style=function(t){return this.$el.hasClass("options-style-"+t)},o.prototype.get_bundle_script=function(){var t=!1;return void 0!==wc_pb_bundle_scripts[this.component_id]&&(t=wc_pb_bundle_scripts[this.component_id]),t},o.prototype.has_addons=function(){var t=this.component_options_model.get_option_data(this.get_selected_product());return!(!t||!t.has_addons)},o.prototype.has_required_addons=function(){var t=this.component_options_model.get_option_data(this.get_selected_product());return!(!t||!t.has_required_addons)},o.prototype.init_scripts=function(t){if(void 0===t&&(t=!0),this.$component_quantity=this.$component_summary_content.find(".component_wrap input.qty"),this.$component_selection_gallery=!1,this.has_wc_core_gallery_class=!1,this.$component_addons_totals=!1,this.$required_addons=!1,this.show_addons_totals=!1,t){this.initializing_scripts=!0,this.init_qty_input();var e=this.get_selected_product_type(),i=this.$component_summary_content;if(this.$component_selection_gallery=this.$component_summary_content.find(".composited_product_images"),this.$component_selection_gallery&&(this.has_wc_core_gallery_class=this.$component_selection_gallery.hasClass("images")),this.has_addons()?(this.$required_addons=i.find(".wc-pao-required-addon, .required-product-addon"),this.$component_addons_totals="bundle"===e?i.find(".bundle_data #product-addons-total"):i.find("#product-addons-total"),1==this.$component_addons_totals.data("show-sub-total")&&(this.$component_addons_totals.data("show-sub-total",0),this.show_addons_totals="bundle"!==e)):this.$component_addons_totals=!1,"variable"===e){i.hasClass("cart")||i.addClass("cart"),i.hasClass("variations_form")||i.addClass("variations_form"),this.$component_summary_content.data("product_variations",this.component_selection_model.get_active_variations_data());var n=this.$component_summary_content.find(".variations");if(0<n.length){this.$component_variations_reset_wrapper=n.find(".reset_variations_wrapper"),0===this.$component_variations_reset_wrapper.length&&(this.$component_variations_reset_wrapper=!1);var o=this.component_selection_model.get_active_variations_data(),s=wc_cp_get_variation_data(n,!1,!0);0===this.get_matching_variations(o,s).length&&n.find("select").val(""),this.autoselect_attributes()&&this.component_selection_view.autoselect_attributes()}i.wc_variation_form(),i.find(".variations select").last().change(),i.find("div").stop(!0,!0)}else"bundle"===e?(i.hasClass("bundle_form")||i.addClass("bundle_form"),i.find(".bundle_data").wc_pb_bundle_form(),i.find("div").stop(!0,!0)):i.hasClass("cart")||i.addClass("cart");this.initializing_scripts=!1}this.composite.actions.do_action("component_scripts_initialized",[this])},o.prototype.get_matching_variations=function(t,e){for(var i=[],n=0,o=t.length;n<o;n++){var s=t[n];s.variation_is_active&&this.is_matching_variation(s.attributes,e)&&i.push(s)}return i},o.prototype.is_matching_variation=function(t,e){var i=!0;for(var n in t)if(t.hasOwnProperty(n)){var o=t[n],s=e[n];void 0!==o&&void 0!==s&&0!==o.length&&0!==s.length&&o!==s&&(i=!1)}return i},o.prototype.reset_scripts=function(){this.$component_summary_content.removeClass("variations_form bundle_form cart"),this.$component_summary_content.off().find("*").off(),this.composite.actions.do_action("component_scripts_reset",[this])},o.prototype.get_step=function(){return this.composite.get_step(this.component_id)},o.prototype.is_static=function(){return this._is_static},o.prototype.is_optional=function(){var t=_.contains(this.component_options_model.get("active_options"),"");return this.composite.filters.apply_filters("component_is_optional",[t,this])},o.prototype.maybe_is_optional=function(){return 0 in this.composite.scenarios.get_scenario_data().scenario_data[this.component_id]},o.prototype.show_placeholder_option=function(){return"yes"===this.composite.settings.show_placeholder_option[this.step_id]},o.prototype.is_selected_product_price_visible=function(){return"yes"===this.composite.settings.selected_product_price_visibility_data[this.step_id]},o.prototype.is_subtotal_visible=function(){return"yes"===this.composite.settings.subtotal_visibility_data[this.step_id]},o.prototype.is_priced_individually=function(){return"yes"===this.composite.data_model.price_data.is_priced_individually[this.component_id]},o.prototype.get_price_display_format=function(){return this.composite.settings.price_display_data[this.step_id].format},o.prototype.get_formatted_option_price_html=function(t){var e=this,i=this.composite,n=e.get_price_display_format(),o=t.option_price_html,s=t.option_price_data;if(e.is_priced_individually()&&"relative"===n){var _=!1,a="yes"===i.settings.price_display_data[e.step_id].is_relative_to_default,c=!0,r=a&&t.option_id===e.component_options_view.reference_option,l=e.component_options_view.get_reference_option_data(),d=e.has_valid_selections(!1);if(a&&!1===l.option_id&&(a=!1),!1===d&&!1===a&&(c="yes"!==i.settings.price_display_data[e.step_id].show_absolute_if_invalid),c&&(r?_=!0:!1===a&&(!1!==d&&!t.is_selected||(_=!0))),_)o="";else{var p=i.data_model.calculate_component_subtotals(e,i.data_model.price_data,1),u=a?l.option_price:p.price,m=t.is_selected&&c&&a&&d,h=c?u:0,g=m?p.price:parseFloat(s.price),v=m?p.regular_price:parseFloat(s.regular_price),f=parseFloat(g)-parseFloat(h),b=0,w=0,y=!1===m&&(g<s.max_price||""===s.max_price),$=1<s.min_qty?wc_composite_params.i18n_per_unit_string:"",k="",x="",C="",q="";x=e.get_formatted_price_html(f,c),e.has_options_style("dropdowns")?(g<v&&(s.discount&&(k=wc_composite_params.i18n_discount_string.replace("%s",wc_cp_number_round(s.discount,1))),!k&&g<v&&(k=wc_composite_params.i18n_discount_string.replace("%s",wc_cp_number_round(100*(v-g)/v,1))),k=i.filters.apply_filters("formatted_option_price_discount_suffix",[k,s,this])),y&&(x=""===s.max_price?wc_composite_params.i18n_price_from_string_plain.replace("%p",x):(w=parseFloat(s.max_price)-parseFloat(h),q=e.get_formatted_price_html(w,c,f),wc_composite_params.i18n_price_range_string_plain.replace("%f",x).replace("%t",q))),x=wc_composite_params.i18n_price_string.replace("%p",x).replace("%q",$).replace("%d",k)):(g<v&&(!y||""===s.max_price)&&(b=parseFloat(v)-parseFloat(h),C=e.get_formatted_price_html(b,c,f),x=wc_composite_params.i18n_strikeout_price_string.replace("%f",C).replace("%t",x)),y&&(x=""===s.max_price?wc_composite_params.i18n_price_from_string.replace("%p",x):(w=parseFloat(s.max_price)-parseFloat(h),q=e.get_formatted_price_html(w,c,f),!1===c?wc_composite_params.i18n_price_range_string_absolute.replace("%f",x).replace("%t",q):wc_composite_params.i18n_price_range_string.replace("%f",x).replace("%t",q)))),o=x}o||(e.has_options_style("thumbnails")?o="&nbsp;":e.has_options_style("radios")&&(o="&mdash;"))}return i.filters.apply_filters("formatted_option_price_html",[o,t,this])},o.prototype.get_formatted_price_html=function(t,e,i){var n="",o=wc_cp_price_format(Math.abs(t),this.has_options_style("dropdowns"));return i=void 0!==i&&i,(e=void 0!==e&&e)&&(n=0<t||0==t&&!i?"+":t<0?"-":0<=i?"+":"-"),n=n&&this.has_options_style("dropdowns")?n:'<span class="relative-price-prefix">'+n+"</span>",o=wc_composite_params.i18n_price_signed.replace("%s",n).replace("%p",o)},o.prototype.init_qty_input=function(){"yes"===wc_composite_params.show_quantity_buttons&&this.$component_summary_content.find("div.quantity:not(.buttons_added), td.quantity:not(.buttons_added)").addClass("buttons_added").append('<input type="button" value="+" class="plus" />').prepend('<input type="button" value="-" class="minus" />'),"hidden"===this.$component_quantity.attr("type")&&(this.$component_quantity.attr("min",this.$component_quantity.val()),this.$component_quantity.attr("max",this.$component_quantity.val()));var t=this.composite.is_finalized?this.get_selected_quantity():this.$component_quantity.val();"yes"===this.composite.settings.component_qty_restore&&this.get_selected_product(!1)&&this.$component_quantity.val(t),this.$component_quantity.trigger("change")},o.prototype.get_placeholder_image_data=function(){return void 0!==this.composite.settings.image_data[this.step_id]&&this.composite.settings.image_data[this.step_id]},this.create_component=function(t,e,i){return new o(t,e,i)},this.create_step=function(t,e,i){return e.hasClass("component")?this.create_component(t,e,i):new n(t,e,i)}},m.WC_CP_Async_Task=function(e,i){var n=this,t=!1,o=0,s=function(t){return t};i=i||100,e=e.bind(this),this.is_done=function(){return t},this.get_async_time=function(){return o},this.run=function(t){setTimeout(function(){t=e(t),n.is_done()?s(t):(o+=i,n.run(t))},i)},this.done=function(){t=!0},this.complete=function(t){s=t},this.run()},$wc_cp_document.ready(function(){($wc_cp_body=E(document.body)).on("quick-view-displayed",function(){E(".quick-view .composite_form .composite_data").each(function(){E(this).wc_composite_form()})}),$wc_cp_window.resize(function(){for(var t in wc_cp_composite_scripts)wc_cp_composite_scripts.hasOwnProperty(t)&&(clearTimeout(wc_cp_composite_scripts[t].timers.on_resize_timer),wc_cp_composite_scripts[t].timers.on_resize_timer=setTimeout(function(t){return function(){wc_cp_composite_scripts[t].on_resize_handler()}}(t),50))}),E.fn.wc_composite_form=function(){if(!E(this).hasClass("composite_data"))return!0;var t=E(this).data("container_id"),e=E(this).closest(".composite_form");if(void 0!==wc_cp_composite_scripts[t]){e.find("*").off();for(var i=0,n=wc_cp_composite_scripts[t].get_components(),o=n.length;i<o;i++)n[i].reset_scripts()}wc_cp_composite_scripts[t]=new a({$composite_form:e,$composite_data:E(this)}),e.data("script_id",t),wc_cp_composite_scripts[t].init()},E(".composite_form .composite_data").each(function(){E(this).wc_composite_form()})})}(jQuery,Backbone);