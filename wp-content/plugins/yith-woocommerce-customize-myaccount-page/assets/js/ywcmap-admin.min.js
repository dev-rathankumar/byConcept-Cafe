jQuery(document).ready(function(l){"use strict";var o=l(".endpoints-container");function d(e){var n=tinyMCEPreInit.mceInit,t=Object.keys(n)[0],i=n[t],o=tinyMCEPreInit.qtInit,d=n[Object.keys(o)[0]];i.selector=e,i.body_class=i.body_class.replace(t,e),d.id=e,tinyMCE.init(i),tinyMCE.execCommand("mceRemoveEditor",!0,e),tinyMCE.execCommand("mceAddEditor",!0,e),quicktags(d),QTags._buttonsInit()}"undefined"!=typeof l.fn.nestable&&o.nestable({expandBtnHTML:"",collapseBtnHTML:""}),l("form#plugin-fw-wc").on("submit",function(e){if("undefined"!=typeof l.fn.nestable){var n=l(".dd").nestable("serialize"),t=JSON.stringify(n);l("input.endpoints-order").val(t)}}),l(document).on("click",".open-options",function(){var e=l(this).closest(".endpoint");l(this).find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-up"),e.find(".endpoint-content").first().toggleClass("dd-nodrag"),e.find(".endpoint-options").first().slideToggle(),e.find(".wp-switch-editor.switch-html").click()}),l(document).on("click",".add_new_field",function(e){e.stopPropagation();var n=l(this),t=n.data("target"),i=n.html(),o=l(document).find(".new-field-form").clone();c(o,t,i),o.dialog("open")});var a=!1,c=function(t,e,n){t.dialog({title:n,modal:!0,width:500,resizable:!1,autoOpen:!1,buttons:[{text:"Save",click:function(){l(this).find(".loader").css("display","inline-block"),l(this).add_new_field_handler(e),l(document).one("yith_wcmap_field_added",function(){t.dialog("close")})}}],close:function(e,n){t.dialog("destroy"),t.remove()}})};l.fn.add_new_field_handler=function(e){var t=l(this),n=t.find("#yith-wcmap-new-field").val(),i=t.find(".error-msg");a&&a.abort(),a=l.ajax({url:ywcmap.ajaxurl,data:{target:e,field_name:n,action:ywcmap.action_add},dataType:"json",beforeSend:function(){},success:function(e){if(t.find(".loader").hide(),e.error||o.find('[data-id="'+e.field+'"]').length)i.html(e.error);else{var n=l(e.html);l(".endpoints-container > ol.endpoints > li.endpoint").last().after(n),s(n.find("select")),d(n.find("textarea").attr("id")),l(document).trigger("yith_wcmap_field_added")}}})},o.on("change",function(e,n){void 0!==n&&d(n.find("textarea").attr("id"))});var e=function(e,n){var t,i,o=n.closest(".endpoint"),d=o.find(".hide-show-check"),a="checkbox"==e?n:d.first(),c=o.find(".hide-show-trigger");i=!!(a.is(":checked")&&"checkbox"==e||!a.is(":checked")&&"link"==e),d.prop("checked",i),t=a.is(":checked")?ywcmap.hide_lbl:ywcmap.show_lbl,c.html(t)};function i(e){return l('<span><i class="fa fa-'+e.text+'"></i>   '+e.text+"</span>")}function s(e,n){var t;"undefined"!=typeof l.fn.select2&&l.each(e,function(){t=l(this).hasClass("icon-select")?{templateResult:i,templateSelection:i,width:"100%"}:n?{width:"100%"}:{minimumResultsForSearch:10},l(this).select2(t)})}l(document).on("change",".hide-show-check",function(){e("checkbox",l(this))}),l(document).on("click",".hide-show-trigger",function(){e("link",l(this))}),l(document).on("click",".remove-trigger",function(){var e=l(this),n=e.data("endpoint"),t=l("input.endpoint-to-remove");if(void 0===n||!t.length)return!1;if(1!=confirm(ywcmap.remove_alert))return!1;var i=e.closest(".dd-item"),o=i.find("ol.endpoints"),d=t.val(),a=d.length?d.split(","):[];if(a.push(n),t.val(a.join(",")),o.length){var c=o.find("li.dd-item");i.after(c)}i.remove()}),s(o.find("select"),!0),s(l("#yith_wcmap_panel_general").find("select"),!1)});